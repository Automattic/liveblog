{"version":3,"file":"985.bundle.js","mappings":"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","sources":["webpack://liveblog/./src/react/components/Loader.js","webpack://liveblog/./src/react/containers/PreviewContainer.js","webpack://liveblog/./src/react/components/AuthorSelectOption.js","webpack://liveblog/./src/react/components/HTMLInput.js","webpack://liveblog/./src/react/Editor/utils.js","webpack://liveblog/./src/react/Editor/modifiers/setSelection.js","webpack://liveblog/./src/react/Editor/modifiers/removeBlock.js","webpack://liveblog/./src/react/Editor/modifiers/addNewLine.js","webpack://liveblog/./src/react/Editor/modifiers/moveBlock.js","webpack://liveblog/./src/react/Editor/modifiers/addBlock.js","webpack://liveblog/./src/react/Editor/modifiers/addAtomicBlock.js","webpack://liveblog/./src/react/Editor/blocks/Image.js","webpack://liveblog/./src/react/Editor/blocks/Placeholder.js","webpack://liveblog/./src/react/Editor/Button.js","webpack://liveblog/./src/react/Editor/blocks/CodeBlock.js","webpack://liveblog/./src/react/Editor/blocks/CreateBlockHOC.js","webpack://liveblog/./src/react/Editor/blocks/Media.js","webpack://liveblog/./src/react/Editor/Toolbar.js","webpack://liveblog/./src/react/Editor/modifiers/addLink.js","webpack://liveblog/./src/react/Editor/Suggestions.js","webpack://liveblog/./src/react/Editor/Editor.js","webpack://liveblog/./src/react/Editor/modifiers/skipOverEntity.js","webpack://liveblog/./src/react/Editor/keyBindings/downArrow.js","webpack://liveblog/./src/react/Editor/keyBindings/upArrow.js","webpack://liveblog/./src/react/Editor/keyBindings/returnBinding.js","webpack://liveblog/./src/react/Editor/modifiers/addAutocomplete.js","webpack://liveblog/./src/react/Editor/blocks/blockRenderer.js","webpack://liveblog/./src/react/Editor/keyBindings/keyBindingFunc.js","webpack://liveblog/./src/react/Editor/HTMLtags.js","webpack://liveblog/./src/react/Editor/decorators/Link.js","webpack://liveblog/./src/react/Editor/decorators/Emoji.js","webpack://liveblog/./src/react/Editor/decorators/Text.js","webpack://liveblog/./src/react/Editor/decorators/decorators.js","webpack://liveblog/./src/react/Editor/index.js","webpack://liveblog/./src/react/Editor/convertFromHTML.js","webpack://liveblog/./src/react/Editor/convertToHTML.js","webpack://liveblog/./src/react/containers/EditorContainer.js"],"sourcesContent":["import React from 'react';\n\nconst Loader = () => (\n  <div className=\"liveblog-loader\">\n    <div className=\"liveblog-loader-bounce1\"></div>\n    <div className=\"liveblog-loader-bounce2\"></div>\n  </div>\n);\n\nexport default Loader;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nimport { getPreview } from '../services/api';\nimport Loader from '../components/Loader';\n\nclass PreviewContainer extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      loading: true,\n      error: false,\n      entryContent: false,\n    };\n  }\n\n  componentDidMount() {\n    const { config, getEntryContent } = this.props;\n\n    getPreview(getEntryContent(), config)\n      .timeout(10000)\n      .map(res => res.response)\n      .subscribe(res => this.setState({\n        entryContent: res.html,\n        loading: false,\n      }));\n  }\n\n  render() {\n    const { entryContent, loading } = this.state;\n\n    if (loading) {\n      return (\n        <div className=\"liveblog-preview\"><Loader /></div>\n      );\n    }\n\n    if (!entryContent) return false;\n\n    return (\n      <div\n        className=\"liveblog-preview\"\n        dangerouslySetInnerHTML={{ __html: entryContent }}\n      />\n    );\n  }\n}\n\nPreviewContainer.propTypes = {\n  getEntryContent: PropTypes.func,\n  config: PropTypes.object,\n};\n\nexport default PreviewContainer;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nclass AuthorSelectOption extends Component {\n  handleMouseDown(event) {\n    const { onSelect, option, data, selectOption } = this.props;\n    const item = data || option;\n    event.preventDefault();\n    event.stopPropagation();\n    // react-select v5 uses selectOption instead of onSelect\n    if (selectOption) {\n      selectOption(item);\n    } else if (onSelect) {\n      onSelect(item, event);\n    }\n  }\n\n  handleMouseEnter(event) {\n    const { onFocus, option, data } = this.props;\n    const item = data || option;\n    if (onFocus) onFocus(item, event);\n  }\n\n  handleMouseMove(event) {\n    const { isFocused, onFocus, option, data } = this.props;\n    if (isFocused) return;\n    const item = data || option;\n    if (onFocus) onFocus(item, event);\n  }\n\n  render() {\n    const { className, option, data } = this.props;\n    // react-select v5 uses 'data' prop instead of 'option'\n    const item = data || option || {};\n    return (\n      <div\n        className={`${className} liveblog-popover-item`}\n        onMouseDown={this.handleMouseDown.bind(this)}\n        onMouseEnter={this.handleMouseEnter.bind(this)}\n        onMouseMove={this.handleMouseMove.bind(this)}\n      >\n        { item.avatar && <div dangerouslySetInnerHTML={{ __html: item.avatar }} /> }\n        {item.name}\n      </div>\n    );\n  }\n}\n\nAuthorSelectOption.propTypes = {\n  onSelect: PropTypes.func,\n  option: PropTypes.object,\n  onFocus: PropTypes.func,\n  isFocused: PropTypes.bool,\n  className: PropTypes.string,\n};\n\nexport default AuthorSelectOption;\n","import React from 'react';\n\nimport AceEditor from 'react-ace';\nimport PropTypes from 'prop-types';\nimport 'brace/mode/html';\nimport 'brace/theme/tomorrow';\n\nconst HTMLInput = ({ container = true, ...props }) => (\n  <div className={`liveblog-html-editor ${container ? 'liveblog-html-editor-container' : ''}`}>\n    <AceEditor\n      mode=\"html\"\n      theme=\"tomorrow\"\n      name=\"raw-editor\"\n      fontSize={13}\n      showGutter={false}\n      highlightActiveLine={true}\n      tabSize={2}\n      blockScrolling=\"Infinity\"\n      {...props}\n    />\n  </div>\n);\n\nHTMLInput.propTypes = {\n  container: PropTypes.bool,\n};\n\n\nexport default HTMLInput;\n","/* eslint-disable no-param-reassign */\n\n/**\n * Returns the highest last index of an array of characters.\n */\nexport const getLastIndexOf = (string, characters = []) =>\n  characters.reduce((accumulator, character) =>\n    Math.max(string.lastIndexOf(character), accumulator), -1);\n\n/**\n * Simple templating function that replaces ${data} with a key value.\n */\nconst get = (path, obj, fb = `$\\{${path}}`) =>\n  path.split('.').reduce((res, key) => res[key] || fb, obj);\n\nexport const parseTemplate = (template, map, fallback) =>\n  template.replace(/\\$\\{.+?}/g, (match) => {\n    const path = match.substr(2, match.length - 3).trim();\n    return get(path, map, fallback);\n  });\n\n/**\n * Returns boolean if selection contains entity\n */\nexport const hasEntityAtSelection = (editorState, selectionState = false) => {\n  const selection = selectionState || editorState.getSelection();\n  if (!selection.getHasFocus()) return false;\n  const contentState = editorState.getCurrentContent();\n  const block = contentState.getBlockForKey(selection.getStartKey());\n  const entityKey = block.getEntityAt(selection.getStartOffset() - 1);\n  if (!entityKey) return false;\n  return contentState.getEntity(entityKey);\n};\n\n/**\n * Gets the range of an autocomplete trigger from the trigger character to where\n * the user is typing.\n */\nexport const getTriggerRange = (triggers) => {\n  const selection = window.getSelection();\n  if (selection.rangeCount === 0) return null;\n  const range = selection.getRangeAt(0);\n  const text = range.startContainer.textContent.substring(0, range.startOffset);\n\n  // If the last character is a space bail.\n  if (/\\s+$/.test(text)) return null;\n\n  const index = getLastIndexOf(text, triggers);\n  if (index === -1) return null;\n\n  return {\n    text: text.substring(index),\n    start: index,\n    end: range.startOffset,\n  };\n};\n\n/**\n * Gets the autocomplete insert range to replace the trigger range with an enitity.\n */\nexport const getInsertRange = (autocompleteState, editorState) => {\n  const currentSelectionState = editorState.getSelection();\n  const end = currentSelectionState.getAnchorOffset();\n  const anchorKey = currentSelectionState.getAnchorKey();\n  const currentContent = editorState.getCurrentContent();\n  const currentBlock = currentContent.getBlockForKey(anchorKey);\n  const blockText = currentBlock.getText();\n  const start = blockText.substring(0, end).lastIndexOf(autocompleteState.trigger);\n\n  return {\n    start,\n    end,\n  };\n};\n\n/**\n * Returns a number of the top position of trigger range to poistion the suggestion popover.\n */\nexport const getTopPosition = (range, parent) => {\n  const tempRange = window.getSelection().getRangeAt(0).cloneRange();\n  tempRange.setStart(tempRange.startContainer, range.start);\n  const parentRect = parent.getBoundingClientRect();\n  const rect = tempRange.getBoundingClientRect();\n  return (rect.top - parentRect.top) + rect.height;\n};\n\n/**\n * If an element is hidden in a scrollable box then make it visible.\n */\nexport const scrollElementIfNotInView = (childElement, parentElement) => {\n  const parentClientRect = parentElement.getBoundingClientRect();\n  const parentBottom = parentClientRect.bottom;\n  const parentTop = parentClientRect.top;\n\n  const childRect = childElement.getBoundingClientRect();\n  const childBottom = childRect.bottom;\n  const childTop = childRect.top;\n  if (childBottom > parentBottom) parentElement.scrollTop += childRect.height;\n  if (childTop < parentTop) parentElement.scrollTop -= childRect.height;\n};\n\n/**\n * Returns an array of all the blocks at a selection given a start and end key.\n */\nexport const getSelectedBlocks = (contentState, anchorKey, focusKey) => {\n  const isSameBlock = anchorKey === focusKey;\n  const startingBlock = contentState.getBlockForKey(anchorKey);\n  const selectedBlocks = [startingBlock];\n\n  if (!isSameBlock) {\n    let blockKey = anchorKey;\n\n    while (blockKey !== focusKey) {\n      const nextBlock = contentState.getBlockAfter(blockKey);\n      selectedBlocks.push(nextBlock);\n      blockKey = nextBlock.getKey();\n    }\n  }\n\n  return selectedBlocks;\n};\n\n/**\n * Check if a focusable block is focused/selected\n */\nexport const focusableBlockIsSelected = (editorState) => {\n  const selection = editorState.getSelection();\n  if (selection.getAnchorKey() !== selection.getFocusKey()) {\n    return false;\n  }\n  const content = editorState.getCurrentContent();\n  const block = content.getBlockForKey(selection.getAnchorKey());\n  if (block.getType() === 'atomic') return block;\n  return false;\n};\n\n/**\n * Get the most suitable image size.\n * @param {object} image\n * @param {string} selectedSize\n */\nexport const getImageSize = (sizes, defaultSize) => {\n  if (!sizes) return '';\n  if (sizes[defaultSize]) {\n    return sizes[defaultSize].source_url || sizes[defaultSize].url;\n  }\n  if (sizes.full) {\n    return sizes.full.source_url || sizes.full.url;\n  }\n  return '';\n};\n\n/**\n * Map a NamedNodeMap to an object and map the class attribute to className\n * for React.\n * @param {namedNodeMap} attributes\n */\nexport const namedNodeMapToObject = namedNodeMap =>\n  Array.from(namedNodeMap).reduce((object, item) => ({\n    ...object,\n    [item.name === 'class' ? 'className' : item.name]: item.value,\n  }), {});\n","\nimport { SelectionState, EditorState } from 'draft-js';\nimport DraftOffsetKey from 'draft-js/lib/DraftOffsetKey';\n\nexport default (editorState, onChange, direction, event) => {\n  const anchorKey = editorState.getSelection().getAnchorKey();\n  const block = direction === 'up'\n    ? editorState.getCurrentContent().getBlockBefore(anchorKey)\n    : editorState.getCurrentContent().getBlockAfter(anchorKey);\n\n  if (block && block.get('key') === anchorKey) {\n    return;\n  }\n\n  if (block) {\n    event.preventDefault();\n\n    const offsetKey = DraftOffsetKey.encode(block.getKey(), 0, 0);\n    // Set the native selection to the node so the selection is not in the text\n    const node = document.querySelector(`[data-offset-key=\"${offsetKey}\"]`);\n    const selection = window.getSelection();\n    const range = document.createRange();\n    range.setStart(node, 0);\n    range.setEnd(node, 0);\n    selection.removeAllRanges();\n    selection.addRange(range);\n\n    const offset = direction === 'up'\n      ? block.getLength()\n      : 0;\n\n    onChange(\n      EditorState.forceSelection(\n        editorState,\n        new SelectionState({\n          anchorKey: block.getKey(),\n          anchorOffset: offset,\n          focusKey: block.getKey(),\n          focusOffset: offset,\n          isBackward: false,\n        }),\n      ),\n    );\n  }\n};\n","import { Modifier, SelectionState } from 'draft-js';\n\nexport default (contentState, blockKey) => {\n  const afterKey = contentState.getKeyAfter(blockKey);\n  const afterBlock = contentState.getBlockForKey(afterKey);\n  let targetRange;\n\n  if (\n    afterBlock &&\n    afterBlock.getType() === 'unstyled' &&\n    afterBlock.getLength() === 0 &&\n    afterBlock === contentState.getBlockMap().last()\n  ) {\n    targetRange = new SelectionState({\n      anchorKey: blockKey,\n      anchorOffset: 0,\n      focusKey: afterKey,\n      focusOffset: 0,\n    });\n  } else {\n    targetRange = new SelectionState({\n      anchorKey: blockKey,\n      anchorOffset: 0,\n      focusKey: blockKey,\n      focusOffset: 1,\n    });\n  }\n\n  const newContentState = Modifier.setBlockType(\n    contentState,\n    targetRange,\n    'unstyled',\n  );\n\n  return Modifier.removeRange(newContentState, targetRange, 'backward');\n};\n","import { List } from 'immutable';\nimport {\n  Modifier,\n  ContentBlock,\n  EditorState,\n  BlockMapBuilder,\n  genKey,\n} from 'draft-js';\n\nimport removeBlock from './removeBlock';\n\nexport default (editorState) => {\n  const newEditorState = editorState;\n  const contentState = newEditorState.getCurrentContent();\n  const selectionState = newEditorState.getSelection();\n  const currentBlock = contentState.getBlockForKey(selectionState.getFocusKey());\n\n  /**\n   * Draft Convert converts html to blocks and sets the block's text to\n   * it's innerHTML. This isn't configurable so to prevent this text\n   * being inserted when creating a new line we remove the block and create a\n   * new block with empty text.\n   */\n  const contentStateAfterRemoval = removeBlock(contentState, currentBlock.getKey());\n\n  const fragmentArray = [\n    new ContentBlock({\n      key: genKey(),\n      type: currentBlock.getType(),\n      text: ' ',\n      characterList: currentBlock.getCharacterList(),\n    }),\n    new ContentBlock({\n      key: genKey(),\n      type: 'unstyled',\n      text: '',\n      characterList: List(),\n    }),\n  ];\n\n  const fragment = BlockMapBuilder.createFromArray(fragmentArray);\n\n  const withUnstyledBlock = Modifier.replaceWithFragment(\n    contentStateAfterRemoval,\n    selectionState,\n    fragment,\n  );\n\n  return EditorState.forceSelection(\n    EditorState.push(newEditorState, withUnstyledBlock, 'insert-fragment'),\n    withUnstyledBlock.getSelectionAfter(),\n  );\n};\n\n","import { EditorState } from 'draft-js';\n\nimport removeBlock from './removeBlock';\nimport addBlock from './addBlock';\n\nexport default (editorState, blockKey, selection) => {\n  const contentState = editorState.getCurrentContent();\n  const block = contentState.getBlockForKey(blockKey);\n  const entity = contentState.getEntity(block.getEntityAt(0));\n\n  const contentStateAfterInsert = addBlock(\n    editorState,\n    selection,\n    block.getType(),\n    entity.data,\n    entity.type,\n  );\n\n  const contentStateAfterRemove = removeBlock(contentStateAfterInsert, blockKey);\n\n  const newState = EditorState.push(editorState, contentStateAfterRemove, 'move-block');\n\n  return EditorState.forceSelection(\n    newState,\n    contentStateAfterRemove.getSelectionAfter(),\n  );\n};\n\n","// @todo tidy up this file\n\nimport { List, Repeat } from 'immutable';\nimport {\n  Modifier,\n  CharacterMetadata,\n  BlockMapBuilder,\n  ContentBlock,\n  genKey,\n} from 'draft-js';\n\nimport { hasEntityAtSelection } from '../utils';\n\nexport default function (editorState, selection, type, data, entityType, text = ' ') {\n  let contentState = editorState.getCurrentContent();\n  const currentSelectionState = selection;\n\n  if (!hasEntityAtSelection(editorState, selection)) {\n    contentState = Modifier.removeRange(\n      contentState,\n      currentSelectionState,\n      'backward',\n    );\n  }\n\n  // deciding on the postion to split the text\n  const targetSelection = contentState.getSelectionAfter();\n  const blockKeyForTarget = targetSelection.get('focusKey');\n  const block = contentState.getBlockForKey(blockKeyForTarget);\n  let insertionTargetSelection;\n  let insertionTargetBlock;\n\n  /**\n  *  In case there are no characters or entity or the selection is at the start it\n  * is safe to insert the block in the current block.\n  * Otherwise a new block is created (the block is always its own block)\n  */\n  const isEmptyBlock = block.getLength() === 0 && block.getEntityAt(0) === null;\n  const selectedFromStart = currentSelectionState.getStartOffset() === 0;\n  if (isEmptyBlock || selectedFromStart) {\n    insertionTargetSelection = targetSelection;\n    insertionTargetBlock = contentState;\n  } else {\n    // the only way to insert a new seems to be by splitting an existing in to two\n    insertionTargetBlock = Modifier.splitBlock(contentState, targetSelection);\n    // the position to insert our blocks\n    insertionTargetSelection = insertionTargetBlock.getSelectionAfter();\n  }\n\n  const newContentStateAfterSplit = Modifier.setBlockType(\n    insertionTargetBlock,\n    insertionTargetSelection,\n    type,\n  );\n\n  // creating a new ContentBlock including the entity with data\n  // Entity will be created with a specific type,\n  // if defined, else will fall back to the ContentBlock type\n  const contentStateWithEntity = newContentStateAfterSplit.createEntity(\n    entityType || type,\n    'IMMUTABLE',\n    { ...data },\n  );\n\n  const entityKey = contentStateWithEntity.getLastCreatedEntityKey();\n  const charData = CharacterMetadata.create({ entity: entityKey });\n\n  const fragmentArray = [\n    new ContentBlock({\n      key: genKey(),\n      type,\n      text,\n      characterList: List(Repeat(charData, text.length || 1)),\n    }),\n  ];\n\n  if (!isEmptyBlock) {\n    fragmentArray.push(\n      new ContentBlock({\n        key: genKey(),\n        type: 'unstyled',\n        text: '',\n        characterList: List(),\n      }),\n    );\n  }\n\n  // create fragment containing the two content blocks\n  const fragment = BlockMapBuilder.createFromArray(fragmentArray);\n\n  // replace the contentblock we reserved for our insert\n  return Modifier.replaceWithFragment(\n    newContentStateAfterSplit,\n    insertionTargetSelection,\n    fragment,\n  );\n}\n","import {\n  EditorState,\n  AtomicBlockUtils,\n} from 'draft-js';\n\nimport moveBlock from './moveBlock';\nimport addNewLine from './addNewLine';\n\nimport {\n  focusableBlockIsSelected,\n} from '../utils';\n\nexport default (editorState, selection = false, data = {}, name) => {\n  let newEditorState = editorState;\n\n  if (focusableBlockIsSelected(editorState)) {\n    newEditorState = addNewLine(editorState);\n  }\n\n  const contentState = newEditorState.getCurrentContent();\n  const contentStateWithEntity = contentState.createEntity(\n    name,\n    'IMMUTABLE',\n    data,\n  );\n\n  const entityKey = contentStateWithEntity.getLastCreatedEntityKey();\n\n  newEditorState = AtomicBlockUtils.insertAtomicBlock(\n    newEditorState,\n    entityKey,\n    ' ',\n  );\n\n  if (!selection) {\n    return EditorState.forceSelection(\n      newEditorState,\n      newEditorState.getCurrentContent().getSelectionAfter(),\n    );\n  }\n\n  const newAtomicBlock = newEditorState\n    .getCurrentContent()\n    .getBlockMap()\n    .find(x => x.getEntityAt(0) === entityKey);\n\n  return moveBlock(newEditorState, newAtomicBlock.getKey(), selection);\n};\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\nconst Image = ({ contentState, block }) => {\n  const { src } = contentState.getEntity(block.getEntityAt(0)).getData();\n\n  return (\n    <img\n      src={src}\n      role=\"presentation\"\n    />\n  );\n};\n\nImage.propTypes = {\n  contentState: PropTypes.object,\n  block: PropTypes.object,\n};\n\nexport default Image;\n","import React from 'react';\nimport Loader from '../../components/Loader';\n\nconst Placeholder = () => (\n  <div className=\"liveblog-placeholder\">\n    <div className=\"liveblog-placeholder-inner\">\n      <Loader />\n      <div className=\"liveblog-placeholder-text\">Uploading Image...</div>\n    </div>\n  </div>\n);\n\nexport default Placeholder;\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\nconst Button = ({ click, onMouseDown, icon, classes, readOnly }) => (\n  <span style={{ display: 'inline-block' }} onMouseDown={onMouseDown ? e => e.preventDefault() : null}>\n    <button\n      disabled={readOnly}\n      className={`liveblog-btn liveblog-editor-btn ${classes}`}\n      onClick={onMouseDown || click}>\n      <span className={`dashicons dashicons-${icon}`}></span>\n    </button>\n  </span>\n);\n\nButton.propTypes = {\n  click: PropTypes.func,\n  onMouseDown: PropTypes.func,\n  icon: PropTypes.string,\n  classes: PropTypes.string,\n  readOnly: PropTypes.bool,\n};\n\nexport default Button;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nimport Button from '../Button';\nimport HTMLInput from '../../components/HTMLInput';\n\nclass CodeBlock extends Component {\n  constructor(props) {\n    super(props);\n    const { code, title } = props.getMetadata();\n    this.placeholder = 'Insert HTML...';\n\n    this.state = {\n      title,\n      code,\n    };\n  }\n\n  /**\n   * Handle save.\n   */\n  save() {\n    const { code, title } = this.state;\n    const { replaceMetadata, setEditMode } = this.props;\n    replaceMetadata({ code, title }, true);\n    setEditMode(false);\n  }\n\n  /**\n   * Set edit mode to false.\n   */\n  cancel() {\n    const { setEditMode, getMetadata } = this.props;\n    const { code, title } = getMetadata();\n    this.setState({ code, title });\n    setEditMode(false);\n  }\n\n  /**\n   * Handle onChange event to keep textare in sync.\n   * @param {object} event\n   */\n  handleChange(value) {\n    this.setState({ code: value });\n  }\n\n  render() {\n    const { code, title } = this.state;\n    const { edit, setEditMode, removeBlock } = this.props;\n\n    return (\n      <div className=\"liveblog-block-inner liveblog-editor-codeblock\">\n        <div className=\"liveblog-block-header\">\n          <span className=\"liveblog-block-title-container\">\n            <span className=\"liveblog-block-title\">{ !edit ? 'HTML Block:' : 'Title:' }</span>\n            {!edit\n              ? <span>{title}</span>\n              : <input\n                value={title}\n                onChange={event => this.setState({ title: event.target.value })}\n              />\n            }\n          </span>\n          <div className=\"liveblog-editor-actions\">\n            {edit &&\n              <span style={{ display: 'inline-block' }} onMouseDown={e => e.preventDefault()}>\n                <button\n                  className=\"liveblog-editor-btn liveblog-editor-cancel-btn\"\n                  onClick={this.cancel.bind(this)}>\n                  Cancel\n                </button>\n              </span>\n            }\n            <span style={{ display: 'inline-block' }} onMouseDown={e => e.preventDefault()}>\n              <button\n                className=\"liveblog-editor-btn liveblog-editor-action-btn\"\n                onClick={!edit ? () => setEditMode(true) : this.save.bind(this)}>\n                {edit ? 'Save' : 'Edit'}\n              </button>\n            </span>\n            { !edit &&\n              <Button\n                onMouseDown={() => removeBlock()}\n                icon=\"no-alt\"\n                classes=\"liveblog-editor-delete\"\n              />\n            }\n          </div>\n        </div>\n        {\n          edit &&\n          <HTMLInput\n            container={false}\n            value={code}\n            onChange={this.handleChange.bind(this)}\n            height=\"175px\"\n            width=\"100%\"\n          />\n        }\n      </div>\n    );\n  }\n}\n\nCodeBlock.propTypes = {\n  setEditMode: PropTypes.func,\n  getMetadata: PropTypes.func,\n  replaceMetadata: PropTypes.func,\n  edit: PropTypes.bool,\n  removeBlock: PropTypes.func,\n};\n\nexport default CodeBlock;\n","/* eslint-disable react/display-name */\n/* eslint-disable react/prop-types */\n\nimport React, { Component } from 'react';\nimport { EditorState } from 'draft-js';\nimport removeBlock from '../modifiers/removeBlock';\n\nconst CreateBlock = (Block, editorState, onChange) => class extends Component {\n  constructor() {\n    super();\n\n    this.state = {\n      edit: false,\n    };\n  }\n\n  /**\n   * Handle whether or not the editor mode should be open by default.\n   * We pass this as meta data whenever we create the block in the editor.\n   */\n  componentDidMount() {\n    const { setReadOnly, edit } = this.getMetadata();\n    if (edit) {\n      this.setState({ edit: true });\n      setReadOnly(true);\n    }\n  }\n\n  componentWillUnmount() {\n    this.setEditMode(false);\n  }\n\n  /**\n   * Set edit mode to new state.\n   * @param {bool} state\n   */\n  setEditMode(state) {\n    const { setReadOnly } = this.getMetadata();\n    this.setState({ edit: state });\n    this.replaceMetadata({ edit: state });\n    setReadOnly(state);\n  }\n\n  /**\n   * Retrieve metadata saved to block.\n   */\n  getMetadata() {\n    const { contentState, block } = this.props;\n    return contentState.getEntity(block.getEntityAt(0)).getData();\n  }\n\n  /**\n   * Replace metadata daved to block.\n   * @param {object} data\n   * @param {boolean} update whether to trigger a re-render. Should be used cautiously as can\n   * cause race conditions. We generally only need to re-render when we want to keep the raw html\n   * input in sync.\n   */\n  replaceMetadata(data, update = false) {\n    const { contentState, block } = this.props;\n    const newContentState = contentState.mergeEntityData(block.getEntityAt(0), data);\n    if (update) {\n      const newEditorState = EditorState.push(\n        editorState,\n        newContentState,\n        'replace-metadata',\n      );\n\n      onChange(\n        EditorState.forceSelection(newEditorState, newEditorState.getSelection()),\n      );\n    }\n  }\n\n  /**\n   * Set dataTransfer data on drag. We set the text key because nothing else will\n   * move the cursor which is the behavior we want. It is worth noting that in development\n   * builds of React this doesn't work in IE11. You can read why here -\n   * https://github.com/facebook/react/issues/5700\n   */\n  startDrag(e) {\n    const { block } = this.props;\n    e.dataTransfer.dropEffect = 'move'; // eslint-disable-line no-param-reassign\n    e.dataTransfer.setData('text', `DRAFT_BLOCK:${block.getKey()}`);\n  }\n\n  /**\n   * Remove block from editor.\n   */\n  removeBlock() {\n    const { block } = this.props;\n\n    const contentAfterRemove = removeBlock(\n      editorState.getCurrentContent(),\n      block.getKey(),\n    );\n\n    onChange(\n      EditorState.forceSelection(\n        EditorState.push(editorState, contentAfterRemove, 'remove-block'),\n        contentAfterRemove.getSelectionAfter(),\n      ),\n    );\n  }\n\n  render() {\n    const { blockProps } = this.props;\n    const { edit } = this.state;\n\n    return (\n      <div\n        className={`liveblog-block ${edit ? 'is-editing' : ''} ${blockProps.isFocused ? 'is-focused' : ''}`}\n        draggable={true}\n        onDragStart={!edit ? this.startDrag.bind(this) : e => e.preventDefault()}\n      >\n        <Block\n          {...this.props}\n          edit={edit}\n          setEditMode={this.setEditMode.bind(this)}\n          getMetadata={this.getMetadata.bind(this)}\n          replaceMetadata={this.replaceMetadata.bind(this)}\n          removeBlock={this.removeBlock.bind(this)}\n        />\n      </div>\n    );\n  }\n};\n\nexport default CreateBlock;\n","// @todo This file could be tidied up and split out into seperate components.\n\n/* eslint-disable no-return-assign */\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { getMedia } from '../../services/api';\n\nimport Button from '../Button';\nimport Loader from '../../components/Loader';\nimport { getImageSize } from '../utils';\n\n/**\n * Find the image thumbanil src\n * @param {object} image\n */\nconst getImageThumbnail = (image) => {\n  if (!image || !image.media_details || !image.media_details.sizes) return '';\n  if (image.media_details.sizes.thumbnail) {\n    return image.media_details.sizes.thumbnail.source_url;\n  }\n  return '';\n};\n\nclass Media extends Component {\n  constructor(props) {\n    super(props);\n\n    // Set default params to retrieve media.\n    this.defaultParams = {\n      per_page: 12,\n    };\n\n    // This needs to unique per block, so we might aswell just use\n    // the block's unique key.\n    this.inputId = props.block.getKey();\n\n    this.defaultState = {\n      loading: true,\n      images: [],\n      currentPage: 0,\n      totalPages: 0,\n      searchInput: '',\n      searching: false,\n      uploading: false,\n    };\n\n    this.state = {\n      ...this.defaultState,\n    };\n  }\n\n  /**\n   * Retrieve posts when entering edit mode.\n   * @param {object} prevProps\n   */\n  componentDidUpdate(prevProps) {\n    const { edit } = this.props;\n    if (edit !== prevProps.edit && edit) {\n      this.setState({ searching: true });\n      this.getMedia({ page: 1 });\n    }\n  }\n\n  /**\n   * Retrive media from api and update the state accordingly.\n   * @param {object} params\n   */\n  getMedia(params = {}) {\n    const { searchInput, images, searching } = this.state;\n\n    // Merge default params and entered params.\n    const mergedParams = {\n      ...this.defaultParams,\n      ...params,\n    };\n\n    // Make sure we are filtering by search if there is an input.\n    if (searchInput) mergedParams.search = searchInput;\n\n    this.setState({ loading: true });\n\n    getMedia(mergedParams)\n      .timeout(10000)\n      .map(res => ({\n        res: res.response,\n        pages: res.xhr.getResponseHeader('X-WP-TotalPages'),\n      }))\n      .subscribe(({ res, pages }) => {\n        // If have submitted a new search we only want to show page 1.\n        let result = res;\n        // Otherwise we want to merge the current images and response\n        // for lazy loading.\n        if (!searching) {\n          result = [\n            ...images,\n            ...res,\n          ];\n        }\n        this.setState({\n          images: result,\n          totalPages: pages,\n          currentPage: mergedParams.page,\n          loading: false,\n          searching: false,\n        });\n      });\n  }\n\n  /**\n   * Handle loading more button by next page of posts.\n   */\n  loadMore() {\n    const { currentPage } = this.state;\n    this.getMedia({ page: currentPage + 1 });\n  }\n\n  /**\n   * Close edit mode.\n   */\n  cancel() {\n    const { setEditMode } = this.props;\n    this.setState({ ...this.defaultState });\n    setEditMode(false);\n  }\n\n  /**\n   * Handle selecting an image from the media library.\n   */\n  selectImage(image) {\n    const { setEditMode, replaceMetadata, getMetadata } = this.props;\n    const { defaultImageSize } = getMetadata();\n    const src = getImageSize(image.media_details.sizes, defaultImageSize);\n    setEditMode(false);\n    this.setState({ ...this.defaultState });\n    replaceMetadata({ image: src, edit: false }, true);\n  }\n\n  /**\n   * Handle when a search is submitted.\n   */\n  handleSearch(event) {\n    event.preventDefault();\n    this.setState({ searching: true }, () => {\n      this.getMedia({ page: 1 });\n    });\n  }\n\n  /**\n   * Handle upload of an image.\n   */\n  uploadImage() {\n    const { setEditMode, replaceMetadata, getMetadata } = this.props;\n    const { handleImageUpload } = getMetadata();\n    const files = this.imageUpload.files;\n    if (files.length === 0) return;\n\n    // Set uploading state so we can render a loader in the UI.\n    this.setState({\n      ...this.defaultState,\n      uploading: true,\n    });\n\n    // Make sure we close edit mode correctly.\n    setEditMode(false);\n\n    // Upload image to server and render in the block.\n    handleImageUpload(files[0]).then((src) => {\n      replaceMetadata({ image: src });\n      this.setState({ uploading: false });\n    });\n\n    // Clear input value so the same file can be upload again if user wants to.\n    this.imageUpload.value = '';\n  }\n\n  /**\n   * Render the media library images.\n   */\n  renderMediaImages() {\n    const { loading, images, currentPage, totalPages, searching } = this.state;\n\n    if (searching) {\n      return (\n        <div className=\"liveblog-placeholder liveblog-media-loading\">\n          <div className=\"liveblog-placeholder-inner\">\n            <Loader />\n            <div className=\"liveblog-placeholder-text\">Finding Images...</div>\n          </div>\n        </div>\n      );\n    }\n\n    if (images.length === 0) {\n      return (\n        <div className=\"liveblog-placeholder liveblog-media-loading\">\n          <div className=\"liveblog-placeholder-inner\">\n            <div style={{ marginBottom: '.5rem' }}>\n              No Images Found\n            </div>\n            <span style={{ display: 'inline-block' }} onMouseDown={e => e.preventDefault()}>\n              <label\n                htmlFor={this.inputId}\n                className=\"liveblog-editor-btn liveblog-editor-action-btn has-icon\"\n              >\n                <span className=\"dashicons dashicons-upload\" />\n                Upload an Image?\n              </label>\n            </span>\n          </div>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"liveblog-media-grid\">\n        {\n          images.map(image => (\n            <div\n              key={image.id}\n              onClick={() => this.selectImage(image)}\n              className=\"liveblog-media-grid-item\"\n            >\n              <img src={getImageThumbnail(image)} />\n            </div>\n          ))\n        }\n        <div style={{\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          margin: '.5rem',\n          width: '100%',\n        }}>\n          {\n            ((currentPage !== parseInt(totalPages, 10)) && !loading) &&\n            <button\n              style={{ width: '100%', padding: '.75rem' }}\n              className=\"liveblog-editor-btn liveblog-editor-action-btn\"\n              onClick={this.loadMore.bind(this)}\n            >\n              Load more\n            </button>\n          }\n          {\n            loading && <Loader />\n          }\n        </div>\n      </div>\n    );\n  }\n\n  /**\n   * Render a preview of the current image associated with block.\n   */\n  renderCurrentImage() {\n    const { uploading } = this.state;\n    const { getMetadata, setEditMode } = this.props;\n    const { image } = getMetadata();\n\n    if (uploading) {\n      return (\n        <div className=\"liveblog-placeholder liveblog-media-loading\">\n          <div className=\"liveblog-placeholder-inner\">\n            <Loader />\n            <div style={{ marginTop: '.5rem' }} className=\"liveblog-placeholder-text\">\n              Uploading...\n            </div>\n          </div>\n        </div>\n      );\n    }\n\n    if (image) {\n      return (\n        <div className=\"liveblog-media-current-container\">\n          <img src={image} />\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"liveblog-placeholder liveblog-media-loading\">\n        <div className=\"liveblog-placeholder-inner\">\n          <div style={{ marginBottom: '.5rem' }}>\n            No Image Selected\n          </div>\n          <span style={{ display: 'inline-block' }} onMouseDown={e => e.preventDefault()}>\n            <button\n              className=\"liveblog-editor-btn liveblog-editor-action-btn has-icon\"\n              onClick={() => setEditMode(true)}\n            >\n              <span className=\"dashicons dashicons-format-image\" />\n              Choose an Image?\n            </button>\n          </span>\n        </div>\n      </div>\n    );\n  }\n\n  render() {\n    const { searchInput } = this.state;\n    const { edit, setEditMode, removeBlock } = this.props;\n\n    return (\n      <div className=\"liveblog-block-inner liveblog-media-block\">\n        <input\n          ref={ref => this.imageUpload = ref}\n          style={{ display: 'none' }}\n          type=\"file\"\n          id={this.inputId}\n          onChange={this.uploadImage.bind(this)}\n          accept=\"image/jpeg,image/gif,image/png,image/jpg\"\n        />\n        <div className=\"liveblog-block-header\">\n          <span className=\"liveblog-block-title-container\">\n            <span className=\"liveblog-block-title\">\n              { edit ? 'Add Media' : 'Image Block' }\n            </span>\n          </span>\n          <div className=\"liveblog-editor-actions\">\n            <span style={{ display: 'inline-block' }} onMouseDown={e => e.preventDefault()}>\n              <button\n                className={`liveblog-editor-btn liveblog-editor-${!edit ? 'action' : 'cancel'}-btn`}\n                onClick={!edit ? () => setEditMode(true) : this.cancel.bind(this)}\n              >\n                {!edit\n                  ? 'Change Image'\n                  : 'Cancel'\n                }\n              </button>\n            </span>\n            { edit &&\n              <span style={{ display: 'inline-block' }} onMouseDown={e => e.preventDefault()}>\n                <label\n                  htmlFor={this.inputId}\n                  className=\"liveblog-editor-btn liveblog-editor-action-btn has-icon\">\n                  <span className=\"dashicons dashicons-upload\" />\n                  Upload\n                </label>\n              </span>\n            }\n            { !edit &&\n              <Button\n                onMouseDown={() => removeBlock()}\n                icon=\"no-alt\"\n                classes=\"liveblog-editor-delete\"\n              />\n            }\n          </div>\n        </div>\n        {\n          edit\n            ? (\n              <div>\n                <form\n                  className=\"liveblog-media-search-container\"\n                  onSubmit={this.handleSearch.bind(this)}\n                >\n                  <span\n                    style={{ color: '#333', cursor: 'pointer' }}\n                    className=\"dashicons dashicons-search\"\n                    onClick={this.handleSearch.bind(this)}\n                  />\n                  <input\n                    placeholder=\"Search media items...\"\n                    value={searchInput}\n                    onChange={event => this.setState({ searchInput: event.target.value })}\n                  />\n                </form>\n                {this.renderMediaImages()}\n              </div>\n            )\n            : this.renderCurrentImage()\n        }\n      </div>\n    );\n  }\n}\n\nMedia.propTypes = {\n  setEditMode: PropTypes.func,\n  block: PropTypes.object,\n  getMetadata: PropTypes.func,\n  replaceMetadata: PropTypes.func,\n  removeBlock: PropTypes.func,\n  edit: PropTypes.bool,\n  defaultImageSize: PropTypes.string,\n};\n\nexport default Media;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { RichUtils } from 'draft-js';\n\nimport addLink from './modifiers/addLink';\nimport addAtomicBlock from './modifiers/addAtomicBlock';\nimport Button from './Button';\n\nclass Toolbar extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      showURLInput: false,\n      url: '',\n    };\n\n    this.onURLChange = e => this.setState({ url: e.target.value });\n  }\n\n  toggleInlineStyle(type) {\n    const { onChange } = this.props;\n\n    onChange(\n      RichUtils.toggleInlineStyle(\n        this.props.editorState,\n        type,\n      ),\n    );\n  }\n\n  toggleBlockType(type) {\n    const { onChange } = this.props;\n\n    onChange(\n      RichUtils.toggleBlockType(\n        this.props.editorState,\n        type,\n      ),\n    );\n  }\n\n  openLinkModal() {\n    const { showURLInput } = this.state;\n    if (showURLInput) return;\n\n    const { editorState } = this.props;\n    const selection = editorState.getSelection();\n    if (selection.isCollapsed()) return;\n\n    const contentState = editorState.getCurrentContent();\n    const startKey = editorState.getSelection().getStartKey();\n    const startOffset = editorState.getSelection().getStartOffset();\n    const blockWithLinkAtBeginning = contentState.getBlockForKey(startKey);\n    const linkKey = blockWithLinkAtBeginning.getEntityAt(startOffset);\n    let url = 'http://';\n\n    if (linkKey) {\n      url = contentState.getEntity(linkKey).getData().url;\n    }\n\n    this.setState({\n      showURLInput: true,\n      url,\n    });\n  }\n\n  closeLinkModal() {\n    this.setState({\n      showURLInput: false,\n      url: '',\n    });\n  }\n\n  turnIntoLink(e) {\n    e.preventDefault();\n\n    const { url } = this.state;\n    const { editorState, onChange } = this.props;\n\n    onChange(\n      addLink(editorState, url),\n    );\n\n    this.setState({ url: '', showURLInput: false });\n  }\n\n  removeAsLink(e) {\n    e.preventDefault();\n    const { showURLInput } = this.state;\n\n    if (showURLInput) {\n      this.setState({ url: '', showURLInput: false });\n    }\n\n    const { editorState, onChange } = this.props;\n\n    const selection = editorState.getSelection();\n    if (selection.isCollapsed()) return;\n\n    onChange(\n      RichUtils.toggleLink(editorState, selection, null),\n    );\n  }\n\n  addCodeBlock(e) {\n    e.preventDefault();\n    const { editorState, onChange, setReadOnly } = this.props;\n\n    onChange(\n      addAtomicBlock(editorState, false, {\n        code: '',\n        title: 'HTML',\n        edit: true,\n        setReadOnly,\n      }, 'code-block'),\n    );\n  }\n\n  addMediaBlock(e) {\n    e.preventDefault();\n    const {\n      editorState,\n      onChange,\n      setReadOnly,\n      handleImageUpload,\n      defaultImageSize,\n    } = this.props;\n\n    onChange(\n      addAtomicBlock(editorState, false, {\n        setReadOnly,\n        image: '',\n        edit: true,\n        handleImageUpload,\n        defaultImageSize,\n      }, 'media'),\n    );\n  }\n\n  render() {\n    const { showURLInput } = this.state;\n    const { readOnly } = this.props;\n\n    return (\n      <div className=\"liveblog-editor-toolbar-container\">\n        <button\n          disabled={readOnly}\n          onClick={this.addMediaBlock.bind(this)}\n          className=\"liveblog-editor-btn liveblog-image-upload-btn\"\n        >\n          <span className=\"dashicons dashicons-format-image\"></span>\n          <span className=\"liveblog-image-upload-btn-text\">Insert Image</span>\n        </button>\n        <div className=\"liveblog-toolbar\">\n          <Button\n            onMouseDown={() => this.toggleInlineStyle('BOLD')}\n            icon=\"editor-bold\"\n            readOnly={readOnly}\n          />\n          <Button\n            onMouseDown={() => this.toggleInlineStyle('ITALIC')}\n            icon=\"editor-italic\"\n            readOnly={readOnly}\n          />\n          <Button\n            onMouseDown={() => this.toggleInlineStyle('UNDERLINE')}\n            icon=\"editor-underline\"\n            readOnly={readOnly}\n          />\n          <Button\n            onMouseDown={() => this.toggleBlockType('ordered-list-item')}\n            icon=\"editor-ol\"\n            readOnly={readOnly}\n          />\n          <Button\n            onMouseDown={() => this.toggleBlockType('unordered-list-item')}\n            icon=\"editor-ul\"\n            readOnly={readOnly}\n          />\n          <div style={{ position: 'relative', display: 'inline-block' }}>\n            <Button\n              onMouseDown={this.openLinkModal.bind(this)}\n              icon=\"admin-links\"\n              readOnly={readOnly}\n            />\n            {\n              showURLInput &&\n              <div className=\"liveblog-editor-input-container\">\n                <input\n                  className=\"liveblog-input\"\n                  onChange={this.onURLChange}\n                  value={this.state.url}\n                />\n                <Button\n                  onMouseDown={this.turnIntoLink.bind(this)}\n                  icon=\"yes\"\n                  classes=\"liveblog-input-enter\"\n                />\n                <Button\n                  onMouseDown={this.closeLinkModal.bind(this)}\n                  icon=\"no-alt\"\n                  classes=\"liveblog-input-cancel\"\n                />\n              </div>\n            }\n          </div>\n          <Button\n            onMouseDown={this.removeAsLink.bind(this)}\n            icon=\"editor-unlink\"\n            readOnly={readOnly}\n          />\n          <Button\n            onMouseDown={this.addCodeBlock.bind(this)}\n            icon=\"editor-code\"\n            readOnly={readOnly}\n          />\n        </div>\n      </div>\n    );\n  }\n}\n\nToolbar.propTypes = {\n  onChange: PropTypes.func,\n  editorState: PropTypes.object,\n  setReadOnly: PropTypes.func,\n  handleImageUpload: PropTypes.func,\n  readOnly: PropTypes.bool,\n  defaultImageSize: PropTypes.string,\n};\n\nexport default Toolbar;\n","import { EditorState, RichUtils } from 'draft-js';\n\nexport default (editorState, url) => {\n  const contentState = editorState.getCurrentContent();\n  const contentStateWithEntity = contentState.createEntity(\n    'LINK',\n    'MUTABLE',\n    { url },\n  );\n\n  const selection = editorState.getSelection();\n  const newEditorState = EditorState.set(editorState, {\n    currentContent: contentStateWithEntity,\n  });\n\n  return RichUtils.toggleLink(\n    newEditorState,\n    selection,\n    contentStateWithEntity.getLastCreatedEntityKey(),\n  );\n};\n","/* eslint-disable no-return-assign */\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nconst listStyle = {\n  maxHeight: '150px',\n  overflowY: 'scroll',\n  marginBottom: 0,\n};\n\nconst listItemStyle = {\n  height: '30px',\n};\n\nclass Suggestions extends Component {\n  componentDidUpdate(prevProps) {\n    const { autocompleteState, onSearch } = this.props;\n\n    if (!autocompleteState) return;\n\n    if (!prevProps.autocompleteState && autocompleteState) {\n      onSearch(autocompleteState.trigger, autocompleteState.searchText);\n      return;\n    }\n\n    if (prevProps.autocompleteState.searchText !== autocompleteState.searchText) {\n      onSearch(autocompleteState.trigger, autocompleteState.searchText);\n    }\n  }\n\n  renderSuggestions() {\n    const {\n      turnIntoEntity,\n      autocompleteState,\n      renderTemplate,\n      suggestions,\n      setSuggestionIndex,\n    } = this.props;\n\n    return suggestions\n      .map((item, i) =>\n        <li\n          ref={ref => this[`item${i}`] = ref}\n          style={listItemStyle}\n          className={`liveblog-popover-item ${autocompleteState.selectedIndex === i ? 'is-focused' : ''}`}\n          key={i}\n          onMouseDown={() => turnIntoEntity(i)}\n          onMouseEnter={() => setSuggestionIndex(i)}\n          onTouchStart={() => setSuggestionIndex(i)}\n          dangerouslySetInnerHTML={{ __html: renderTemplate(item) }}\n        />,\n      );\n  }\n\n  render() {\n    const { autocompleteState, suggestions } = this.props;\n    if (!autocompleteState) return false;\n\n    const { trigger, searchText, name } = autocompleteState;\n\n    if (suggestions.length === 0) return false;\n\n    return (\n      <div className=\"liveblog-popover\" style={{ top: autocompleteState.top + 10 }}>\n        <div className=\"liveblog-popover-meta\">\n          {suggestions.length} {name}{suggestions.length > 1 ? 's' : ''} matching {'\"'}<b>{trigger}{searchText}</b>{'\"'}\n        </div>\n        <ul ref={ref => this.list = ref} style={listStyle}>\n          {this.renderSuggestions()}\n        </ul>\n      </div>\n    );\n  }\n}\n\nSuggestions.propTypes = {\n  autocompleteState: PropTypes.object,\n  onSearch: PropTypes.func,\n  suggestions: PropTypes.array,\n  turnIntoEntity: PropTypes.func,\n  renderTemplate: PropTypes.func,\n  setSuggestionIndex: PropTypes.func,\n  getEditorRect: PropTypes.func,\n};\n\nexport default Suggestions;\n","/* eslint-disable no-return-assign */\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nimport 'draft-js/dist/Draft.css';\n\nimport {\n  Editor,\n  RichUtils,\n} from 'draft-js';\n\nimport {\n  parseTemplate,\n  getTriggerRange,\n  hasEntityAtSelection,\n  getTopPosition,\n  focusableBlockIsSelected,\n} from './utils';\n\nimport upArrowBinding from './keyBindings/upArrow';\nimport downArrowBinding from './keyBindings/downArrow';\nimport returnBinding from './keyBindings/returnBinding';\nimport keyBindingFunc from './keyBindings/keyBindingFunc';\n\nimport addAutocomplete from './modifiers/addAutocomplete';\nimport addAtomicBlock from './modifiers/addAtomicBlock';\nimport moveBlock from './modifiers/moveBlock';\nimport skipOverEntity from './modifiers/skipOverEntity';\nimport addNewLine from './modifiers/addNewLine';\n\nimport blockRenderer from './blocks/blockRenderer';\nimport Toolbar from './Toolbar';\nimport Suggestions from './Suggestions';\n\nclass EditorWrapper extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      autocompleteState: null,\n    };\n  }\n\n  /**\n   * If focus is set to a block on mount, set the selection to\n   * just after it for a better UX. This can happen in an edge case\n   * when there is a block at the top of the content when we are converting\n   * from HTML to the editor.\n   */\n  componentDidMount() {\n    const { onChange, editorState } = this.props;\n\n    if (focusableBlockIsSelected(editorState)) {\n      onChange(\n        addNewLine(editorState),\n      );\n    }\n  }\n\n  /**\n   * Hook into updating the editor state so we can check for any triggers\n   * for the autocomplete every time the editor state is updated.\n   */\n  updateEditorState(editorState) {\n    const { onChange, resetSuggestions, suggestions } = this.props;\n\n    onChange(\n      editorState,\n    );\n\n    // Wait until the state has been updated.\n    setTimeout(() => {\n      // Fix for selection getting 'stuck' in emoji as you have to pass through each character.\n      const entity = hasEntityAtSelection(editorState);\n      if (entity) {\n        if (entity.getType() === ':') {\n          onChange(\n            skipOverEntity(editorState, entity),\n          );\n        }\n      }\n\n      // Check for any triggers.\n      const autocompleteState = this.getAutocompleteState();\n      // Prevent any bugs from happing when two commands are inputted next to each other.\n      if (\n        autocompleteState &&\n        this.state.autocompleteState &&\n        suggestions.length > 0 &&\n        this.state.autocompleteState.trigger !== autocompleteState.trigger\n      ) {\n        resetSuggestions();\n      }\n      // Reset suggestions on state refresh.\n      if (!autocompleteState && suggestions.length > 0) resetSuggestions();\n      // Update the autocomplete state, will be null if no triggers.\n      this.setState({ autocompleteState });\n    }, 0);\n  }\n\n  /**\n  * Down Arrow Binding\n  * @param {event} event\n  */\n  onDownArrow(event) {\n    const { autocompleteState } = this.state;\n    const { editorState, onChange, suggestions } = this.props;\n    return downArrowBinding(\n      editorState,\n      autocompleteState,\n      onChange,\n      this.setState.bind(this),\n      event,\n      this.suggestions,\n      suggestions,\n    );\n  }\n\n  /**\n   * Up Arrow Binding\n   * @param {event} event\n   */\n  onUpArrow(event) {\n    const { autocompleteState } = this.state;\n    const { editorState, onChange } = this.props;\n    return upArrowBinding(\n      editorState,\n      autocompleteState,\n      onChange,\n      this.setState.bind(this),\n      event,\n      this.suggestions,\n    );\n  }\n\n  /**\n   * Escape arrow binding\n   * @param {event} event\n   */\n  onEscape(event) {\n    const { autocompleteState } = this.state;\n    if (!autocompleteState) return 'not-handled';\n    event.preventDefault();\n    this.setState({ autocompleteState: null });\n    return 'handled';\n  }\n\n  /**\n   * Return arrow binding\n   * @param {event} event\n   */\n  handleReturn(event) {\n    const { autocompleteState } = this.state;\n    const { suggestions, onChange, editorState } = this.props;\n\n    return returnBinding(\n      editorState,\n      autocompleteState,\n      onChange,\n      event,\n      suggestions,\n      this.turnSuggestionIntoEntity.bind(this),\n    );\n  }\n\n  /**\n   * Handle getting the autocompletestate.\n   */\n  getAutocompleteState() {\n    const { autocompleteConfig, editorState } = this.props;\n    // If we are already selecting an entity bail, we don't need to trigger anything.\n    if (hasEntityAtSelection(editorState)) return null;\n    // Get the trigger range from when the trigger is fired to where the user is typing.\n    const range = getTriggerRange(autocompleteConfig.map(x => x.trigger));\n    // If range doesn't exist or contains a space then bail.\n    if (!range || /\\s/g.test(range.text)) return null;\n\n    const trigger = range.text.charAt(0);\n    const config = autocompleteConfig.filter(x => x.trigger === trigger)[0];\n    // Any data we need for autocompleting should be passed to state here as this will\n    // always be the reference to the current autocomplete state.\n    return {\n      ...range,\n      trigger,\n      top: getTopPosition(range, this.editor.editorContainer),\n      displayKey: config.displayKey,\n      replaceText: config.replaceText,\n      name: config.name,\n      searchText: range.text.slice(1, range.text.length),\n      selectedIndex: 0,\n    };\n  }\n\n  /**\n   * If there is a selected entity we replace the current autocomplete range with\n   * a suggestion.\n   */\n  turnSuggestionIntoEntity(index = false) {\n    const { autocompleteState } = this.state;\n    const { editorState, suggestions, autocompleteConfig } = this.props;\n    // Get the current selected suggestion and bail if it doesn't exist.\n    let suggestionIndex = autocompleteState.selectedIndex;\n    if (index || index === 0) suggestionIndex = index;\n    const suggestion = suggestions[suggestionIndex];\n    if (!suggestion) return;\n\n    const config = autocompleteConfig.filter(x => x.trigger === autocompleteState.trigger)[0];\n\n    this.updateEditorState(\n      addAutocomplete(editorState, autocompleteState, suggestion, config),\n    );\n\n    // Sometimes the popup triggers again after setting an entity\n    // We reset it to make sure this will never happen.\n    this.setState({ autocompleteState: null });\n  }\n\n  /**\n   * Probably need a better way of handling this but it works for now. We render the suggestion\n   * template based on the config passed. Probably better to use a React component but will need to\n   * rethink how that will work.\n   */\n  renderTemplate(item) {\n    const { autocompleteConfig } = this.props;\n    const { trigger } = this.state.autocompleteState;\n    const config = autocompleteConfig.filter(x => x.trigger === trigger)[0];\n    if (!config.template) return item;\n    return parseTemplate(config.template, item, '');\n  }\n\n  /**\n   * Handle Image upload on drop. We bail for any other files.\n   */\n  handleDroppedFiles(selection, files) {\n    const { handleImageUpload, editorState, setReadOnly, defaultImageSize } = this.props;\n    if (!files[0].name.match(/.(jpg|jpeg|png|gif)$/i)) return;\n\n    this.updateEditorState(\n      addAtomicBlock(editorState, false, {}, 'placeholder'),\n    );\n\n    handleImageUpload(files[0]).then((src) => {\n      this.updateEditorState(\n        addAtomicBlock(\n          editorState,\n          false,\n          {\n            setReadOnly,\n            image: src,\n            edit: false,\n            handleImageUpload,\n            defaultImageSize,\n          },\n          'media',\n        ),\n      );\n    });\n  }\n\n  /**\n   * Draft doesn't handle certain commands by default as it generally expects\n   * you to implement your own. However you can enable some default behavior\n   * by using RichUtils.handleKeyCommand()\n   */\n  handleKeyCommand(command) {\n    if (command === 'handled') return 'handled';\n    const { editorState } = this.props;\n    const newState = RichUtils.handleKeyCommand(editorState, command);\n    if (newState) {\n      this.updateEditorState(newState);\n      return 'handled';\n    }\n    return 'not-handled';\n  }\n\n  /**\n  * If a draft block is dropped handle its reposition to the new selection. Annoyingly this\n  * event never gets fired in IE11 and it silently fails. This issue has been documented\n  * so hopefully will be resolved soon.\n  * https://github.com/facebook/draft-js/issues/1174\n  */\n  handleDrop(selection, dataTransfer, location) {\n    if (location === 'external') return 'handled';\n    let handled = 'not-handled';\n    const raw = dataTransfer.data.getData('text');\n    const data = raw ? raw.split(':') : [];\n    if (data.length !== 2) return 'not-handled';\n    if (data[0] === 'DRAFT_BLOCK') {\n      const { editorState } = this.props;\n      const blockKey = data[1];\n      this.updateEditorState(\n        moveBlock(editorState, blockKey, selection),\n      );\n      handled = 'handled';\n    }\n\n    /**\n     * Fix for an issue where drop breaks onChange. There is an open\n     * pull request which fixes the issue which means we will no longer\n     * need this once this has been merged.\n     * https://github.com/facebook/draft-js/issues/1383\n     */\n    const mouseUpEvent = new MouseEvent('mouseup', {\n      view: window,\n      bubbles: true,\n      cancelable: true,\n    });\n    this.editor.editor.dispatchEvent(mouseUpEvent);\n    return handled;\n  }\n\n  render() {\n    const { autocompleteState } = this.state;\n\n    const {\n      editorState,\n      onChange,\n      suggestions,\n      onSearch,\n      readOnly,\n      setReadOnly,\n      handleImageUpload,\n      defaultImageSize,\n    } = this.props;\n\n    return (\n      <div className=\"liveblog-editor-inner-container\" onDrop={(event) => {\n        // Fix for Draft Bug not always correctly handling handleDrop\n        if (!event.target.isContentEditable) event.preventDefault();\n      }}>\n        <Toolbar\n          editor={this.editor}\n          editorState={editorState}\n          onChange={onChange}\n          handleImageUpload={handleImageUpload}\n          setReadOnly={setReadOnly}\n          readOnly={readOnly}\n          defaultImageSize={defaultImageSize}\n        />\n        <div style={{ position: 'relative' }} >\n          <Editor\n            editorState={editorState}\n            onChange={this.updateEditorState.bind(this)}\n            blockRendererFn={block => blockRenderer(block, editorState, onChange)}\n            ref={node => this.editor = node}\n            onDownArrow={this.onDownArrow.bind(this)}\n            onUpArrow={this.onUpArrow.bind(this)}\n            onEscape={this.onEscape.bind(this)}\n            handleReturn={this.handleReturn.bind(this)}\n            handleDroppedFiles={this.handleDroppedFiles.bind(this)}\n            handleDrop={this.handleDrop.bind(this)}\n            handleKeyCommand={this.handleKeyCommand.bind(this)}\n            keyBindingFn={event => keyBindingFunc(event, editorState, onChange)}\n            spellCheck={true}\n            readOnly={readOnly}\n          />\n          <Suggestions\n            turnIntoEntity={index => this.turnSuggestionIntoEntity(index)}\n            autocompleteState={autocompleteState}\n            suggestions={suggestions}\n            renderTemplate={item => this.renderTemplate(item)}\n            onSearch={(trigger, text) => onSearch(trigger, text)}\n            setSuggestionIndex={i =>\n              this.setState({\n                autocompleteState: {\n                  ...autocompleteState,\n                  selectedIndex: i,\n                },\n              })\n            }\n            ref={node => this.suggestions = node}\n          />\n        </div>\n      </div>\n    );\n  }\n}\n\nEditorWrapper.propTypes = {\n  onChange: PropTypes.func,\n  resetSuggestions: PropTypes.func,\n  suggestions: PropTypes.array,\n  autocompleteConfig: PropTypes.array,\n  editorState: PropTypes.object,\n  onSearch: PropTypes.func,\n  handleImageUpload: PropTypes.func,\n  readOnly: PropTypes.bool,\n  setReadOnly: PropTypes.func,\n  defaultImageSize: PropTypes.string,\n};\n\nexport default EditorWrapper;\n","import { EditorState } from 'draft-js';\n\nexport default (editorState, entity) => {\n  const selection = editorState.getSelection();\n  const { startOffset, endOffset } = entity.getData();\n  const currentSelection = selection.getStartOffset();\n  let position = false;\n\n  if (currentSelection === (startOffset + 1)) {\n    position = endOffset;\n  }\n\n  if (currentSelection === (endOffset - 1)) {\n    position = startOffset;\n  }\n\n  if (position || position === 0) {\n    return EditorState.forceSelection(editorState, selection.merge({\n      anchorOffset: position,\n      focusOffset: position,\n    }));\n  }\n\n  return editorState;\n};\n","import { scrollElementIfNotInView, focusableBlockIsSelected } from '../utils';\nimport setSelection from '../modifiers/setSelection';\n\nexport default (\n  editorState,\n  autocompleteState,\n  onChange,\n  setState,\n  event,\n  suggestionsNode,\n  suggestions,\n) => {\n  if (!autocompleteState) {\n    const contentState = editorState.getCurrentContent();\n    const currentSelection = editorState.getSelection();\n    const startKey = currentSelection.getStartKey();\n    const blockAfter = contentState.getBlockAfter(startKey);\n    /*\n    * If next block or a block is selected we want to handle the\n    * selection ourselves so we can add focus to a block if necessary.\n    */\n    if (\n      (blockAfter && blockAfter.getType() === 'atomic') ||\n      focusableBlockIsSelected(editorState)\n    ) {\n      setSelection(editorState, onChange, 'down', event);\n      return 'handled';\n    }\n\n    return 'not-handled';\n  }\n\n  event.preventDefault();\n  const selectedIndex = autocompleteState.selectedIndex;\n  const newIndex = selectedIndex + 1;\n\n  setState({\n    autocompleteState: {\n      ...autocompleteState,\n      selectedIndex: (selectedIndex >= suggestions.length - 1)\n        ? selectedIndex\n        : newIndex,\n    },\n  });\n\n  const selectedSuggestionDomNode = suggestionsNode[`item${newIndex}`];\n  if (!selectedSuggestionDomNode) return 'handled';\n\n  scrollElementIfNotInView(\n    selectedSuggestionDomNode,\n    suggestionsNode.list,\n  );\n\n  return 'handled';\n};\n","import { scrollElementIfNotInView, focusableBlockIsSelected } from '../utils';\nimport setSelection from '../modifiers/setSelection';\n\nexport default (\n  editorState,\n  autocompleteState,\n  onChange,\n  setState,\n  event,\n  suggestionsNode,\n) => {\n  if (!autocompleteState) {\n    const contentState = editorState.getCurrentContent();\n    const currentSelection = editorState.getSelection();\n    const startKey = currentSelection.getStartKey();\n    const blockBefore = contentState.getBlockBefore(startKey);\n\n    /*\n    * If previous block or a block is selected we want to handle the\n    * selection ourselves so we can add focus to a block if necessary.\n    */\n    if (\n      (blockBefore && blockBefore.getType() === 'atomic') ||\n      focusableBlockIsSelected(editorState)\n    ) {\n      setSelection(editorState, onChange, 'up', event);\n      return 'handled';\n    }\n\n    return 'not-handled';\n  }\n\n  event.preventDefault();\n\n  const selectedIndex = autocompleteState.selectedIndex;\n  const newIndex = Math.max(selectedIndex - 1, 0);\n\n  setState({\n    autocompleteState: {\n      ...autocompleteState,\n      selectedIndex: newIndex,\n    },\n  });\n\n  const selectedSuggestionDomNode = suggestionsNode[`item${newIndex}`];\n  if (!selectedSuggestionDomNode) return 'handled';\n\n  scrollElementIfNotInView(\n    selectedSuggestionDomNode,\n    suggestionsNode.list,\n  );\n\n  return 'handled';\n};\n","import { focusableBlockIsSelected } from '../utils';\nimport addNewLine from '../modifiers/addNewLine';\n\nexport default (\n  editorState,\n  autocompleteState,\n  onChange,\n  event,\n  suggestions,\n  turnSuggestionIntoEntity,\n) => {\n  if (\n    autocompleteState ||\n    (suggestions.length > 0 && suggestions[autocompleteState.selectedIndex])\n  ) {\n    event.preventDefault();\n    turnSuggestionIntoEntity();\n    return 'handled';\n  }\n\n  if (focusableBlockIsSelected(editorState)) {\n    onChange(\n      addNewLine(editorState),\n    );\n    return 'handled';\n  }\n\n  return 'not-handled';\n};\n","import {\n  EditorState,\n  Modifier,\n} from 'draft-js';\n\nimport {\n  getInsertRange,\n} from '../utils';\n\nexport default (editorState, autocompleteState, suggestion, extraData) => {\n  // Get the selection we want to replace with an entity.\n  const { start, end } = getInsertRange(autocompleteState, editorState);\n\n  const currentSelectionState = editorState.getSelection();\n  const selection = currentSelectionState.merge({\n    anchorOffset: start,\n    focusOffset: end,\n  });\n\n  const contentState = editorState.getCurrentContent();\n\n  let replaceText = autocompleteState.displayKey\n    ? suggestion[autocompleteState.displayKey]\n    : suggestion;\n\n  replaceText = autocompleteState.replaceText.replace('$', replaceText);\n\n  // Create an enitity to place within the content.\n  const contentStateWithEntity = contentState.createEntity(\n    autocompleteState.trigger,\n    'IMMUTABLE',\n    {\n      trigger: autocompleteState.trigger,\n      suggestion,\n      extraData,\n      startOffset: start,\n      endOffset: start + replaceText.length,\n    },\n  );\n\n  // Replace with enitity using template from config.\n  const entityKey = contentStateWithEntity.getLastCreatedEntityKey();\n  let newContentState = Modifier.replaceText(\n    contentState,\n    selection,\n    replaceText,\n    null,\n    entityKey,\n  );\n\n  // If its at the end we insert it with a space after for a nicer ux.\n  const blockKey = selection.getAnchorKey();\n  const blockSize = contentState.getBlockForKey(blockKey).getLength();\n\n  if (blockSize === end) {\n    newContentState = Modifier.insertText(\n      newContentState,\n      newContentState.getSelectionAfter(),\n      ' ',\n    );\n  }\n\n  const newEditorState = EditorState.push(\n    editorState,\n    newContentState,\n    `insert-${autocompleteState.trigger}`,\n  );\n\n  // Return the new editor state with the entity.\n  return EditorState.forceSelection(\n    newEditorState,\n    newContentState.getSelectionAfter(),\n  );\n};\n","import Image from './Image';\nimport Placeholder from './Placeholder';\nimport CodeBlock from './CodeBlock';\nimport CreateBlock from './CreateBlockHOC';\nimport Media from './Media';\n\nexport default (block, editorState, onChange) => {\n  if (block.getType() === 'atomic') {\n    const contentState = editorState.getCurrentContent();\n    const entity = contentState.getEntity(block.getEntityAt(0));\n    const type = entity.getType();\n    const isFocused = editorState.getSelection().getStartKey() === block.getKey();\n\n    if (type === 'image') {\n      return {\n        component: CreateBlock(Image, editorState, onChange),\n        editable: false,\n        props: {\n          isFocused,\n        },\n      };\n    }\n    if (type === 'code-block') {\n      return {\n        component: CreateBlock(CodeBlock, editorState, onChange),\n        editable: false,\n        props: {\n          isFocused,\n        },\n      };\n    }\n    if (type === 'media') {\n      return {\n        component: CreateBlock(Media, editorState, onChange),\n        editable: false,\n        props: {\n          isFocused,\n        },\n      };\n    }\n    if (type === 'placeholder') {\n      return {\n        component: Placeholder,\n        editable: false,\n      };\n    }\n  }\n\n  return null;\n};\n\n","import { getDefaultKeyBinding, EditorState } from 'draft-js';\nimport { focusableBlockIsSelected } from '../utils';\nimport setSelection from '../modifiers/setSelection';\nimport removeBlock from '../modifiers/removeBlock';\n\nexport default (event, editorState, onChange) => {\n  const isLeftPress = event.keyCode === 37;\n  const isRightPress = event.keyCode === 39;\n  const isBackspacePress = event.keyCode === 8;\n\n  if (focusableBlockIsSelected(editorState)) {\n    if (isLeftPress) {\n      setSelection(editorState, onChange, 'up', event);\n      return 'handled';\n    }\n\n    if (isRightPress) {\n      setSelection(editorState, onChange, 'down', event);\n      return 'handled';\n    }\n\n    if (isBackspacePress) {\n      const content = editorState.getCurrentContent();\n      const block = content.getBlockForKey(editorState.getSelection().getAnchorKey());\n      const contentAfterRemove = removeBlock(content, block.getKey());\n\n      onChange(\n        EditorState.forceSelection(\n          EditorState.push(editorState, contentAfterRemove, 'remove-block'),\n          contentAfterRemove.getSelectionAfter(),\n        ),\n      );\n\n      return 'handled';\n    }\n\n    return 'handled';\n  }\n\n  if (isLeftPress || isBackspacePress) {\n    const selection = editorState.getSelection();\n    const anchorKey = selection.getStartKey();\n    const content = editorState.getCurrentContent();\n    const blockBefore = content.getBlockBefore(anchorKey);\n    if (blockBefore && selection.getAnchorOffset() === 0 && blockBefore.getType() === 'atomic') {\n      setSelection(editorState, onChange, 'up', event);\n      return 'handled';\n    }\n  }\n\n  if (isRightPress) {\n    const selection = editorState.getSelection();\n    const anchorKey = selection.getAnchorKey();\n    const currentBlock = editorState.getCurrentContent().getBlockForKey(anchorKey);\n    const blockAfter = editorState.getCurrentContent().getBlockAfter(anchorKey);\n    if (\n      blockAfter &&\n      currentBlock.getLength() === selection.getFocusOffset() &&\n      blockAfter.getType() === 'atomic'\n    ) {\n      setSelection(editorState, onChange, 'down', event);\n      return 'handled';\n    }\n  }\n\n  return getDefaultKeyBinding(event);\n};\n\n","/**\n * Tags that aren't currently supported by the renderer,\n * but makes sense to insert into the code block ui for a better user experience.\n */\nexport const CODE_BLOCK_TAGS = [\n  'audio',\n  'video',\n  'embed',\n  'object',\n  'canvas',\n  'table',\n  'form',\n  'div',\n  'section',\n  'iframe',\n  'details',\n];\n\n/**\n * Text tags should always be mapped to a mutable entity, meaning they won't\n * be overwritten by draft if added in raw text edit mode.\n */\nexport const TEXT_TAGS = [\n  'h1',\n  'h2',\n  'h3',\n  'h4',\n  'h5',\n  'h6',\n  'figcaption',\n  'abbr',\n  'b',\n  'bdi',\n  'bdo',\n  'code',\n  'dfn',\n  'i',\n  'kbd',\n  'mark',\n  'q',\n  'rt',\n  's',\n  'samp',\n  'small',\n  'big',\n  'span',\n  'strong',\n  'sub',\n  'sup',\n  'time',\n  'u',\n  'var',\n  'wbr',\n  'del',\n  'ins',\n  'blink',\n  'font',\n  'em',\n  'bold',\n  'br',\n  'cite',\n];\n\n/**\n * @IMPORTANT Any children tags of tags that should be rendered as a code block should be ignored.\n * Tags to ignore completely by the renderer.\n * These may either need custom support or doesn't make sense to use.\n */\nexport const IGNORED_TAGS = [\n  'head',\n  'script',\n  'track',\n  'nav',\n  'source',\n  'param',\n  'noscript', // this would never render anyway\n  'caption',\n  'col',\n  'colgroup',\n  'tbody',\n  'td',\n  'tfoot',\n  'th',\n  'thead',\n  'tr',\n  'input',\n  'datalist',\n  'fieldset',\n  'frameset',\n  'frame',\n  'label',\n  'textarea',\n  'label',\n  'legend',\n  'meter',\n  'optgroup',\n  'option',\n  'output',\n  'progress',\n  'select',\n  'diaglog',\n  'menu',\n  'menuitem',\n  'summary',\n];\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\nconst Link = ({ entityKey, children, contentState }) => {\n  const { url } = contentState.getEntity(entityKey).getData();\n  return (\n    <a href={url}>{children}</a>\n  );\n};\n\nLink.propTypes = {\n  entityKey: PropTypes.any,\n  children: PropTypes.any,\n  contentState: PropTypes.any,\n};\n\nexport default Link;\n\nexport const findLinkEntities = (contentBlock, callback, contentState) => {\n  contentBlock.findEntityRanges(\n    (character) => {\n      const entityKey = character.getEntity();\n      return (\n        entityKey !== null &&\n        contentState.getEntity(entityKey).getType() === 'LINK'\n      );\n    },\n    callback,\n  );\n};\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\nconst Emoji = ({ children, entityKey, contentState }) => {\n  const { suggestion, extraData } = contentState.getEntity(entityKey).getData();\n  const backgroundImage = `url(${extraData.cdn}${suggestion.image}.png)`;\n\n  return (\n    <span className=\"liveblog-inline-emoji\" style={{ backgroundImage }}>\n      {children}\n    </span>\n  );\n};\n\nEmoji.propTypes = {\n  children: PropTypes.any,\n  contentState: PropTypes.object,\n  entityKey: PropTypes.string,\n};\n\nexport default Emoji;\n\nexport const findEmojiEntities = (contentBlock, callback, contentState) => {\n  contentBlock.findEntityRanges(\n    (character) => {\n      const entityKey = character.getEntity();\n      return (\n        entityKey !== null &&\n        contentState.getEntity(entityKey).getType() === ':'\n      );\n    },\n    callback,\n  );\n};\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\nconst Text = ({ children, entityKey, contentState }) => {\n  const { nodeName, attributes } = contentState.getEntity(entityKey).getData();\n\n  return React.createElement(\n    nodeName,\n    attributes,\n    children,\n  );\n};\n\nText.propTypes = {\n  children: PropTypes.any,\n  contentState: PropTypes.object,\n  entityKey: PropTypes.string,\n};\n\nexport default Text;\n\nexport const findTextEntities = (contentBlock, callback, contentState) => {\n  contentBlock.findEntityRanges(\n    (character) => {\n      const entityKey = character.getEntity();\n      return (\n        entityKey !== null &&\n        contentState.getEntity(entityKey).getType() === 'TEXT'\n      );\n    },\n    callback,\n  );\n};\n","import Link, { findLinkEntities } from './Link';\nimport Emoji, { findEmojiEntities } from './Emoji';\nimport Text, { findTextEntities } from './Text';\n\nexport default [\n  {\n    strategy: findLinkEntities,\n    component: Link,\n  },\n  {\n    strategy: findEmojiEntities,\n    component: Emoji,\n  },\n  {\n    strategy: findTextEntities,\n    component: Text,\n  },\n];\n","import { CompositeDecorator } from 'draft-js';\n\nimport Editor from './Editor';\nimport HTMLConvertFrom from './convertFromHTML';\nimport HTMLConvertTo from './convertToHTML';\nimport decoratorsArray from './decorators/decorators';\n\nexport const decorators = new CompositeDecorator(decoratorsArray);\nexport const convertFromHTML = HTMLConvertFrom;\nexport const convertToHTML = HTMLConvertTo;\n\nexport default Editor;\n","/* eslint-disable consistent-return */\nimport { convertFromHTML } from 'draft-convert';\nimport { CODE_BLOCK_TAGS, IGNORED_TAGS, TEXT_TAGS } from './HTMLtags';\nimport { namedNodeMapToObject } from './utils';\n\nexport default (html, extraData) =>\n  convertFromHTML({\n    htmlToEntity: (nodeName, node, createEntity) => {\n      if (nodeName === 'a') {\n        return createEntity(\n          'LINK',\n          'MUTABLE',\n          { url: node.href },\n        );\n      }\n\n      if (TEXT_TAGS.includes(nodeName)) {\n        return createEntity(\n          'TEXT',\n          'MUTABLE',\n          {\n            nodeName,\n            attributes: namedNodeMapToObject(node.attributes),\n          },\n        );\n      }\n\n      if (nodeName === 'img') {\n        return createEntity(\n          'media',\n          'IMMUTABLE',\n          {\n            setReadOnly: extraData.setReadOnly,\n            image: node.src,\n            edit: false,\n            handleImageUpload: extraData.handleImageUpload,\n            defaultImageSize: extraData.defaultImageSize,\n          },\n        );\n      }\n\n      const isHTMLBlock = node.id && node.id.includes('liveblog-codeblock-identifier-');\n\n      if (\n        isHTMLBlock ||\n        CODE_BLOCK_TAGS.includes(nodeName)\n      ) {\n        return createEntity(\n          'code-block',\n          'IMMUTABLE',\n          {\n            code: isHTMLBlock ? node.innerHTML : node.outerHTML,\n            title: isHTMLBlock\n              ? node.id.replace('liveblog-codeblock-identifier-', '').replace('-', ' ')\n              : nodeName,\n            setReadOnly: extraData.setReadOnly,\n          },\n        );\n      }\n    },\n\n    htmlToBlock: (nodeName, node) => {\n      if (nodeName === 'p' && node.innerHTML === '') {\n        return false;\n      }\n\n      if (IGNORED_TAGS.includes(nodeName)) {\n        return false;\n      }\n\n      if (\n        nodeName === 'img' ||\n        (node.id && node.id.includes('liveblog-codeblock-identifier-')) ||\n        CODE_BLOCK_TAGS.includes(nodeName)\n      ) {\n        return 'atomic';\n      }\n    },\n\n    textToEntity: (text, createEntity) => {\n      const result = [];\n\n      const emojis = window.liveblog_settings.autocomplete[1].data;\n      const cdn = window.liveblog_settings.autocomplete[1].cdn;\n\n      text.replace(/:(\\w+):/g, (match, name, offset) => {\n        const emoji = emojis.filter(x =>\n          match.replace(/:/g, '') === x.key.toString(),\n        )[0];\n\n        const entityKey = createEntity(\n          ':',\n          'IMMUTABLE',\n          {\n            trigger: ':',\n            suggestion: { image: emoji.image },\n            extraData: { cdn },\n          },\n        );\n\n        result.push({\n          entity: entityKey,\n          offset,\n          length: match.length,\n          result: match,\n        });\n      });\n\n      return result;\n    },\n\n  })(html);\n","/* eslint-disable consistent-return */\n/* eslint-disable react/display-name */\n\nimport React from 'react';\nimport { convertToHTML } from 'draft-convert';\n\nexport default contentState =>\n  convertToHTML({\n    styleToHTML: () => {},\n    blockToHTML: (block) => {\n      if (block.type === 'atomic') {\n        const currentBlock = contentState.getBlockForKey(block.key);\n        const entity = contentState.getEntity(currentBlock.getEntityAt(0));\n        const type = entity.getType();\n\n        if (type === 'image') {\n          return <img src={entity.getData().src} />;\n        }\n\n        if (type === 'code-block') {\n          return (\n            <div>\n              <div\n                id={`liveblog-codeblock-identifier-${entity.getData().title.replace(/\\s+/g, '-')}`}\n                dangerouslySetInnerHTML={{ __html: entity.getData().code }}\n              />\n            </div>\n          );\n        }\n\n        if (type === 'media') {\n          return <img src={entity.getData().image} />;\n        }\n      }\n      if (block.type === 'unordered-list-item') {\n        return {\n          start: '<li>',\n          end: '</li>',\n          nestStart: '<ul>',\n          nestEnd: '</ul>',\n        };\n      }\n      if (block.type === 'ordered-list-item') {\n        return {\n          start: '<li>',\n          end: '</li>',\n          nestStart: '<ol>',\n          nestEnd: '</ol>',\n        };\n      }\n      if (block.type === 'unstyled') {\n        return <p />;\n      }\n      return <span />;\n    },\n    entityToHTML: (entity, originalText) => {\n      if (entity.type === 'LINK') {\n        return <a href={entity.data.url}>{originalText}</a>;\n      }\n      if (entity.type === 'TEXT') {\n        return React.createElement(\n          entity.data.nodeName,\n          entity.data.attributes,\n          originalText,\n        );\n      }\n      return originalText;\n    },\n  })(contentState);\n","/* eslint-disable no-return-assign */\n/* eslint-disable react/prop-types */\n\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport { AsyncPaginate as Async } from 'react-select-async-paginate';\nimport { html } from 'js-beautify';\nimport { debounce } from 'lodash-es';\nimport { timeout, map } from 'rxjs/operators';\n\nimport { EditorState, ContentState } from 'draft-js';\n\nimport * as apiActions from '../actions/apiActions';\nimport * as userActions from '../actions/userActions';\n\nimport { getAuthors, getHashtags, uploadImage } from '../services/api';\n\nimport PreviewContainer from './PreviewContainer';\nimport AuthorSelectOption from '../components/AuthorSelectOption';\nimport HTMLInput from '../components/HTMLInput';\n\nimport Editor, { decorators, convertFromHTML, convertToHTML } from '../Editor/index';\n\nimport { getImageSize } from '../Editor/utils';\n\nclass EditorContainer extends Component {\n  constructor(props) {\n    super(props);\n\n    let initialEditorState;\n    let initialAuthors;\n\n    if (props.entry) {\n      initialEditorState = EditorState.createWithContent(\n        convertFromHTML(props.entry.content, {\n          setReadOnly: this.setReadOnly.bind(this),\n          handleImageUpload: this.handleImageUpload.bind(this),\n          defaultImageSize: props.config.default_image_size,\n        }),\n        decorators,\n      );\n      initialAuthors = props.entry.authors;\n    } else {\n      initialEditorState = EditorState.createEmpty(decorators);\n      initialAuthors = [props.config.current_user];\n    }\n\n    this.state = {\n      editorState: initialEditorState,\n      suggestions: [],\n      authors: initialAuthors,\n      mode: 'editor',\n      readOnly: false,\n      rawText: props.entry ? props.entry.content : '',\n    };\n\n    this.onChange = editorState => this.setState({\n      editorState,\n      rawText: html(convertToHTML(editorState.getCurrentContent())),\n    });\n\n    // Note: getUsers must return a Promise for react-select-async-paginate\n    // Debouncing is handled by the library itself, so we don't debounce here\n  }\n\n  setReadOnly(state) {\n    this.setState({\n      readOnly: state,\n    });\n  }\n\n  getContent() {\n    const { editorState } = this.state;\n    return convertToHTML(editorState.getCurrentContent());\n  }\n\n  syncRawTextToEditorState() {\n    this.setState({\n      editorState:\n        EditorState.createWithContent(\n          convertFromHTML(this.state.rawText, {\n            setReadOnly: this.setReadOnly.bind(this),\n            handleImageUpload: this.handleImageUpload.bind(this),\n            defaultImageSize: this.props.config.default_image_size,\n          }),\n          decorators,\n        ),\n    });\n  }\n\n  publish() {\n    const { updateEntry, entry, entryEditClose, createEntry, isEditing } = this.props;\n    const { editorState, authors } = this.state;\n    const content = this.getContent();\n    const authorIds = authors.map(author => author.id);\n    const author = authorIds.length > 0 ? authorIds[0] : false;\n    const contributors = authorIds.length > 1 ? authorIds.slice(1, authorIds.length) : false;\n    const htmlregex = /<(img|picture|video|audio|canvas|svg|iframe|embed) ?.*>/;\n\n    // We don't want an editor publishing empty entries\n    // So we must check if there is any text within the editor\n    // If we fail to find text then we should check for a valid\n    // list of html elements, mainly visual for example images.\n    if (!editorState.getCurrentContent().getPlainText().trim()) {\n      if (htmlregex.exec(convertToHTML(editorState.getCurrentContent())) === null) {\n        return;\n      }\n    }\n\n    if (isEditing) {\n      updateEntry({\n        id: entry.id,\n        content,\n        author,\n        contributors,\n      });\n      entryEditClose(entry.id);\n      return;\n    }\n\n    createEntry({\n      content,\n      author,\n      contributors,\n    });\n\n    const newEditorState = EditorState.push(\n      editorState,\n      ContentState.createFromText(''),\n    );\n\n    this.onChange(newEditorState);\n    this.setState({ readOnly: false });\n  }\n\n  onSelectAuthorChange(value) {\n    this.setState({\n      authors: value,\n    });\n  }\n\n  getUsers(text) {\n    const { config } = this.props;\n\n    // Handle empty text - return empty options immediately\n    if (!text || text.trim() === '') {\n      return Promise.resolve({ options: [] });\n    }\n\n    return new Promise((resolve) => {\n      getAuthors(text, config)\n        .pipe(\n          timeout(10000),\n          map(res => res.response),\n        )\n        .subscribe({\n          next: res => resolve({ options: res || [] }),\n          error: err => {\n            // Fail gracefully with empty options on error (e.g., 401)\n            console.warn('Authors API error:', err);\n            resolve({ options: [] });\n          },\n        });\n    });\n  }\n\n  getAuthors(text) {\n    const { config } = this.props;\n    getAuthors(text, config)\n      .pipe(\n        timeout(10000),\n        map(res => res.response),\n      )\n      .subscribe(res => this.setState({\n        suggestions: res.map(author => author),\n      }));\n  }\n\n  getHashtags(text) {\n    const { config } = this.props;\n    getHashtags(text, config)\n      .pipe(\n        timeout(10000),\n        map(res => res.response),\n      )\n      .subscribe(res => this.setState({\n        suggestions: res.map(hashtag => hashtag),\n      }));\n  }\n\n  filterCommandSuggestions(suggestions, filter) {\n    this.setState({\n      suggestions: suggestions.filter(item =>\n        item.substring(0, filter.length) === filter,\n      ),\n    });\n  }\n\n  filterEmojiSuggestions(suggestions, filter) {\n    this.setState({\n      suggestions: suggestions.filter(item =>\n        item.key.toString().substring(0, filter.length) === filter,\n      ),\n    });\n  }\n\n  handleOnSearch(trigger, text) {\n    const { config } = this.props;\n\n    switch (trigger) {\n      case '@':\n        this.getAuthors(text);\n        break;\n      case '#':\n        this.getHashtags(text);\n        break;\n      case '/':\n        this.filterCommandSuggestions(config.autocomplete[0].data, text);\n        break;\n      case ':':\n        this.filterEmojiSuggestions(config.autocomplete[1].data, text);\n        break;\n      default:\n        this.setState({ suggestions: [] });\n        break;\n    }\n  }\n\n  handleImageUpload(file) {\n    const { config } = this.props;\n\n    const formData = new FormData();\n    formData.append('name', file.name);\n    formData.append('action', 'upload-attachment');\n    formData.append('_wpnonce', config.image_nonce);\n    formData.append('async-upload', file);\n\n    return new Promise((resolve) => {\n      uploadImage(formData)\n        .timeout(60000)\n        .map(res => res.response)\n        .subscribe((res) => {\n          const src = getImageSize(res.data.sizes, config.default_image_size);\n          resolve(src);\n        });\n    });\n  }\n\n  render() {\n    const {\n      editorState,\n      suggestions,\n      mode,\n      authors,\n      readOnly,\n    } = this.state;\n\n    const { isEditing, config } = this.props;\n\n    return (\n      <div className=\"liveblog-editor-container\">\n        {!isEditing && <h1 className=\"liveblog-editor-title\">Add New Entry</h1>}\n        <div className=\"liveblog-editor-tabs\">\n          <button\n            className={`liveblog-editor-tab ${mode === 'editor' ? 'is-active' : ''}`}\n            onClick={() => this.setState({ mode: 'editor' })}\n          >\n            Visual\n          </button>\n          <button\n            className={`liveblog-editor-tab ${mode === 'raw' ? 'is-active' : ''}`}\n            onClick={() => this.setState({ mode: 'raw' })}\n          >\n              Text\n          </button>\n          <button\n            className={`liveblog-editor-tab ${mode === 'preview' ? 'is-active' : ''}`}\n            onClick={() => this.setState({ mode: 'preview' })}\n          >\n              Preview\n          </button>\n        </div>\n        {\n          mode === 'preview' &&\n          <PreviewContainer\n            config={config}\n            getEntryContent={() => this.getContent()}\n          />\n        }\n        {\n          mode === 'editor' &&\n          <Editor\n            editorState={editorState}\n            onChange={this.onChange}\n            suggestions={suggestions}\n            resetSuggestions={() => this.setState({ suggestions: [] })}\n            onSearch={(trigger, text) => this.handleOnSearch(trigger, text)}\n            autocompleteConfig={config.autocomplete}\n            handleImageUpload={this.handleImageUpload.bind(this)}\n            readOnly={readOnly}\n            setReadOnly={this.setReadOnly.bind(this)}\n            defaultImageSize={config.default_image_size}\n          />\n        }\n        {\n          mode === 'raw' &&\n          <HTMLInput\n            value={this.state.rawText}\n            onChange={(text) => {\n              this.setState({ rawText: text }, () => {\n                this.syncRawTextToEditorState();\n              });\n            }}\n            height=\"275px\"\n            width=\"100%\"\n          />\n        }\n        <h2 className=\"liveblog-editor-subTitle\">Authors:</h2>\n        <Async\n          isMulti={true}\n          value={authors}\n          getOptionValue={(option) => option.key}\n          getOptionLabel={(option) => option.name}\n          onChange={this.onSelectAuthorChange.bind(this)}\n          components={{ Option: AuthorSelectOption }}\n          loadOptions={this.getUsers.bind(this)}\n          isClearable={false}\n          cacheOptions={false}\n        />\n        <button className=\"liveblog-btn liveblog-publish-btn\" onClick={this.publish.bind(this)}>\n          {isEditing ? 'Publish Update' : 'Publish New Entry'}\n        </button>\n      </div>\n    );\n  }\n}\n\nEditorContainer.propTypes = {\n  config: PropTypes.object,\n  updateEntry: PropTypes.func,\n  entry: PropTypes.object,\n  entryEditClose: PropTypes.func,\n  createEntry: PropTypes.func,\n  isEditing: PropTypes.bool,\n  authors: PropTypes.array,\n  getAuthors: PropTypes.func,\n};\n\nconst mapStateToProps = state => state;\n\nconst mapDispatchToProps = dispatch =>\n  bindActionCreators({\n    ...apiActions,\n    ...userActions },\n  dispatch);\n\nexport default connect(mapStateToProps, mapDispatchToProps)(EditorContainer);\n"],"names":["Loader","_jsxs","className","children","_jsx","PreviewContainer","Component","constructor","props","super","this","state","loading","error","entryContent","componentDidMount","config","getEntryContent","getPreview","timeout","map","res","response","subscribe","setState","html","render","dangerouslySetInnerHTML","__html","propTypes","PropTypes","AuthorSelectOption","handleMouseDown","event","onSelect","option","data","selectOption","item","preventDefault","stopPropagation","handleMouseEnter","onFocus","handleMouseMove","isFocused","onMouseDown","bind","onMouseEnter","onMouseMove","avatar","name","HTMLInput","container","AceEditor","mode","theme","fontSize","showGutter","highlightActiveLine","tabSize","blockScrolling","hasEntityAtSelection","editorState","selectionState","selection","getSelection","getHasFocus","contentState","getCurrentContent","entityKey","getBlockForKey","getStartKey","getEntityAt","getStartOffset","getEntity","getTopPosition","range","parent","tempRange","window","getRangeAt","cloneRange","setStart","startContainer","start","parentRect","getBoundingClientRect","rect","top","height","scrollElementIfNotInView","childElement","parentElement","parentClientRect","parentBottom","bottom","parentTop","childRect","childBottom","childTop","scrollTop","focusableBlockIsSelected","getAnchorKey","getFocusKey","block","getType","getImageSize","sizes","defaultSize","source_url","url","full","onChange","direction","anchorKey","getBlockBefore","getBlockAfter","get","offsetKey","DraftOffsetKey","getKey","node","document","querySelector","createRange","setEnd","removeAllRanges","addRange","offset","getLength","EditorState","forceSelection","SelectionState","anchorOffset","focusKey","focusOffset","isBackward","blockKey","afterKey","getKeyAfter","afterBlock","targetRange","getBlockMap","last","newContentState","Modifier","setBlockType","removeRange","newEditorState","currentBlock","contentStateAfterRemoval","removeBlock","fragmentArray","ContentBlock","key","genKey","type","text","characterList","getCharacterList","List","fragment","BlockMapBuilder","createFromArray","withUnstyledBlock","replaceWithFragment","push","getSelectionAfter","entity","contentStateAfterInsert","entityType","currentSelectionState","targetSelection","blockKeyForTarget","insertionTargetSelection","insertionTargetBlock","isEmptyBlock","selectedFromStart","splitBlock","newContentStateAfterSplit","createEntity","getLastCreatedEntityKey","charData","CharacterMetadata","create","Repeat","length","addBlock","contentStateAfterRemove","newState","addNewLine","AtomicBlockUtils","insertAtomicBlock","newAtomicBlock","find","x","moveBlock","Image","src","getData","role","Placeholder","Button","click","icon","classes","readOnly","style","display","e","disabled","onClick","CodeBlock","code","title","getMetadata","placeholder","save","replaceMetadata","setEditMode","cancel","handleChange","value","edit","target","width","CreateBlock","Block","setReadOnly","componentWillUnmount","update","mergeEntityData","startDrag","dataTransfer","dropEffect","setData","contentAfterRemove","blockProps","draggable","onDragStart","getImageThumbnail","image","media_details","thumbnail","Media","defaultParams","per_page","inputId","defaultState","images","currentPage","totalPages","searchInput","searching","uploading","componentDidUpdate","prevProps","getMedia","page","params","mergedParams","search","pages","xhr","getResponseHeader","result","loadMore","selectImage","defaultImageSize","handleSearch","uploadImage","handleImageUpload","files","imageUpload","then","renderMediaImages","marginBottom","htmlFor","id","alignItems","justifyContent","margin","parseInt","padding","renderCurrentImage","marginTop","ref","accept","onSubmit","color","cursor","Toolbar","showURLInput","onURLChange","toggleInlineStyle","RichUtils","toggleBlockType","openLinkModal","isCollapsed","startKey","startOffset","linkKey","closeLinkModal","turnIntoLink","contentStateWithEntity","set","currentContent","toggleLink","addLink","removeAsLink","addCodeBlock","addAtomicBlock","addMediaBlock","position","listStyle","maxHeight","overflowY","listItemStyle","Suggestions","autocompleteState","onSearch","searchText","trigger","renderSuggestions","turnIntoEntity","renderTemplate","suggestions","setSuggestionIndex","i","selectedIndex","onTouchStart","list","getEditorRect","EditorWrapper","updateEditorState","resetSuggestions","setTimeout","endOffset","currentSelection","merge","skipOverEntity","getAutocompleteState","onDownArrow","suggestionsNode","blockAfter","setSelection","newIndex","selectedSuggestionDomNode","downArrowBinding","onUpArrow","blockBefore","Math","max","upArrowBinding","onEscape","handleReturn","turnSuggestionIntoEntity","returnBinding","autocompleteConfig","triggers","rangeCount","textContent","substring","test","index","getLastIndexOf","string","characters","reduce","accumulator","character","lastIndexOf","end","getTriggerRange","charAt","filter","editor","editorContainer","displayKey","replaceText","slice","suggestionIndex","suggestion","extraData","getInsertRange","getAnchorOffset","getText","replace","insertText","addAutocomplete","template","parseTemplate","match","path","obj","fb","split","substr","trim","handleDroppedFiles","handleKeyCommand","command","handleDrop","location","handled","raw","mouseUpEvent","MouseEvent","view","bubbles","cancelable","dispatchEvent","onDrop","isContentEditable","Editor","blockRendererFn","component","editable","blockRenderer","keyBindingFn","isLeftPress","keyCode","isRightPress","isBackspacePress","content","getFocusOffset","getDefaultKeyBinding","keyBindingFunc","spellCheck","CODE_BLOCK_TAGS","TEXT_TAGS","IGNORED_TAGS","Link","href","Emoji","backgroundImage","cdn","Text","nodeName","attributes","React","strategy","findLinkEntities","contentBlock","callback","findEntityRanges","findEmojiEntities","findTextEntities","decorators","CompositeDecorator","decoratorsArray","convertFromHTML","htmlToEntity","includes","namedNodeMap","Array","from","object","isHTMLBlock","innerHTML","outerHTML","htmlToBlock","textToEntity","emojis","liveblog_settings","autocomplete","emoji","toString","convertToHTML","styleToHTML","blockToHTML","nestStart","nestEnd","entityToHTML","originalText","EditorContainer","initialEditorState","initialAuthors","entry","createWithContent","default_image_size","authors","createEmpty","current_user","rawText","getContent","syncRawTextToEditorState","publish","updateEntry","entryEditClose","createEntry","isEditing","authorIds","author","contributors","getPlainText","exec","ContentState","createFromText","onSelectAuthorChange","getUsers","Promise","resolve","getAuthors","pipe","next","options","err","console","warn","getHashtags","hashtag","filterCommandSuggestions","filterEmojiSuggestions","handleOnSearch","file","formData","FormData","append","image_nonce","Async","isMulti","getOptionValue","getOptionLabel","components","Option","loadOptions","isClearable","cacheOptions","connect","dispatch","bindActionCreators","apiActions","userActions"],"sourceRoot":""}