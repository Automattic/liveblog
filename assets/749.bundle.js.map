{"version":3,"file":"749.bundle.js","mappings":"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","sources":["webpack://liveblog/./src/react/Editor/LexicalEditor.js"],"sourcesContent":["/**\n * LexicalEditor - Production implementation using Lexical\n *\n * Lexical is the official successor to Draft.js from the same team at Meta.\n *\n * @see https://lexical.dev/\n */\n\nimport React, { useEffect, useCallback, useRef, useState } from 'react';\nimport PropTypes from 'prop-types';\n\nimport { LexicalComposer } from '@lexical/react/LexicalComposer';\nimport { RichTextPlugin } from '@lexical/react/LexicalRichTextPlugin';\nimport { ContentEditable } from '@lexical/react/LexicalContentEditable';\nimport { HistoryPlugin } from '@lexical/react/LexicalHistoryPlugin';\nimport { OnChangePlugin } from '@lexical/react/LexicalOnChangePlugin';\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext';\nimport { LexicalErrorBoundary } from '@lexical/react/LexicalErrorBoundary';\nimport { LinkPlugin } from '@lexical/react/LexicalLinkPlugin';\nimport { ListPlugin } from '@lexical/react/LexicalListPlugin';\n\nimport { HeadingNode, QuoteNode } from '@lexical/rich-text';\nimport { ListNode, ListItemNode } from '@lexical/list';\nimport { LinkNode, AutoLinkNode, $isLinkNode, TOGGLE_LINK_COMMAND } from '@lexical/link';\nimport {\n\tINSERT_ORDERED_LIST_COMMAND,\n\tINSERT_UNORDERED_LIST_COMMAND,\n\tREMOVE_LIST_COMMAND,\n\t$isListNode,\n} from '@lexical/list';\n\nimport { $generateHtmlFromNodes, $generateNodesFromDOM } from '@lexical/html';\nimport {\n\t$getRoot,\n\t$insertNodes,\n\t$getSelection,\n\t$isRangeSelection,\n\tFORMAT_TEXT_COMMAND,\n\tSELECTION_CHANGE_COMMAND,\n\tCOMMAND_PRIORITY_CRITICAL,\n} from 'lexical';\nimport { $getNearestNodeOfType } from '@lexical/utils';\n\n// Theme for styling the editor content\nconst theme = {\n\tparagraph: 'liveblog-lexical-paragraph',\n\theading: {\n\t\th1: 'liveblog-lexical-h1',\n\t\th2: 'liveblog-lexical-h2',\n\t\th3: 'liveblog-lexical-h3',\n\t},\n\tlist: {\n\t\tul: 'liveblog-lexical-ul',\n\t\tol: 'liveblog-lexical-ol',\n\t\tlistitem: 'liveblog-lexical-li',\n\t\tnested: {\n\t\t\tlistitem: 'liveblog-lexical-li-nested',\n\t\t},\n\t},\n\ttext: {\n\t\tbold: 'liveblog-lexical-bold',\n\t\titalic: 'liveblog-lexical-italic',\n\t\tunderline: 'liveblog-lexical-underline',\n\t\tstrikethrough: 'liveblog-lexical-strikethrough',\n\t},\n\tlink: 'liveblog-lexical-link',\n\tquote: 'liveblog-lexical-quote',\n};\n\n// Nodes to register with the editor\nconst nodes = [\n\tHeadingNode,\n\tQuoteNode,\n\tListNode,\n\tListItemNode,\n\tLinkNode,\n\tAutoLinkNode,\n];\n\n/**\n * Plugin to load initial HTML content into the editor.\n * Only loads content once on mount to avoid cursor position issues.\n */\nfunction InitialContentPlugin( { initialContent } ) {\n\tconst [ editor ] = useLexicalComposerContext();\n\tconst hasLoadedRef = useRef( false );\n\n\tuseEffect( () => {\n\t\t// Only load initial content once\n\t\tif ( hasLoadedRef.current || ! initialContent ) {\n\t\t\treturn;\n\t\t}\n\n\t\thasLoadedRef.current = true;\n\n\t\teditor.update( () => {\n\t\t\tconst parser = new DOMParser();\n\t\t\tconst dom = parser.parseFromString( initialContent, 'text/html' );\n\t\t\tconst generatedNodes = $generateNodesFromDOM( editor, dom );\n\n\t\t\tconst root = $getRoot();\n\t\t\troot.clear();\n\t\t\troot.select();\n\t\t\t$insertNodes( generatedNodes );\n\t\t} );\n\t}, [ editor, initialContent ] );\n\n\treturn null;\n}\n\n/**\n * Clean up Lexical's HTML output.\n * Removes unnecessary markup added by Lexical.\n *\n * @param {string} html - Raw HTML from Lexical.\n * @return {string} Cleaned HTML.\n */\nfunction cleanLexicalHtml( html ) {\n\tlet cleaned = html;\n\n\t// Remove style=\"white-space: pre-wrap;\" from any element\n\tcleaned = cleaned.replace( / style=\"white-space: pre-wrap;\"/g, '' );\n\n\t// Remove liveblog-lexical-* class attributes (not needed in stored HTML)\n\tcleaned = cleaned.replace( / class=\"liveblog-lexical-[^\"]*\"/g, '' );\n\n\t// Remove redundant <i> wrapping <em> (Lexical outputs both)\n\tcleaned = cleaned.replace( /<i>(<em[^>]*>)/g, '$1' );\n\tcleaned = cleaned.replace( /<\\/em><\\/i>/g, '</em>' );\n\n\t// Remove redundant <b> wrapping <strong>\n\tcleaned = cleaned.replace( /<b>(<strong[^>]*>)/g, '$1' );\n\tcleaned = cleaned.replace( /<\\/strong><\\/b>/g, '</strong>' );\n\n\t// Remove empty spans\n\tcleaned = cleaned.replace( /<span>([^<]*)<\\/span>/g, '$1' );\n\n\treturn cleaned;\n}\n\n/**\n * Plugin to export HTML when content changes.\n */\nfunction HtmlExportPlugin( { onChange } ) {\n\tconst [ editor ] = useLexicalComposerContext();\n\n\tconst handleChange = useCallback(\n\t\t( editorState ) => {\n\t\t\tif ( ! onChange ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\teditorState.read( () => {\n\t\t\t\tconst rawHtml = $generateHtmlFromNodes( editor, null );\n\t\t\t\tconst html = cleanLexicalHtml( rawHtml );\n\t\t\t\tonChange( html );\n\t\t\t} );\n\t\t},\n\t\t[ editor, onChange ]\n\t);\n\n\treturn <OnChangePlugin onChange={ handleChange } />;\n}\n\n/**\n * Toolbar button component using Dashicons.\n */\nfunction ToolbarButton( { onClick, icon, title, isActive = false, disabled = false } ) {\n\treturn (\n\t\t<button\n\t\t\ttype=\"button\"\n\t\t\tonClick={ onClick }\n\t\t\ttitle={ title }\n\t\t\tclassName={ `liveblog-editor-btn${ isActive ? ' is-active' : '' }` }\n\t\t\tdisabled={ disabled }\n\t\t\taria-label={ title }\n\t\t>\n\t\t\t<span className={ `dashicons dashicons-${ icon }` } />\n\t\t</button>\n\t);\n}\n\nToolbarButton.propTypes = {\n\tonClick: PropTypes.func.isRequired,\n\ticon: PropTypes.string.isRequired,\n\ttitle: PropTypes.string.isRequired,\n\tisActive: PropTypes.bool,\n\tdisabled: PropTypes.bool,\n};\n\n/**\n * Link input modal component.\n */\nfunction LinkInput( { url, onChange, onConfirm, onCancel } ) {\n\treturn (\n\t\t<div className=\"liveblog-editor-input-container\">\n\t\t\t<input\n\t\t\t\tclassName=\"liveblog-input\"\n\t\t\t\ttype=\"url\"\n\t\t\t\tvalue={ url }\n\t\t\t\tonChange={ ( e ) => onChange( e.target.value ) }\n\t\t\t\tplaceholder=\"https://\"\n\t\t\t\t// eslint-disable-next-line jsx-a11y/no-autofocus\n\t\t\t\tautoFocus\n\t\t\t\tonKeyDown={ ( e ) => {\n\t\t\t\t\tif ( e.key === 'Enter' ) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tonConfirm();\n\t\t\t\t\t} else if ( e.key === 'Escape' ) {\n\t\t\t\t\t\tonCancel();\n\t\t\t\t\t}\n\t\t\t\t} }\n\t\t\t/>\n\t\t\t<button\n\t\t\t\ttype=\"button\"\n\t\t\t\tclassName=\"liveblog-editor-btn liveblog-input-enter\"\n\t\t\t\tonClick={ onConfirm }\n\t\t\t\ttitle=\"Add link\"\n\t\t\t>\n\t\t\t\t<span className=\"dashicons dashicons-yes\" />\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\ttype=\"button\"\n\t\t\t\tclassName=\"liveblog-editor-btn liveblog-input-cancel\"\n\t\t\t\tonClick={ onCancel }\n\t\t\t\ttitle=\"Cancel\"\n\t\t\t>\n\t\t\t\t<span className=\"dashicons dashicons-no-alt\" />\n\t\t\t</button>\n\t\t</div>\n\t);\n}\n\nLinkInput.propTypes = {\n\turl: PropTypes.string.isRequired,\n\tonChange: PropTypes.func.isRequired,\n\tonConfirm: PropTypes.func.isRequired,\n\tonCancel: PropTypes.func.isRequired,\n};\n\n/**\n * Get the current selection state for toolbar active states.\n */\nfunction getSelectionState( editor ) {\n\tconst state = {\n\t\tisBold: false,\n\t\tisItalic: false,\n\t\tisUnderline: false,\n\t\tisLink: false,\n\t\tlistType: null,\n\t};\n\n\teditor.getEditorState().read( () => {\n\t\tconst selection = $getSelection();\n\t\tif ( ! $isRangeSelection( selection ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tstate.isBold = selection.hasFormat( 'bold' );\n\t\tstate.isItalic = selection.hasFormat( 'italic' );\n\t\tstate.isUnderline = selection.hasFormat( 'underline' );\n\n\t\tconst anchorNode = selection.anchor.getNode();\n\t\tconst element = anchorNode.getKey() === 'root'\n\t\t\t? anchorNode\n\t\t\t: anchorNode.getTopLevelElementOrThrow();\n\n\t\t// Check for list\n\t\tif ( $isListNode( element ) ) {\n\t\t\tstate.listType = element.getListType();\n\t\t} else {\n\t\t\tconst parent = anchorNode.getParent();\n\t\t\tif ( parent ) {\n\t\t\t\tconst listNode = $getNearestNodeOfType( parent, ListNode );\n\t\t\t\tif ( listNode ) {\n\t\t\t\t\tstate.listType = listNode.getListType();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Check for link\n\t\tconst node = selection.anchor.getNode();\n\t\tconst parent = node.getParent();\n\t\tstate.isLink = $isLinkNode( parent ) || $isLinkNode( node );\n\t} );\n\n\treturn state;\n}\n\n/**\n * Complete toolbar for text formatting.\n */\nfunction ToolbarPlugin( { readOnly } ) {\n\tconst [ editor ] = useLexicalComposerContext();\n\tconst [ selectionState, setSelectionState ] = useState( {\n\t\tisBold: false,\n\t\tisItalic: false,\n\t\tisUnderline: false,\n\t\tisLink: false,\n\t\tlistType: null,\n\t} );\n\tconst [ showLinkInput, setShowLinkInput ] = useState( false );\n\tconst [ linkUrl, setLinkUrl ] = useState( 'https://' );\n\n\t// Update selection state when selection changes\n\tuseEffect( () => {\n\t\treturn editor.registerCommand(\n\t\t\tSELECTION_CHANGE_COMMAND,\n\t\t\t() => {\n\t\t\t\tsetSelectionState( getSelectionState( editor ) );\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tCOMMAND_PRIORITY_CRITICAL\n\t\t);\n\t}, [ editor ] );\n\n\tconst formatBold = useCallback( () => {\n\t\teditor.dispatchCommand( FORMAT_TEXT_COMMAND, 'bold' );\n\t}, [ editor ] );\n\n\tconst formatItalic = useCallback( () => {\n\t\teditor.dispatchCommand( FORMAT_TEXT_COMMAND, 'italic' );\n\t}, [ editor ] );\n\n\tconst formatUnderline = useCallback( () => {\n\t\teditor.dispatchCommand( FORMAT_TEXT_COMMAND, 'underline' );\n\t}, [ editor ] );\n\n\tconst formatOrderedList = useCallback( () => {\n\t\tif ( selectionState.listType === 'number' ) {\n\t\t\teditor.dispatchCommand( REMOVE_LIST_COMMAND, undefined );\n\t\t} else {\n\t\t\teditor.dispatchCommand( INSERT_ORDERED_LIST_COMMAND, undefined );\n\t\t}\n\t}, [ editor, selectionState.listType ] );\n\n\tconst formatUnorderedList = useCallback( () => {\n\t\tif ( selectionState.listType === 'bullet' ) {\n\t\t\teditor.dispatchCommand( REMOVE_LIST_COMMAND, undefined );\n\t\t} else {\n\t\t\teditor.dispatchCommand( INSERT_UNORDERED_LIST_COMMAND, undefined );\n\t\t}\n\t}, [ editor, selectionState.listType ] );\n\n\tconst openLinkModal = useCallback( () => {\n\t\teditor.getEditorState().read( () => {\n\t\t\tconst selection = $getSelection();\n\t\t\tif ( ! $isRangeSelection( selection ) || selection.isCollapsed() ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Check if there's an existing link\n\t\t\tconst node = selection.anchor.getNode();\n\t\t\tconst parent = node.getParent();\n\t\t\tif ( $isLinkNode( parent ) ) {\n\t\t\t\tsetLinkUrl( parent.getURL() );\n\t\t\t} else if ( $isLinkNode( node ) ) {\n\t\t\t\tsetLinkUrl( node.getURL() );\n\t\t\t} else {\n\t\t\t\tsetLinkUrl( 'https://' );\n\t\t\t}\n\n\t\t\tsetShowLinkInput( true );\n\t\t} );\n\t}, [ editor ] );\n\n\tconst insertLink = useCallback( () => {\n\t\tif ( linkUrl && linkUrl !== 'https://' ) {\n\t\t\teditor.dispatchCommand( TOGGLE_LINK_COMMAND, linkUrl );\n\t\t}\n\t\tsetShowLinkInput( false );\n\t\tsetLinkUrl( 'https://' );\n\t}, [ editor, linkUrl ] );\n\n\tconst removeLink = useCallback( () => {\n\t\teditor.dispatchCommand( TOGGLE_LINK_COMMAND, null );\n\t\tsetShowLinkInput( false );\n\t}, [ editor ] );\n\n\tconst cancelLink = useCallback( () => {\n\t\tsetShowLinkInput( false );\n\t\tsetLinkUrl( 'https://' );\n\t}, [] );\n\n\treturn (\n\t\t<div className=\"liveblog-editor-toolbar-container\">\n\t\t\t<div className=\"liveblog-toolbar\">\n\t\t\t\t<ToolbarButton\n\t\t\t\t\tonClick={ formatBold }\n\t\t\t\t\ticon=\"editor-bold\"\n\t\t\t\t\ttitle=\"Bold (Ctrl+B)\"\n\t\t\t\t\tisActive={ selectionState.isBold }\n\t\t\t\t\tdisabled={ readOnly }\n\t\t\t\t/>\n\t\t\t\t<ToolbarButton\n\t\t\t\t\tonClick={ formatItalic }\n\t\t\t\t\ticon=\"editor-italic\"\n\t\t\t\t\ttitle=\"Italic (Ctrl+I)\"\n\t\t\t\t\tisActive={ selectionState.isItalic }\n\t\t\t\t\tdisabled={ readOnly }\n\t\t\t\t/>\n\t\t\t\t<ToolbarButton\n\t\t\t\t\tonClick={ formatUnderline }\n\t\t\t\t\ticon=\"editor-underline\"\n\t\t\t\t\ttitle=\"Underline (Ctrl+U)\"\n\t\t\t\t\tisActive={ selectionState.isUnderline }\n\t\t\t\t\tdisabled={ readOnly }\n\t\t\t\t/>\n\t\t\t\t<ToolbarButton\n\t\t\t\t\tonClick={ formatOrderedList }\n\t\t\t\t\ticon=\"editor-ol\"\n\t\t\t\t\ttitle=\"Ordered List\"\n\t\t\t\t\tisActive={ selectionState.listType === 'number' }\n\t\t\t\t\tdisabled={ readOnly }\n\t\t\t\t/>\n\t\t\t\t<ToolbarButton\n\t\t\t\t\tonClick={ formatUnorderedList }\n\t\t\t\t\ticon=\"editor-ul\"\n\t\t\t\t\ttitle=\"Unordered List\"\n\t\t\t\t\tisActive={ selectionState.listType === 'bullet' }\n\t\t\t\t\tdisabled={ readOnly }\n\t\t\t\t/>\n\t\t\t\t<div style={ { position: 'relative', display: 'inline-block' } }>\n\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\tonClick={ openLinkModal }\n\t\t\t\t\t\ticon=\"admin-links\"\n\t\t\t\t\t\ttitle=\"Add Link\"\n\t\t\t\t\t\tisActive={ selectionState.isLink }\n\t\t\t\t\t\tdisabled={ readOnly }\n\t\t\t\t\t/>\n\t\t\t\t\t{ showLinkInput && (\n\t\t\t\t\t\t<LinkInput\n\t\t\t\t\t\t\turl={ linkUrl }\n\t\t\t\t\t\t\tonChange={ setLinkUrl }\n\t\t\t\t\t\t\tonConfirm={ insertLink }\n\t\t\t\t\t\t\tonCancel={ cancelLink }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t</div>\n\t\t\t\t<ToolbarButton\n\t\t\t\t\tonClick={ removeLink }\n\t\t\t\t\ticon=\"editor-unlink\"\n\t\t\t\t\ttitle=\"Remove Link\"\n\t\t\t\t\tdisabled={ readOnly || ! selectionState.isLink }\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nToolbarPlugin.propTypes = {\n\treadOnly: PropTypes.bool,\n};\n\n/**\n * Main Lexical Editor component.\n *\n * @param {Object}   props                - Component props.\n * @param {string}   props.initialContent - Initial HTML content to load.\n * @param {Function} props.onChange       - Callback when content changes, receives HTML string.\n * @param {boolean}  props.readOnly       - Whether the editor is read-only.\n */\nconst LexicalEditor = ( {\n\tinitialContent = '',\n\tonChange = null,\n\treadOnly = false,\n} ) => {\n\tconst initialConfig = {\n\t\tnamespace: 'LiveblogEditor',\n\t\ttheme,\n\t\tnodes,\n\t\teditable: ! readOnly,\n\t\tonError: ( error ) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error( 'Lexical error:', error );\n\t\t},\n\t};\n\n\treturn (\n\t\t<div className=\"liveblog-lexical-editor\">\n\t\t\t<LexicalComposer initialConfig={ initialConfig }>\n\t\t\t\t<ToolbarPlugin readOnly={ readOnly } />\n\t\t\t\t<div className=\"liveblog-lexical-editor-inner\">\n\t\t\t\t\t<RichTextPlugin\n\t\t\t\t\t\tcontentEditable={\n\t\t\t\t\t\t\t<ContentEditable className=\"liveblog-lexical-content-editable\" />\n\t\t\t\t\t\t}\n\t\t\t\t\t\tplaceholder={\n\t\t\t\t\t\t\t<div className=\"liveblog-lexical-placeholder\">\n\t\t\t\t\t\t\t\tStart writing your liveblog entry...\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t}\n\t\t\t\t\t\tErrorBoundary={ LexicalErrorBoundary }\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<HistoryPlugin />\n\t\t\t\t<LinkPlugin />\n\t\t\t\t<ListPlugin />\n\t\t\t\t<InitialContentPlugin initialContent={ initialContent } />\n\t\t\t\t<HtmlExportPlugin onChange={ onChange } />\n\t\t\t</LexicalComposer>\n\t\t</div>\n\t);\n};\n\nLexicalEditor.propTypes = {\n\tinitialContent: PropTypes.string,\n\tonChange: PropTypes.func,\n\treadOnly: PropTypes.bool,\n};\n\nexport default LexicalEditor;\n"],"names":["theme","paragraph","heading","h1","h2","h3","list","ul","ol","listitem","nested","text","bold","italic","underline","strikethrough","link","quote","nodes","HeadingNode","QuoteNode","ListNode","ListItemNode","LinkNode","AutoLinkNode","InitialContentPlugin","initialContent","editor","useLexicalComposerContext","hasLoadedRef","useRef","useEffect","current","update","dom","DOMParser","parseFromString","generatedNodes","$generateNodesFromDOM","root","$getRoot","clear","select","$insertNodes","HtmlExportPlugin","onChange","handleChange","useCallback","editorState","read","html","cleaned","replace","cleanLexicalHtml","$generateHtmlFromNodes","_jsx","OnChangePlugin","ToolbarButton","onClick","icon","title","isActive","disabled","type","className","children","LinkInput","url","onConfirm","onCancel","_jsxs","value","e","target","placeholder","autoFocus","onKeyDown","key","preventDefault","ToolbarPlugin","readOnly","selectionState","setSelectionState","useState","isBold","isItalic","isUnderline","isLink","listType","showLinkInput","setShowLinkInput","linkUrl","setLinkUrl","registerCommand","SELECTION_CHANGE_COMMAND","state","getEditorState","selection","$getSelection","$isRangeSelection","hasFormat","anchorNode","anchor","getNode","element","getKey","getTopLevelElementOrThrow","$isListNode","getListType","parent","getParent","listNode","$getNearestNodeOfType","node","$isLinkNode","getSelectionState","COMMAND_PRIORITY_CRITICAL","formatBold","dispatchCommand","FORMAT_TEXT_COMMAND","formatItalic","formatUnderline","formatOrderedList","REMOVE_LIST_COMMAND","undefined","INSERT_ORDERED_LIST_COMMAND","formatUnorderedList","INSERT_UNORDERED_LIST_COMMAND","openLinkModal","isCollapsed","getURL","insertLink","TOGGLE_LINK_COMMAND","removeLink","cancelLink","style","position","display","propTypes","PropTypes","isRequired","LexicalEditor","initialConfig","namespace","editable","onError","error","console","LexicalComposer","RichTextPlugin","contentEditable","ContentEditable","ErrorBoundary","LexicalErrorBoundary","HistoryPlugin","LinkPlugin","ListPlugin"],"ignoreList":[],"sourceRoot":""}