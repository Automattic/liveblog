"use strict";(globalThis.wpJsonpLiveBlog=globalThis.wpJsonpLiveBlog||[]).push([[985],{9985:(e,t,n)=>{n.r(t),n.d(t,{default:()=>fe});var s=n(1609),o=n.n(s),i=n(5556),a=n.n(i),r=n(2960),l=n(9733),c=n(6317),d=n(2418),g=n(6087),h=n(5143),u=n(7201),p=n(8614),m=n(5384),y=n(790);const b=()=>(0,y.jsxs)("div",{className:"liveblog-loader",children:[(0,y.jsx)("div",{className:"liveblog-loader-bounce1"}),(0,y.jsx)("div",{className:"liveblog-loader-bounce2"})]});class f extends s.Component{constructor(e){super(e),this.state={loading:!0,error:!1,entryContent:!1}}componentDidMount(){const{config:e,getEntryContent:t}=this.props;(0,m.P3)(t(),e).timeout(1e4).map(e=>e.response).subscribe(e=>this.setState({entryContent:e.html,loading:!1}))}render(){const{entryContent:e,loading:t}=this.state;return t?(0,y.jsx)("div",{className:"liveblog-preview",children:(0,y.jsx)(b,{})}):!!e&&(0,y.jsx)("div",{className:"liveblog-preview",dangerouslySetInnerHTML:{__html:e}})}}f.propTypes={getEntryContent:a().func,config:a().object};const S=f;class v extends s.Component{handleMouseDown(e){const{onSelect:t,option:n}=this.props;e.preventDefault(),e.stopPropagation(),t(n,e)}handleMouseEnter(e){this.props.onFocus(this.props.option,e)}handleMouseMove(e){const{isFocused:t,onFocus:n,option:s}=this.props;t||n(s,e)}render(){const{className:e,option:t}=this.props;return(0,y.jsxs)("div",{className:`${e} liveblog-popover-item`,onMouseDown:this.handleMouseDown.bind(this),onMouseEnter:this.handleMouseEnter.bind(this),onMouseMove:this.handleMouseMove.bind(this),children:[t.avatar&&(0,y.jsx)("div",{dangerouslySetInnerHTML:{__html:t.avatar}}),t.name]})}}v.propTypes={onSelect:a().func,option:a().object,onFocus:a().func,isFocused:a().bool,className:a().string};const x=v;var C=n(470);n(6861),n(5351);const j=({container:e=!0,...t})=>(0,y.jsx)("div",{className:"liveblog-html-editor "+(e?"liveblog-html-editor-container":""),children:(0,y.jsx)(C.Ay,{mode:"html",theme:"tomorrow",name:"raw-editor",fontSize:13,showGutter:!1,highlightActiveLine:!0,tabSize:2,blockScrolling:"Infinity",...t})});j.propTypes={container:a().bool};const k=j,E=(e,t=!1)=>{const n=t||e.getSelection();if(!n.getHasFocus())return!1;const s=e.getCurrentContent(),o=s.getBlockForKey(n.getStartKey()).getEntityAt(n.getStartOffset()-1);return!!o&&s.getEntity(o)},M=(e,t)=>{const n=window.getSelection().getRangeAt(0).cloneRange();n.setStart(n.startContainer,e.start);const s=t.getBoundingClientRect(),o=n.getBoundingClientRect();return o.top-s.top+o.height},I=(e,t)=>{const n=t.getBoundingClientRect(),s=n.bottom,o=n.top,i=e.getBoundingClientRect(),a=i.bottom,r=i.top;a>s&&(t.scrollTop+=i.height),r<o&&(t.scrollTop-=i.height)},T=e=>{const t=e.getSelection();if(t.getAnchorKey()!==t.getFocusKey())return!1;const n=e.getCurrentContent().getBlockForKey(t.getAnchorKey());return"atomic"===n.getType()&&n},w=(e,t)=>e?e[t]?e[t].source_url||e[t].url:e.full?e.full.source_url||e.full.url:"":"";var D=n(3885),N=n.n(D);const B=(e,t,n,s)=>{const o=e.getSelection().getAnchorKey(),i="up"===n?e.getCurrentContent().getBlockBefore(o):e.getCurrentContent().getBlockAfter(o);if((!i||i.get("key")!==o)&&i){s.preventDefault();const o=N().encode(i.getKey(),0,0),a=document.querySelector(`[data-offset-key="${o}"]`),r=window.getSelection(),l=document.createRange();l.setStart(a,0),l.setEnd(a,0),r.removeAllRanges(),r.addRange(l);const c="up"===n?i.getLength():0;t(h.EditorState.forceSelection(e,new h.SelectionState({anchorKey:i.getKey(),anchorOffset:c,focusKey:i.getKey(),focusOffset:c,isBackward:!1})))}};var K=n(9404);const O=(e,t)=>{const n=e.getKeyAfter(t),s=e.getBlockForKey(n);let o;o=s&&"unstyled"===s.getType()&&0===s.getLength()&&s===e.getBlockMap().last()?new h.SelectionState({anchorKey:t,anchorOffset:0,focusKey:n,focusOffset:0}):new h.SelectionState({anchorKey:t,anchorOffset:0,focusKey:t,focusOffset:1});const i=h.Modifier.setBlockType(e,o,"unstyled");return h.Modifier.removeRange(i,o,"backward")},L=e=>{const t=e,n=t.getCurrentContent(),s=t.getSelection(),o=n.getBlockForKey(s.getFocusKey()),i=O(n,o.getKey()),a=[new h.ContentBlock({key:(0,h.genKey)(),type:o.getType(),text:" ",characterList:o.getCharacterList()}),new h.ContentBlock({key:(0,h.genKey)(),type:"unstyled",text:"",characterList:(0,K.List)()})],r=h.BlockMapBuilder.createFromArray(a),l=h.Modifier.replaceWithFragment(i,s,r);return h.EditorState.forceSelection(h.EditorState.push(t,l,"insert-fragment"),l.getSelectionAfter())},A=(e,t,n)=>{const s=e.getCurrentContent(),o=s.getBlockForKey(t),i=s.getEntity(o.getEntityAt(0)),a=function(e,t,n,s,o,i=" "){let a=e.getCurrentContent();const r=t;E(e,t)||(a=h.Modifier.removeRange(a,r,"backward"));const l=a.getSelectionAfter(),c=l.get("focusKey"),d=a.getBlockForKey(c);let g,u;const p=0===d.getLength()&&null===d.getEntityAt(0),m=0===r.getStartOffset();p||m?(g=l,u=a):(u=h.Modifier.splitBlock(a,l),g=u.getSelectionAfter());const y=h.Modifier.setBlockType(u,g,n),b=y.createEntity(o||n,"IMMUTABLE",{...s}).getLastCreatedEntityKey(),f=h.CharacterMetadata.create({entity:b}),S=[new h.ContentBlock({key:(0,h.genKey)(),type:n,text:i,characterList:(0,K.List)((0,K.Repeat)(f,i.length||1))})];p||S.push(new h.ContentBlock({key:(0,h.genKey)(),type:"unstyled",text:"",characterList:(0,K.List)()}));const v=h.BlockMapBuilder.createFromArray(S);return h.Modifier.replaceWithFragment(y,g,v)}(e,n,o.getType(),i.data,i.type),r=O(a,t),l=h.EditorState.push(e,r,"move-block");return h.EditorState.forceSelection(l,r.getSelectionAfter())},R=(e,t=!1,n={},s)=>{let o=e;T(e)&&(o=L(e));const i=o.getCurrentContent().createEntity(s,"IMMUTABLE",n).getLastCreatedEntityKey();if(o=h.AtomicBlockUtils.insertAtomicBlock(o,i," "),!t)return h.EditorState.forceSelection(o,o.getCurrentContent().getSelectionAfter());const a=o.getCurrentContent().getBlockMap().find(e=>e.getEntityAt(0)===i);return A(o,a.getKey(),t)},U=({contentState:e,block:t})=>{const{src:n}=e.getEntity(t.getEntityAt(0)).getData();return(0,y.jsx)("img",{src:n,role:"presentation"})};U.propTypes={contentState:a().object,block:a().object};const F=U,_=()=>(0,y.jsx)("div",{className:"liveblog-placeholder",children:(0,y.jsxs)("div",{className:"liveblog-placeholder-inner",children:[(0,y.jsx)(b,{}),(0,y.jsx)("div",{className:"liveblog-placeholder-text",children:"Uploading Image..."})]})}),z=({click:e,onMouseDown:t,icon:n,classes:s,readOnly:o})=>(0,y.jsx)("span",{style:{display:"inline-block"},onMouseDown:t?e=>e.preventDefault():null,children:(0,y.jsx)("button",{disabled:o,className:`liveblog-btn liveblog-editor-btn ${s}`,onClick:t||e,children:(0,y.jsx)("span",{className:`dashicons dashicons-${n}`})})});z.propTypes={click:a().func,onMouseDown:a().func,icon:a().string,classes:a().string,readOnly:a().bool};const $=z;class H extends s.Component{constructor(e){super(e);const{code:t,title:n}=e.getMetadata();this.placeholder="Insert HTML...",this.state={title:n,code:t}}save(){const{code:e,title:t}=this.state,{replaceMetadata:n,setEditMode:s}=this.props;n({code:e,title:t},!0),s(!1)}cancel(){const{setEditMode:e,getMetadata:t}=this.props,{code:n,title:s}=t();this.setState({code:n,title:s}),e(!1)}handleChange(e){this.setState({code:e})}render(){const{code:e,title:t}=this.state,{edit:n,setEditMode:s,removeBlock:o}=this.props;return(0,y.jsxs)("div",{className:"liveblog-block-inner liveblog-editor-codeblock",children:[(0,y.jsxs)("div",{className:"liveblog-block-header",children:[(0,y.jsxs)("span",{className:"liveblog-block-title-container",children:[(0,y.jsx)("span",{className:"liveblog-block-title",children:n?"Title:":"HTML Block:"}),n?(0,y.jsx)("input",{value:t,onChange:e=>this.setState({title:e.target.value})}):(0,y.jsx)("span",{children:t})]}),(0,y.jsxs)("div",{className:"liveblog-editor-actions",children:[n&&(0,y.jsx)("span",{style:{display:"inline-block"},onMouseDown:e=>e.preventDefault(),children:(0,y.jsx)("button",{className:"liveblog-editor-btn liveblog-editor-cancel-btn",onClick:this.cancel.bind(this),children:"Cancel"})}),(0,y.jsx)("span",{style:{display:"inline-block"},onMouseDown:e=>e.preventDefault(),children:(0,y.jsx)("button",{className:"liveblog-editor-btn liveblog-editor-action-btn",onClick:n?this.save.bind(this):()=>s(!0),children:n?"Save":"Edit"})}),!n&&(0,y.jsx)($,{onMouseDown:()=>o(),icon:"no-alt",classes:"liveblog-editor-delete"})]})]}),n&&(0,y.jsx)(k,{container:!1,value:e,onChange:this.handleChange.bind(this),height:"175px",width:"100%"})]})}}H.propTypes={setEditMode:a().func,getMetadata:a().func,replaceMetadata:a().func,edit:a().bool,removeBlock:a().func};const P=H,W=(e,t,n)=>class extends s.Component{constructor(){super(),this.state={edit:!1}}componentDidMount(){const{setReadOnly:e,edit:t}=this.getMetadata();t&&(this.setState({edit:!0}),e(!0))}componentWillUnmount(){this.setEditMode(!1)}setEditMode(e){const{setReadOnly:t}=this.getMetadata();this.setState({edit:e}),this.replaceMetadata({edit:e}),t(e)}getMetadata(){const{contentState:e,block:t}=this.props;return e.getEntity(t.getEntityAt(0)).getData()}replaceMetadata(e,s=!1){const{contentState:o,block:i}=this.props,a=o.mergeEntityData(i.getEntityAt(0),e);if(s){const e=h.EditorState.push(t,a,"replace-metadata");n(h.EditorState.forceSelection(e,e.getSelection()))}}startDrag(e){const{block:t}=this.props;e.dataTransfer.dropEffect="move",e.dataTransfer.setData("text",`DRAFT_BLOCK:${t.getKey()}`)}removeBlock(){const{block:e}=this.props,s=O(t.getCurrentContent(),e.getKey());n(h.EditorState.forceSelection(h.EditorState.push(t,s,"remove-block"),s.getSelectionAfter()))}render(){const{blockProps:t}=this.props,{edit:n}=this.state;return(0,y.jsx)("div",{className:`liveblog-block ${n?"is-editing":""} ${t.isFocused?"is-focused":""}`,draggable:!0,onDragStart:n?e=>e.preventDefault():this.startDrag.bind(this),children:(0,y.jsx)(e,{...this.props,edit:n,setEditMode:this.setEditMode.bind(this),getMetadata:this.getMetadata.bind(this),replaceMetadata:this.replaceMetadata.bind(this),removeBlock:this.removeBlock.bind(this)})})}},X=e=>e&&e.media_details&&e.media_details.sizes&&e.media_details.sizes.thumbnail?e.media_details.sizes.thumbnail.source_url:"";class q extends s.Component{constructor(e){super(e),this.defaultParams={per_page:12},this.inputId=e.block.getKey(),this.defaultState={loading:!0,images:[],currentPage:0,totalPages:0,searchInput:"",searching:!1,uploading:!1},this.state={...this.defaultState}}componentDidUpdate(e){const{edit:t}=this.props;t!==e.edit&&t&&(this.setState({searching:!0}),this.getMedia({page:1}))}getMedia(e={}){const{searchInput:t,images:n,searching:s}=this.state,o={...this.defaultParams,...e};t&&(o.search=t),this.setState({loading:!0}),(0,m.xM)(o).timeout(1e4).map(e=>({res:e.response,pages:e.xhr.getResponseHeader("X-WP-TotalPages")})).subscribe(({res:e,pages:t})=>{let i=e;s||(i=[...n,...e]),this.setState({images:i,totalPages:t,currentPage:o.page,loading:!1,searching:!1})})}loadMore(){const{currentPage:e}=this.state;this.getMedia({page:e+1})}cancel(){const{setEditMode:e}=this.props;this.setState({...this.defaultState}),e(!1)}selectImage(e){const{setEditMode:t,replaceMetadata:n,getMetadata:s}=this.props,{defaultImageSize:o}=s(),i=w(e.media_details.sizes,o);t(!1),this.setState({...this.defaultState}),n({image:i,edit:!1},!0)}handleSearch(e){e.preventDefault(),this.setState({searching:!0},()=>{this.getMedia({page:1})})}uploadImage(){const{setEditMode:e,replaceMetadata:t,getMetadata:n}=this.props,{handleImageUpload:s}=n(),o=this.imageUpload.files;0!==o.length&&(this.setState({...this.defaultState,uploading:!0}),e(!1),s(o[0]).then(e=>{t({image:e}),this.setState({uploading:!1})}),this.imageUpload.value="")}renderMediaImages(){const{loading:e,images:t,currentPage:n,totalPages:s,searching:o}=this.state;return o?(0,y.jsx)("div",{className:"liveblog-placeholder liveblog-media-loading",children:(0,y.jsxs)("div",{className:"liveblog-placeholder-inner",children:[(0,y.jsx)(b,{}),(0,y.jsx)("div",{className:"liveblog-placeholder-text",children:"Finding Images..."})]})}):0===t.length?(0,y.jsx)("div",{className:"liveblog-placeholder liveblog-media-loading",children:(0,y.jsxs)("div",{className:"liveblog-placeholder-inner",children:[(0,y.jsx)("div",{style:{marginBottom:".5rem"},children:"No Images Found"}),(0,y.jsx)("span",{style:{display:"inline-block"},onMouseDown:e=>e.preventDefault(),children:(0,y.jsxs)("label",{htmlFor:this.inputId,className:"liveblog-editor-btn liveblog-editor-action-btn has-icon",children:[(0,y.jsx)("span",{className:"dashicons dashicons-upload"}),"Upload an Image?"]})})]})}):(0,y.jsxs)("div",{className:"liveblog-media-grid",children:[t.map(e=>(0,y.jsx)("div",{onClick:()=>this.selectImage(e),className:"liveblog-media-grid-item",children:(0,y.jsx)("img",{src:X(e)})},e.id)),(0,y.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",margin:".5rem",width:"100%"},children:[n!==parseInt(s,10)&&!e&&(0,y.jsx)("button",{style:{width:"100%",padding:".75rem"},className:"liveblog-editor-btn liveblog-editor-action-btn",onClick:this.loadMore.bind(this),children:"Load more"}),e&&(0,y.jsx)(b,{})]})]})}renderCurrentImage(){const{uploading:e}=this.state,{getMetadata:t,setEditMode:n}=this.props,{image:s}=t();return e?(0,y.jsx)("div",{className:"liveblog-placeholder liveblog-media-loading",children:(0,y.jsxs)("div",{className:"liveblog-placeholder-inner",children:[(0,y.jsx)(b,{}),(0,y.jsx)("div",{style:{marginTop:".5rem"},className:"liveblog-placeholder-text",children:"Uploading..."})]})}):s?(0,y.jsx)("div",{className:"liveblog-media-current-container",children:(0,y.jsx)("img",{src:s})}):(0,y.jsx)("div",{className:"liveblog-placeholder liveblog-media-loading",children:(0,y.jsxs)("div",{className:"liveblog-placeholder-inner",children:[(0,y.jsx)("div",{style:{marginBottom:".5rem"},children:"No Image Selected"}),(0,y.jsx)("span",{style:{display:"inline-block"},onMouseDown:e=>e.preventDefault(),children:(0,y.jsxs)("button",{className:"liveblog-editor-btn liveblog-editor-action-btn has-icon",onClick:()=>n(!0),children:[(0,y.jsx)("span",{className:"dashicons dashicons-format-image"}),"Choose an Image?"]})})]})})}render(){const{searchInput:e}=this.state,{edit:t,setEditMode:n,removeBlock:s}=this.props;return(0,y.jsxs)("div",{className:"liveblog-block-inner liveblog-media-block",children:[(0,y.jsx)("input",{ref:e=>this.imageUpload=e,style:{display:"none"},type:"file",id:this.inputId,onChange:this.uploadImage.bind(this),accept:"image/jpeg,image/gif,image/png,image/jpg"}),(0,y.jsxs)("div",{className:"liveblog-block-header",children:[(0,y.jsx)("span",{className:"liveblog-block-title-container",children:(0,y.jsx)("span",{className:"liveblog-block-title",children:t?"Add Media":"Image Block"})}),(0,y.jsxs)("div",{className:"liveblog-editor-actions",children:[(0,y.jsx)("span",{style:{display:"inline-block"},onMouseDown:e=>e.preventDefault(),children:(0,y.jsx)("button",{className:`liveblog-editor-btn liveblog-editor-${t?"cancel":"action"}-btn`,onClick:t?this.cancel.bind(this):()=>n(!0),children:t?"Cancel":"Change Image"})}),t&&(0,y.jsx)("span",{style:{display:"inline-block"},onMouseDown:e=>e.preventDefault(),children:(0,y.jsxs)("label",{htmlFor:this.inputId,className:"liveblog-editor-btn liveblog-editor-action-btn has-icon",children:[(0,y.jsx)("span",{className:"dashicons dashicons-upload"}),"Upload"]})}),!t&&(0,y.jsx)($,{onMouseDown:()=>s(),icon:"no-alt",classes:"liveblog-editor-delete"})]})]}),t?(0,y.jsxs)("div",{children:[(0,y.jsxs)("form",{className:"liveblog-media-search-container",onSubmit:this.handleSearch.bind(this),children:[(0,y.jsx)("span",{style:{color:"#333",cursor:"pointer"},className:"dashicons dashicons-search",onClick:this.handleSearch.bind(this)}),(0,y.jsx)("input",{placeholder:"Search media items...",value:e,onChange:e=>this.setState({searchInput:e.target.value})})]}),this.renderMediaImages()]}):this.renderCurrentImage()]})}}q.propTypes={setEditMode:a().func,block:a().object,getMetadata:a().func,replaceMetadata:a().func,removeBlock:a().func,edit:a().bool,defaultImageSize:a().string};const G=q;class J extends s.Component{constructor(e){super(e),this.state={showURLInput:!1,url:""},this.onURLChange=e=>this.setState({url:e.target.value})}toggleInlineStyle(e){const{onChange:t}=this.props;t(h.RichUtils.toggleInlineStyle(this.props.editorState,e))}toggleBlockType(e){const{onChange:t}=this.props;t(h.RichUtils.toggleBlockType(this.props.editorState,e))}openLinkModal(){const{showURLInput:e}=this.state;if(e)return;const{editorState:t}=this.props;if(t.getSelection().isCollapsed())return;const n=t.getCurrentContent(),s=t.getSelection().getStartKey(),o=t.getSelection().getStartOffset(),i=n.getBlockForKey(s).getEntityAt(o);let a="http://";i&&(a=n.getEntity(i).getData().url),this.setState({showURLInput:!0,url:a})}closeLinkModal(){this.setState({showURLInput:!1,url:""})}turnIntoLink(e){e.preventDefault();const{url:t}=this.state,{editorState:n,onChange:s}=this.props;s(((e,t)=>{const n=e.getCurrentContent().createEntity("LINK","MUTABLE",{url:t}),s=e.getSelection(),o=h.EditorState.set(e,{currentContent:n});return h.RichUtils.toggleLink(o,s,n.getLastCreatedEntityKey())})(n,t)),this.setState({url:"",showURLInput:!1})}removeAsLink(e){e.preventDefault();const{showURLInput:t}=this.state;t&&this.setState({url:"",showURLInput:!1});const{editorState:n,onChange:s}=this.props,o=n.getSelection();o.isCollapsed()||s(h.RichUtils.toggleLink(n,o,null))}addCodeBlock(e){e.preventDefault();const{editorState:t,onChange:n,setReadOnly:s}=this.props;n(R(t,!1,{code:"",title:"HTML",edit:!0,setReadOnly:s},"code-block"))}addMediaBlock(e){e.preventDefault();const{editorState:t,onChange:n,setReadOnly:s,handleImageUpload:o,defaultImageSize:i}=this.props;n(R(t,!1,{setReadOnly:s,image:"",edit:!0,handleImageUpload:o,defaultImageSize:i},"media"))}render(){const{showURLInput:e}=this.state,{readOnly:t}=this.props;return(0,y.jsxs)("div",{className:"liveblog-editor-toolbar-container",children:[(0,y.jsxs)("button",{disabled:t,onClick:this.addMediaBlock.bind(this),className:"liveblog-editor-btn liveblog-image-upload-btn",children:[(0,y.jsx)("span",{className:"dashicons dashicons-format-image"}),(0,y.jsx)("span",{className:"liveblog-image-upload-btn-text",children:"Insert Image"})]}),(0,y.jsxs)("div",{className:"liveblog-toolbar",children:[(0,y.jsx)($,{onMouseDown:()=>this.toggleInlineStyle("BOLD"),icon:"editor-bold",readOnly:t}),(0,y.jsx)($,{onMouseDown:()=>this.toggleInlineStyle("ITALIC"),icon:"editor-italic",readOnly:t}),(0,y.jsx)($,{onMouseDown:()=>this.toggleInlineStyle("UNDERLINE"),icon:"editor-underline",readOnly:t}),(0,y.jsx)($,{onMouseDown:()=>this.toggleBlockType("ordered-list-item"),icon:"editor-ol",readOnly:t}),(0,y.jsx)($,{onMouseDown:()=>this.toggleBlockType("unordered-list-item"),icon:"editor-ul",readOnly:t}),(0,y.jsxs)("div",{style:{position:"relative",display:"inline-block"},children:[(0,y.jsx)($,{onMouseDown:this.openLinkModal.bind(this),icon:"admin-links",readOnly:t}),e&&(0,y.jsxs)("div",{className:"liveblog-editor-input-container",children:[(0,y.jsx)("input",{className:"liveblog-input",onChange:this.onURLChange,value:this.state.url}),(0,y.jsx)($,{onMouseDown:this.turnIntoLink.bind(this),icon:"yes",classes:"liveblog-input-enter"}),(0,y.jsx)($,{onMouseDown:this.closeLinkModal.bind(this),icon:"no-alt",classes:"liveblog-input-cancel"})]})]}),(0,y.jsx)($,{onMouseDown:this.removeAsLink.bind(this),icon:"editor-unlink",readOnly:t}),(0,y.jsx)($,{onMouseDown:this.addCodeBlock.bind(this),icon:"editor-code",readOnly:t})]})]})}}J.propTypes={onChange:a().func,editorState:a().object,setReadOnly:a().func,handleImageUpload:a().func,readOnly:a().bool,defaultImageSize:a().string};const V=J,Y={maxHeight:"150px",overflowY:"scroll",marginBottom:0},Q={height:"30px"};class Z extends s.Component{componentDidUpdate(e){const{autocompleteState:t,onSearch:n}=this.props;t&&(e.autocompleteState||!t?e.autocompleteState.searchText!==t.searchText&&n(t.trigger,t.searchText):n(t.trigger,t.searchText))}renderSuggestions(){const{turnIntoEntity:e,autocompleteState:t,renderTemplate:n,suggestions:s,setSuggestionIndex:o}=this.props;return s.map((s,i)=>(0,y.jsx)("li",{ref:e=>this[`item${i}`]=e,style:Q,className:"liveblog-popover-item "+(t.selectedIndex===i?"is-focused":""),onMouseDown:()=>e(i),onMouseEnter:()=>o(i),onTouchStart:()=>o(i),dangerouslySetInnerHTML:{__html:n(s)}},i))}render(){const{autocompleteState:e,suggestions:t}=this.props;if(!e)return!1;const{trigger:n,searchText:s,name:o}=e;return 0!==t.length&&(0,y.jsxs)("div",{className:"liveblog-popover",style:{top:e.top+10},children:[(0,y.jsxs)("div",{className:"liveblog-popover-meta",children:[t.length," ",o,t.length>1?"s":""," matching ",'"',(0,y.jsxs)("b",{children:[n,s]}),'"']}),(0,y.jsx)("ul",{ref:e=>this.list=e,style:Y,children:this.renderSuggestions()})]})}}Z.propTypes={autocompleteState:a().object,onSearch:a().func,suggestions:a().array,turnIntoEntity:a().func,renderTemplate:a().func,setSuggestionIndex:a().func,getEditorRect:a().func};const ee=Z;class te extends s.Component{constructor(e){super(e),this.state={autocompleteState:null}}componentDidMount(){const{onChange:e,editorState:t}=this.props;T(t)&&e(L(t))}updateEditorState(e){const{onChange:t,resetSuggestions:n,suggestions:s}=this.props;t(e),setTimeout(()=>{const o=E(e);o&&":"===o.getType()&&t(((e,t)=>{const n=e.getSelection(),{startOffset:s,endOffset:o}=t.getData(),i=n.getStartOffset();let a=!1;return i===s+1&&(a=o),i===o-1&&(a=s),a||0===a?h.EditorState.forceSelection(e,n.merge({anchorOffset:a,focusOffset:a})):e})(e,o));const i=this.getAutocompleteState();i&&this.state.autocompleteState&&s.length>0&&this.state.autocompleteState.trigger!==i.trigger&&n(),!i&&s.length>0&&n(),this.setState({autocompleteState:i})},0)}onDownArrow(e){const{autocompleteState:t}=this.state,{editorState:n,onChange:s,suggestions:o}=this.props;return((e,t,n,s,o,i,a)=>{if(!t){const t=e.getCurrentContent(),s=e.getSelection().getStartKey(),i=t.getBlockAfter(s);return i&&"atomic"===i.getType()||T(e)?(B(e,n,"down",o),"handled"):"not-handled"}o.preventDefault();const r=t.selectedIndex,l=r+1;s({autocompleteState:{...t,selectedIndex:r>=a.length-1?r:l}});const c=i[`item${l}`];return c?(I(c,i.list),"handled"):"handled"})(n,t,s,this.setState.bind(this),e,this.suggestions,o)}onUpArrow(e){const{autocompleteState:t}=this.state,{editorState:n,onChange:s}=this.props;return((e,t,n,s,o,i)=>{if(!t){const t=e.getCurrentContent(),s=e.getSelection().getStartKey(),i=t.getBlockBefore(s);return i&&"atomic"===i.getType()||T(e)?(B(e,n,"up",o),"handled"):"not-handled"}o.preventDefault();const a=t.selectedIndex,r=Math.max(a-1,0);s({autocompleteState:{...t,selectedIndex:r}});const l=i[`item${r}`];return l?(I(l,i.list),"handled"):"handled"})(n,t,s,this.setState.bind(this),e,this.suggestions)}onEscape(e){const{autocompleteState:t}=this.state;return t?(e.preventDefault(),this.setState({autocompleteState:null}),"handled"):"not-handled"}handleReturn(e){const{autocompleteState:t}=this.state,{suggestions:n,onChange:s,editorState:o}=this.props;return((e,t,n,s,o,i)=>t||o.length>0&&o[t.selectedIndex]?(s.preventDefault(),i(),"handled"):T(e)?(n(L(e)),"handled"):"not-handled")(o,t,s,e,n,this.turnSuggestionIntoEntity.bind(this))}getAutocompleteState(){const{autocompleteConfig:e,editorState:t}=this.props;if(E(t))return null;const n=(e=>{const t=window.getSelection();if(0===t.rangeCount)return null;const n=t.getRangeAt(0),s=n.startContainer.textContent.substring(0,n.startOffset);if(/\s+$/.test(s))return null;const o=((e,t=[])=>t.reduce((t,n)=>Math.max(e.lastIndexOf(n),t),-1))(s,e);return-1===o?null:{text:s.substring(o),start:o,end:n.startOffset}})(e.map(e=>e.trigger));if(!n||/\s/g.test(n.text))return null;const s=n.text.charAt(0),o=e.filter(e=>e.trigger===s)[0];return{...n,trigger:s,top:M(n,this.editor.editorContainer),displayKey:o.displayKey,replaceText:o.replaceText,name:o.name,searchText:n.text.slice(1,n.text.length),selectedIndex:0}}turnSuggestionIntoEntity(e=!1){const{autocompleteState:t}=this.state,{editorState:n,suggestions:s,autocompleteConfig:o}=this.props;let i=t.selectedIndex;(e||0===e)&&(i=e);const a=s[i];if(!a)return;const r=o.filter(e=>e.trigger===t.trigger)[0];this.updateEditorState(((e,t,n,s)=>{const{start:o,end:i}=((e,t)=>{const n=t.getSelection(),s=n.getAnchorOffset(),o=n.getAnchorKey();return{start:t.getCurrentContent().getBlockForKey(o).getText().substring(0,s).lastIndexOf(e.trigger),end:s}})(t,e),a=e.getSelection().merge({anchorOffset:o,focusOffset:i}),r=e.getCurrentContent();let l=t.displayKey?n[t.displayKey]:n;l=t.replaceText.replace("$",l);const c=r.createEntity(t.trigger,"IMMUTABLE",{trigger:t.trigger,suggestion:n,extraData:s,startOffset:o,endOffset:o+l.length}).getLastCreatedEntityKey();let d=h.Modifier.replaceText(r,a,l,null,c);const g=a.getAnchorKey();r.getBlockForKey(g).getLength()===i&&(d=h.Modifier.insertText(d,d.getSelectionAfter()," "));const u=h.EditorState.push(e,d,`insert-${t.trigger}`);return h.EditorState.forceSelection(u,d.getSelectionAfter())})(n,t,a,r)),this.setState({autocompleteState:null})}renderTemplate(e){const{autocompleteConfig:t}=this.props,{trigger:n}=this.state.autocompleteState,s=t.filter(e=>e.trigger===n)[0];return s.template?(o=s.template,i=e,o.replace(/\$\{.+?}/g,e=>((e,t,n=`\${${e}}`)=>e.split(".").reduce((e,t)=>e[t]||n,t))(e.substr(2,e.length-3).trim(),i,""))):e;var o,i}handleDroppedFiles(e,t){const{handleImageUpload:n,editorState:s,setReadOnly:o,defaultImageSize:i}=this.props;t[0].name.match(/.(jpg|jpeg|png|gif)$/i)&&(this.updateEditorState(R(s,!1,{},"placeholder")),n(t[0]).then(e=>{this.updateEditorState(R(s,!1,{setReadOnly:o,image:e,edit:!1,handleImageUpload:n,defaultImageSize:i},"media"))}))}handleKeyCommand(e){if("handled"===e)return"handled";const{editorState:t}=this.props,n=h.RichUtils.handleKeyCommand(t,e);return n?(this.updateEditorState(n),"handled"):"not-handled"}handleDrop(e,t,n){if("external"===n)return"handled";let s="not-handled";const o=t.data.getData("text"),i=o?o.split(":"):[];if(2!==i.length)return"not-handled";if("DRAFT_BLOCK"===i[0]){const{editorState:t}=this.props,n=i[1];this.updateEditorState(A(t,n,e)),s="handled"}const a=new MouseEvent("mouseup",{view:window,bubbles:!0,cancelable:!0});return this.editor.editor.dispatchEvent(a),s}render(){const{autocompleteState:e}=this.state,{editorState:t,onChange:n,suggestions:s,onSearch:o,readOnly:i,setReadOnly:a,handleImageUpload:r,defaultImageSize:l}=this.props;return(0,y.jsxs)("div",{className:"liveblog-editor-inner-container",onDrop:e=>{e.target.isContentEditable||e.preventDefault()},children:[(0,y.jsx)(V,{editor:this.editor,editorState:t,onChange:n,handleImageUpload:r,setReadOnly:a,readOnly:i,defaultImageSize:l}),(0,y.jsxs)("div",{style:{position:"relative"},children:[(0,y.jsx)(h.Editor,{editorState:t,onChange:this.updateEditorState.bind(this),blockRendererFn:e=>((e,t,n)=>{if("atomic"===e.getType()){const s=t.getCurrentContent().getEntity(e.getEntityAt(0)).getType(),o=t.getSelection().getStartKey()===e.getKey();if("image"===s)return{component:W(F,t,n),editable:!1,props:{isFocused:o}};if("code-block"===s)return{component:W(P,t,n),editable:!1,props:{isFocused:o}};if("media"===s)return{component:W(G,t,n),editable:!1,props:{isFocused:o}};if("placeholder"===s)return{component:_,editable:!1}}return null})(e,t,n),ref:e=>this.editor=e,onDownArrow:this.onDownArrow.bind(this),onUpArrow:this.onUpArrow.bind(this),onEscape:this.onEscape.bind(this),handleReturn:this.handleReturn.bind(this),handleDroppedFiles:this.handleDroppedFiles.bind(this),handleDrop:this.handleDrop.bind(this),handleKeyCommand:this.handleKeyCommand.bind(this),keyBindingFn:e=>((e,t,n)=>{const s=37===e.keyCode,o=39===e.keyCode,i=8===e.keyCode;if(T(t)){if(s)return B(t,n,"up",e),"handled";if(o)return B(t,n,"down",e),"handled";if(i){const e=t.getCurrentContent(),s=e.getBlockForKey(t.getSelection().getAnchorKey()),o=O(e,s.getKey());return n(h.EditorState.forceSelection(h.EditorState.push(t,o,"remove-block"),o.getSelectionAfter())),"handled"}return"handled"}if(s||i){const s=t.getSelection(),o=s.getStartKey(),i=t.getCurrentContent().getBlockBefore(o);if(i&&0===s.getAnchorOffset()&&"atomic"===i.getType())return B(t,n,"up",e),"handled"}if(o){const s=t.getSelection(),o=s.getAnchorKey(),i=t.getCurrentContent().getBlockForKey(o),a=t.getCurrentContent().getBlockAfter(o);if(a&&i.getLength()===s.getFocusOffset()&&"atomic"===a.getType())return B(t,n,"down",e),"handled"}return(0,h.getDefaultKeyBinding)(e)})(e,t,n),spellCheck:!0,readOnly:i}),(0,y.jsx)(ee,{turnIntoEntity:e=>this.turnSuggestionIntoEntity(e),autocompleteState:e,suggestions:s,renderTemplate:e=>this.renderTemplate(e),onSearch:(e,t)=>o(e,t),setSuggestionIndex:t=>this.setState({autocompleteState:{...e,selectedIndex:t}}),ref:e=>this.suggestions=e})]})]})}}te.propTypes={onChange:a().func,resetSuggestions:a().func,suggestions:a().array,autocompleteConfig:a().array,editorState:a().object,onSearch:a().func,handleImageUpload:a().func,readOnly:a().bool,setReadOnly:a().func,defaultImageSize:a().string};const ne=te;var se=n(6749);const oe=["audio","video","embed","object","canvas","table","form","div","section","iframe","details"],ie=["h1","h2","h3","h4","h5","h6","figcaption","abbr","b","bdi","bdo","code","dfn","i","kbd","mark","q","rt","s","samp","small","big","span","strong","sub","sup","time","u","var","wbr","del","ins","blink","font","em","bold","br","cite"],ae=["head","script","track","nav","source","param","noscript","caption","col","colgroup","tbody","td","tfoot","th","thead","tr","input","datalist","fieldset","frameset","frame","label","textarea","label","legend","meter","optgroup","option","output","progress","select","diaglog","menu","menuitem","summary"],re=({entityKey:e,children:t,contentState:n})=>{const{url:s}=n.getEntity(e).getData();return(0,y.jsx)("a",{href:s,children:t})};re.propTypes={entityKey:a().any,children:a().any,contentState:a().any};const le=re,ce=({children:e,entityKey:t,contentState:n})=>{const{suggestion:s,extraData:o}=n.getEntity(t).getData(),i=`url(${o.cdn}${s.image}.png)`;return(0,y.jsx)("span",{className:"liveblog-inline-emoji",style:{backgroundImage:i},children:e})};ce.propTypes={children:a().any,contentState:a().object,entityKey:a().string};const de=ce,ge=({children:e,entityKey:t,contentState:n})=>{const{nodeName:s,attributes:i}=n.getEntity(t).getData();return o().createElement(s,i,e)};ge.propTypes={children:a().any,contentState:a().object,entityKey:a().string};const he=[{strategy:(e,t,n)=>{e.findEntityRanges(e=>{const t=e.getEntity();return null!==t&&"LINK"===n.getEntity(t).getType()},t)},component:le},{strategy:(e,t,n)=>{e.findEntityRanges(e=>{const t=e.getEntity();return null!==t&&":"===n.getEntity(t).getType()},t)},component:de},{strategy:(e,t,n)=>{e.findEntityRanges(e=>{const t=e.getEntity();return null!==t&&"TEXT"===n.getEntity(t).getType()},t)},component:ge}],ue=new h.CompositeDecorator(he),pe=(e,t)=>(0,se.TF)({htmlToEntity:(e,n,s)=>{if("a"===e)return s("LINK","MUTABLE",{url:n.href});if(ie.includes(e))return s("TEXT","MUTABLE",{nodeName:e,attributes:(o=n.attributes,Array.from(o).reduce((e,t)=>({...e,["class"===t.name?"className":t.name]:t.value}),{}))});var o;if("img"===e)return s("media","IMMUTABLE",{setReadOnly:t.setReadOnly,image:n.src,edit:!1,handleImageUpload:t.handleImageUpload,defaultImageSize:t.defaultImageSize});const i=n.id&&n.id.includes("liveblog-codeblock-identifier-");return i||oe.includes(e)?s("code-block","IMMUTABLE",{code:i?n.innerHTML:n.outerHTML,title:i?n.id.replace("liveblog-codeblock-identifier-","").replace("-"," "):e,setReadOnly:t.setReadOnly}):void 0},htmlToBlock:(e,t)=>("p"!==e||""!==t.innerHTML)&&!ae.includes(e)&&("img"===e||t.id&&t.id.includes("liveblog-codeblock-identifier-")||oe.includes(e)?"atomic":void 0),textToEntity:(e,t)=>{const n=[],s=window.liveblog_settings.autocomplete[1].data,o=window.liveblog_settings.autocomplete[1].cdn;return e.replace(/:(\w+):/g,(e,i,a)=>{const r=s.filter(t=>e.replace(/:/g,"")===t.key.toString())[0],l=t(":","IMMUTABLE",{trigger:":",suggestion:{image:r.image},extraData:{cdn:o}});n.push({entity:l,offset:a,length:e.length,result:e})}),n}})(e),me=e=>(0,se.SG)({styleToHTML:()=>{},blockToHTML:t=>{if("atomic"===t.type){const n=e.getBlockForKey(t.key),s=e.getEntity(n.getEntityAt(0)),o=s.getType();if("image"===o)return(0,y.jsx)("img",{src:s.getData().src});if("code-block"===o)return(0,y.jsx)("div",{children:(0,y.jsx)("div",{id:`liveblog-codeblock-identifier-${s.getData().title.replace(/\s+/g,"-")}`,dangerouslySetInnerHTML:{__html:s.getData().code}})});if("media"===o)return(0,y.jsx)("img",{src:s.getData().image})}return"unordered-list-item"===t.type?{start:"<li>",end:"</li>",nestStart:"<ul>",nestEnd:"</ul>"}:"ordered-list-item"===t.type?{start:"<li>",end:"</li>",nestStart:"<ol>",nestEnd:"</ol>"}:"unstyled"===t.type?(0,y.jsx)("p",{}):(0,y.jsx)("span",{})},entityToHTML:(e,t)=>"LINK"===e.type?(0,y.jsx)("a",{href:e.data.url,children:t}):"TEXT"===e.type?o().createElement(e.data.nodeName,e.data.attributes,t):t})(e),ye=ne;class be extends s.Component{constructor(e){let t,n;super(e),e.entry?(t=h.EditorState.createWithContent(pe(e.entry.content,{setReadOnly:this.setReadOnly.bind(this),handleImageUpload:this.handleImageUpload.bind(this),defaultImageSize:e.config.default_image_size}),ue),n=e.entry.authors):(t=h.EditorState.createEmpty(ue),n=[e.config.current_user]),this.state={editorState:t,suggestions:[],authors:n,mode:"editor",readOnly:!1,rawText:e.entry?e.entry.content:""},this.onChange=e=>this.setState({editorState:e,rawText:(0,d.html)(me(e.getCurrentContent()))}),this.getUsers=(0,g.debounce)(this.getUsers.bind(this),e.config.author_list_debounce_time)}setReadOnly(e){this.setState({readOnly:e})}getContent(){const{editorState:e}=this.state;return me(e.getCurrentContent())}syncRawTextToEditorState(){this.setState({editorState:h.EditorState.createWithContent(pe(this.state.rawText,{setReadOnly:this.setReadOnly.bind(this),handleImageUpload:this.handleImageUpload.bind(this),defaultImageSize:this.props.config.default_image_size}),ue)})}publish(){const{updateEntry:e,entry:t,entryEditClose:n,createEntry:s,isEditing:o}=this.props,{editorState:i,authors:a}=this.state,r=this.getContent(),l=a.map(e=>e.id),c=l.length>0&&l[0],d=l.length>1&&l.slice(1,l.length);if(!i.getCurrentContent().getPlainText().trim()&&null===/<(img|picture|video|audio|canvas|svg|iframe|embed) ?.*>/.exec(me(i.getCurrentContent())))return;if(o)return e({id:t.id,content:r,author:c,contributors:d}),void n(t.id);s({content:r,author:c,contributors:d});const g=h.EditorState.push(i,h.ContentState.createFromText(""));this.onChange(g),this.setState({readOnly:!1})}onSelectAuthorChange(e){this.setState({authors:e})}getUsers(e,t){const{config:n}=this.props;(0,m.Ln)(e,n).timeout(1e4).map(e=>e.response).subscribe(e=>t(null,{options:e,complete:!1}))}getAuthors(e){const{config:t}=this.props;(0,m.Ln)(e,t).timeout(1e4).map(e=>e.response).subscribe(e=>this.setState({suggestions:e.map(e=>e)}))}getHashtags(e){const{config:t}=this.props;(0,m.E)(e,t).timeout(1e4).map(e=>e.response).subscribe(e=>this.setState({suggestions:e.map(e=>e)}))}filterCommandSuggestions(e,t){this.setState({suggestions:e.filter(e=>e.substring(0,t.length)===t)})}filterEmojiSuggestions(e,t){this.setState({suggestions:e.filter(e=>e.key.toString().substring(0,t.length)===t)})}handleOnSearch(e,t){const{config:n}=this.props;switch(e){case"@":this.getAuthors(t);break;case"#":this.getHashtags(t);break;case"/":this.filterCommandSuggestions(n.autocomplete[0].data,t);break;case":":this.filterEmojiSuggestions(n.autocomplete[1].data,t);break;default:this.setState({suggestions:[]})}}handleImageUpload(e){const{config:t}=this.props,n=new FormData;return n.append("name",e.name),n.append("action","upload-attachment"),n.append("_wpnonce",t.image_nonce),n.append("async-upload",e),new Promise(e=>{(0,m.V6)(n).timeout(6e4).map(e=>e.response).subscribe(n=>{const s=w(n.data.sizes,t.default_image_size);e(s)})})}render(){const{editorState:e,suggestions:t,mode:n,authors:s,readOnly:o}=this.state,{isEditing:i,config:a}=this.props;return(0,y.jsxs)("div",{className:"liveblog-editor-container",children:[!i&&(0,y.jsx)("h1",{className:"liveblog-editor-title",children:"Add New Entry"}),(0,y.jsxs)("div",{className:"liveblog-editor-tabs",children:[(0,y.jsx)("button",{className:"liveblog-editor-tab "+("editor"===n?"is-active":""),onClick:()=>this.setState({mode:"editor"}),children:"Visual"}),(0,y.jsx)("button",{className:"liveblog-editor-tab "+("raw"===n?"is-active":""),onClick:()=>this.setState({mode:"raw"}),children:"Text"}),(0,y.jsx)("button",{className:"liveblog-editor-tab "+("preview"===n?"is-active":""),onClick:()=>this.setState({mode:"preview"}),children:"Preview"})]}),"preview"===n&&(0,y.jsx)(S,{config:a,getEntryContent:()=>this.getContent()}),"editor"===n&&(0,y.jsx)(ye,{editorState:e,onChange:this.onChange,suggestions:t,resetSuggestions:()=>this.setState({suggestions:[]}),onSearch:(e,t)=>this.handleOnSearch(e,t),autocompleteConfig:a.autocomplete,handleImageUpload:this.handleImageUpload.bind(this),readOnly:o,setReadOnly:this.setReadOnly.bind(this),defaultImageSize:a.default_image_size}),"raw"===n&&(0,y.jsx)(k,{value:this.state.rawText,onChange:e=>{this.setState({rawText:e},()=>{this.syncRawTextToEditorState()})},height:"275px",width:"100%"}),(0,y.jsx)("h2",{className:"liveblog-editor-subTitle",children:"Authors:"}),(0,y.jsx)(c.Wx,{multi:!0,value:s,valueKey:"key",labelKey:"name",onChange:this.onSelectAuthorChange.bind(this),optionComponent:x,loadOptions:this.getUsers,clearable:!1,cache:!1}),(0,y.jsx)("button",{className:"liveblog-btn liveblog-publish-btn",onClick:this.publish.bind(this),children:i?"Publish Update":"Publish New Entry"})]})}}be.propTypes={config:a().object,updateEntry:a().func,entry:a().object,entryEditClose:a().func,createEntry:a().func,isEditing:a().bool,authors:a().array,getAuthors:a().func};const fe=(0,l.Ng)(e=>e,e=>(0,r.zH)({...u,...p},e))(be)}}]);