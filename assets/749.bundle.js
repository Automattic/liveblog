"use strict";(globalThis.wpJsonpLiveBlog=globalThis.wpJsonpLiveBlog||[]).push([[749],{6749(e,t,l){l.r(t),l.d(t,{default:()=>J});var n=l(1609),i=l(5556),s=l.n(i),a=l(6246),r=l(3570),o=l(83),c=l(290),u=l(5838),d=l(4439),g=l(7704),p=l(3439),m=l(43),h=l(1544),b=l(9325),f=l(1497),v=l(1885),x=l(8832),C=l(3105),y=l(7639),k=l(790);const j=(0,x.guI)("INSERT_IMAGE_COMMAND");class T extends x.Kp7{__src;__alt;static getType(){return"image"}static clone(e){return new T(e.__src,e.__alt,e.__key)}constructor(e,t="",l){super(l),this.__src=e,this.__alt=t}createDOM(){const e=document.createElement("span");return e.className="liveblog-lexical-image-wrapper",e}updateDOM(){return!1}static importJSON(e){const{src:t,alt:l}=e;return I(t,l)}exportJSON(){return{type:"image",version:1,src:this.__src,alt:this.__alt}}static importDOM(){return{img:()=>({conversion:N,priority:0})}}exportDOM(){const e=document.createElement("img");return e.setAttribute("src",this.__src),e.setAttribute("alt",this.__alt),{element:e}}decorate(){return(0,k.jsx)("img",{src:this.__src,alt:this.__alt,className:"liveblog-lexical-image"})}}function N(e){if(e instanceof HTMLImageElement){const t=e.getAttribute("src"),l=e.getAttribute("alt")||"";if(t)return{node:I(t,l)}}return null}function I(e,t=""){return new T(e,t)}const _={paragraph:"liveblog-lexical-paragraph",heading:{h1:"liveblog-lexical-h1",h2:"liveblog-lexical-h2",h3:"liveblog-lexical-h3"},list:{ul:"liveblog-lexical-ul",ol:"liveblog-lexical-ol",listitem:"liveblog-lexical-li",nested:{listitem:"liveblog-lexical-li-nested"}},text:{bold:"liveblog-lexical-bold",italic:"liveblog-lexical-italic",underline:"liveblog-lexical-underline",strikethrough:"liveblog-lexical-strikethrough"},link:"liveblog-lexical-link",quote:"liveblog-lexical-quote",image:"liveblog-lexical-image"},S=[h.jL,h.dJ,b.v5,b.YW,f.Db,f.k_,T];function U({initialContent:e}){const[t]=(0,d.DF)(),l=(0,n.useRef)(!1);return(0,n.useEffect)(()=>{!l.current&&e&&(l.current=!0,t.update(()=>{const l=(new DOMParser).parseFromString(e,"text/html"),n=(0,v.d)(t,l),i=(0,x.NiT)();i.clear(),i.select(),(0,x.H2A)(n)}))},[t,e]),null}function E({onChange:e}){const[t]=(0,d.DF)(),l=(0,n.useCallback)(l=>{e&&l.read(()=>{const l=function(e){let t=e;return t=t.replace(/ style="white-space: pre-wrap;"/g,""),t=t.replace(/ class="liveblog-lexical-[^"]*"/g,""),t=t.replace(/<i>(<em[^>]*>)/g,"$1"),t=t.replace(/<\/em><\/i>/g,"</em>"),t=t.replace(/<b>(<strong[^>]*>)/g,"$1"),t=t.replace(/<\/strong><\/b>/g,"</strong>"),t=t.replace(/<span>([^<]*)<\/span>/g,"$1"),t=t.replace(/<span class="liveblog-lexical-image-wrapper">(<img[^>]*>)<\/span>/g,"$1"),t}((0,v.g)(t,null));e(l)})},[t,e]);return(0,k.jsx)(u.D,{onChange:l})}function D({handleImageUpload:e}){const[t]=(0,d.DF)();return(0,n.useEffect)(()=>{const l=t.registerCommand(j,e=>{const{src:t,alt:l}=e,n=I(t,l),i=(0,x.vJq)();if((0,x.I2P)(i))i.insertNodes([n]);else{const e=(0,x.NiT)(),t=(0,x.lJ7)();t.append(n),e.append(t)}return!0},x.jZM),n=t.registerCommand(x.riq,e=>{const t=e.dataTransfer?.types?.includes("Files");return!!t&&(e.preventDefault(),!0)},x.WgU),i=t.registerCommand(x.Sr4,l=>{const n=l.dataTransfer?.files;if(n&&n.length>0){const i=Array.from(n).filter(e=>e.type.startsWith("image/"));if(i.length>0)return l.preventDefault(),e&&i.reduce((l,n)=>l.then(()=>e(n).then(e=>{t.dispatchCommand(j,{src:e,alt:n.name})}).catch(e=>{console.error("Image upload failed:",e)})),Promise.resolve()),!0}return!1},x.WgU);return()=>{l(),n(),i()}},[t,e]),null}const L=["@","#","/",":"];function A({suggestions:e,onSearch:t}){const[l]=(0,d.DF)(),[i,s]=(0,n.useState)(null),[a,r]=(0,n.useState)(0),[o,c]=(0,n.useState)({top:0,left:0}),u=(0,n.useRef)(null),g=(0,n.useRef)(null),p=(0,n.useRef)(0);(0,n.useEffect)(()=>{g.current=i},[i]),(0,n.useEffect)(()=>{p.current=a},[a]);const m=(0,n.useCallback)(e=>{const t=g.current;t&&(l.update(()=>{const l=(0,x.vJq)();if(!(0,x.I2P)(l))return;const n=l.anchor.getNode();if("text"!==n.getType())return;const i=n.getTextContent(),{trigger:s,startOffset:a,endOffset:r}=t;let o;switch(s){case"@":o=e.key?`@${e.key} `:`@${e} `;break;case"#":o=e.name?`#${e.name} `:`#${e} `;break;case"/":default:o=e+" ";break;case":":o=e.key?`:${e.key}: `:`:${e}: `}const c=i.slice(0,a)+o+i.slice(r);n.setTextContent(c);const u=a+o.length;l.anchor.set(n.getKey(),u,"text"),l.focus.set(n.getKey(),u,"text")}),s(null))},[l]);return(0,n.useEffect)(()=>{const t=l.registerCommand(x.RTo,t=>!!(g.current&&e&&e.length>0)&&(t.preventDefault(),m(e[p.current]),!0),x.WgU),n=l.registerCommand(x.OXk,t=>!!(g.current&&e&&e.length>0)&&(t.preventDefault(),m(e[p.current]),!0),x.WgU),i=l.registerCommand(x.bbF,t=>!!(g.current&&e&&e.length>0)&&(t.preventDefault(),r(t=>t<e.length-1?t+1:0),!0),x.WgU),a=l.registerCommand(x.UDz,t=>!!(g.current&&e&&e.length>0)&&(t.preventDefault(),r(t=>t>0?t-1:e.length-1),!0),x.WgU),o=l.registerCommand(x.Q$N,e=>!!g.current&&(e.preventDefault(),s(null),!0),x.WgU);return()=>{t(),n(),i(),a(),o()}},[l,e,m]),(0,n.useEffect)(()=>l.registerUpdateListener(({editorState:e})=>{e.read(()=>{const e=function(e){let t=null;return e.getEditorState().read(()=>{const e=(0,x.vJq)();if(!(0,x.I2P)(e)||!e.isCollapsed())return;const l=e.anchor,n=l.getNode();if("text"!==n.getType())return;const i=n.getTextContent(),s=l.offset;for(let e=s-1;e>=0;e--){const l=i[e];if(" "===l||"\n"===l)return;if(L.includes(l))return void(0!==e&&" "!==i[e-1]&&"\n"!==i[e-1]||(t={trigger:l,text:i.slice(e+1,s),startOffset:e,endOffset:s}))}}),t}(l);s(e),e&&t&&t(e.trigger,e.text),e&&r(0)})}),[l,t]),(0,n.useEffect)(()=>{if(!i)return;const e=window.getSelection();if(e&&e.rangeCount>0){const t=e.getRangeAt(0).getBoundingClientRect();c({top:t.bottom+4,left:t.left})}},[i,e]),i&&e&&0!==e.length?(0,k.jsx)("div",{ref:u,className:"liveblog-autocomplete-menu",style:{position:"fixed",top:o.top,left:o.left,zIndex:1e3},children:(0,k.jsx)("ul",{className:"liveblog-autocomplete-list",children:e.map((e,t)=>{let l,n=null;return"string"==typeof e?l=e:e.image&&e.key?l=`:${e.key}:`:e.name?(l=e.name,e.avatar&&(n=e.avatar)):l=String(e),(0,k.jsxs)("li",{className:"liveblog-autocomplete-item"+(t===a?" is-selected":""),onClick:()=>m(e),onMouseEnter:()=>r(t),children:[n&&(0,k.jsx)("span",{className:"liveblog-autocomplete-avatar",dangerouslySetInnerHTML:{__html:n}}),(0,k.jsx)("span",{className:"liveblog-autocomplete-text",children:l})]},t)})})}):null}function O({onClick:e,icon:t,title:l,isActive:n=!1,disabled:i=!1}){return(0,k.jsx)("button",{type:"button",onClick:e,title:l,className:"liveblog-editor-btn"+(n?" is-active":""),disabled:i,"aria-label":l,children:(0,k.jsx)("span",{className:`dashicons dashicons-${t}`})})}function R({url:e,onChange:t,onConfirm:l,onCancel:n}){return(0,k.jsxs)("div",{className:"liveblog-editor-input-container",children:[(0,k.jsx)("input",{className:"liveblog-input",type:"url",value:e,onChange:e=>t(e.target.value),placeholder:"https://",autoFocus:!0,onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),l()):"Escape"===e.key&&n()}}),(0,k.jsx)("button",{type:"button",className:"liveblog-editor-btn liveblog-input-enter",onClick:l,title:"Add link",children:(0,k.jsx)("span",{className:"dashicons dashicons-yes"})}),(0,k.jsx)("button",{type:"button",className:"liveblog-editor-btn liveblog-input-cancel",onClick:n,title:"Cancel",children:(0,k.jsx)("span",{className:"dashicons dashicons-no-alt"})})]})}function q({readOnly:e,handleImageUpload:t}){const[l]=(0,d.DF)(),[i,s]=(0,n.useState)({isBold:!1,isItalic:!1,isUnderline:!1,isLink:!1,isQuote:!1,listType:null}),[a,r]=(0,n.useState)(!1),[o,c]=(0,n.useState)("https://"),[u,g]=(0,n.useState)(!1),p=(0,n.useRef)(null);(0,n.useEffect)(()=>l.registerCommand(x.MvL,()=>(s(function(e){const t={isBold:!1,isItalic:!1,isUnderline:!1,isLink:!1,isQuote:!1,listType:null};return e.getEditorState().read(()=>{const e=(0,x.vJq)();if(!(0,x.I2P)(e))return;t.isBold=e.hasFormat("bold"),t.isItalic=e.hasFormat("italic"),t.isUnderline=e.hasFormat("underline");const l=e.anchor.getNode(),n="root"===l.getKey()?l:l.getTopLevelElementOrThrow();if((0,h.jd)(n)&&(t.isQuote=!0),(0,b.HY)(n))t.listType=n.getListType();else{const e=l.getParent();if(e){const l=(0,C.eu)(e,b.v5);l&&(t.listType=l.getListType())}}const i=e.anchor.getNode(),s=i.getParent();t.isLink=(0,f.FJ)(s)||(0,f.FJ)(i)}),t}(l)),!1),x.da8),[l]);const m=(0,n.useCallback)(()=>{l.dispatchCommand(x.mB,"bold")},[l]),v=(0,n.useCallback)(()=>{l.dispatchCommand(x.mB,"italic")},[l]),T=(0,n.useCallback)(()=>{l.dispatchCommand(x.mB,"underline")},[l]),N=(0,n.useCallback)(()=>{"number"===i.listType?l.dispatchCommand(b.uS,void 0):l.dispatchCommand(b.x,void 0)},[l,i.listType]),I=(0,n.useCallback)(()=>{"bullet"===i.listType?l.dispatchCommand(b.uS,void 0):l.dispatchCommand(b.q7,void 0)},[l,i.listType]),_=(0,n.useCallback)(()=>{l.update(()=>{const e=(0,x.vJq)();(0,x.I2P)(e)&&(i.isQuote?(0,y.zI)(e,()=>(0,x.lJ7)()):(0,y.zI)(e,()=>(0,h.xi)()))})},[l,i.isQuote]),S=(0,n.useCallback)(()=>{l.getEditorState().read(()=>{const e=(0,x.vJq)();if(!(0,x.I2P)(e)||e.isCollapsed())return;const t=e.anchor.getNode(),l=t.getParent();(0,f.FJ)(l)?c(l.getURL()):(0,f.FJ)(t)?c(t.getURL()):c("https://"),r(!0)})},[l]),U=(0,n.useCallback)(()=>{o&&"https://"!==o&&l.dispatchCommand(f.yW,o),r(!1),c("https://")},[l,o]),E=(0,n.useCallback)(()=>{l.dispatchCommand(f.yW,null),r(!1)},[l]),D=(0,n.useCallback)(()=>{r(!1),c("https://")},[]),L=(0,n.useCallback)(()=>{p.current?.click()},[]),A=(0,n.useCallback)(e=>{const n=e.target.files?.[0];n&&n.type.startsWith("image/")&&t&&(g(!0),t(n).then(e=>{l.dispatchCommand(j,{src:e,alt:n.name})}).catch(e=>{console.error("Image upload failed:",e)}).finally(()=>{g(!1),p.current&&(p.current.value="")}))},[l,t]);return(0,k.jsx)("div",{className:"liveblog-editor-toolbar-container",children:(0,k.jsxs)("div",{className:"liveblog-toolbar",children:[(0,k.jsx)(O,{onClick:m,icon:"editor-bold",title:"Bold (Ctrl+B)",isActive:i.isBold,disabled:e}),(0,k.jsx)(O,{onClick:v,icon:"editor-italic",title:"Italic (Ctrl+I)",isActive:i.isItalic,disabled:e}),(0,k.jsx)(O,{onClick:T,icon:"editor-underline",title:"Underline (Ctrl+U)",isActive:i.isUnderline,disabled:e}),(0,k.jsx)(O,{onClick:N,icon:"editor-ol",title:"Ordered List",isActive:"number"===i.listType,disabled:e}),(0,k.jsx)(O,{onClick:I,icon:"editor-ul",title:"Unordered List",isActive:"bullet"===i.listType,disabled:e}),(0,k.jsx)(O,{onClick:_,icon:"format-quote",title:"Blockquote",isActive:i.isQuote,disabled:e}),(0,k.jsxs)("div",{style:{position:"relative",display:"inline-block"},children:[(0,k.jsx)(O,{onClick:S,icon:"admin-links",title:"Add Link",isActive:i.isLink,disabled:e}),a&&(0,k.jsx)(R,{url:o,onChange:c,onConfirm:U,onCancel:D})]}),(0,k.jsx)(O,{onClick:E,icon:"editor-unlink",title:"Remove Link",disabled:e||!i.isLink}),t&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(O,{onClick:L,icon:"format-image",title:u?"Uploading...":"Insert Image",disabled:e||u}),(0,k.jsx)("input",{ref:p,type:"file",accept:"image/*",onChange:A,style:{display:"none"}})]})]})})}A.propTypes={suggestions:s().array,onSearch:s().func},O.propTypes={onClick:s().func.isRequired,icon:s().string.isRequired,title:s().string.isRequired,isActive:s().bool,disabled:s().bool},R.propTypes={url:s().string.isRequired,onChange:s().func.isRequired,onConfirm:s().func.isRequired,onCancel:s().func.isRequired},q.propTypes={readOnly:s().bool,handleImageUpload:s().func};const F=({initialContent:e="",onChange:t=null,readOnly:l=!1,handleImageUpload:n=null,suggestions:i=[],onSearch:s=null})=>{const u={namespace:"LiveblogEditor",theme:_,nodes:S,editable:!l,onError:e=>{console.error("Lexical error:",e)}};return(0,k.jsx)("div",{className:"liveblog-lexical-editor",children:(0,k.jsxs)(a.n,{initialConfig:u,children:[(0,k.jsx)(q,{readOnly:l,handleImageUpload:n}),(0,k.jsx)("div",{className:"liveblog-lexical-editor-inner",children:(0,k.jsx)(r.$,{contentEditable:(0,k.jsx)(o.a,{className:"liveblog-lexical-content-editable"}),placeholder:(0,k.jsx)("div",{className:"liveblog-lexical-placeholder",children:"Start writing your liveblog entry..."}),ErrorBoundary:g.R})}),(0,k.jsx)(c.G,{}),(0,k.jsx)(p.W,{}),(0,k.jsx)(m.Q,{}),(0,k.jsx)(D,{handleImageUpload:n}),(0,k.jsx)(A,{suggestions:i,onSearch:s}),(0,k.jsx)(U,{initialContent:e}),(0,k.jsx)(E,{onChange:t})]})})};F.propTypes={initialContent:s().string,onChange:s().func,readOnly:s().bool,handleImageUpload:s().func,suggestions:s().array,onSearch:s().func};const J=F}}]);
//# sourceMappingURL=749.bundle.js.map