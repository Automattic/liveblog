"use strict";(globalThis.wpJsonpLiveBlog=globalThis.wpJsonpLiveBlog||[]).push([[994],{3994(e,t,s){s.r(t),s.d(t,{default:()=>M});var o=s(1609),n=s.n(o),i=s(5556),r=s.n(i),a=s(2960),l=s(9733),c=s(736),d=s(2418),h=s(593),p=s(1160),u=s(7201),g=s(8614),b=s(5384),m=s(790);const v=()=>(0,m.jsxs)("div",{className:"liveblog-loader",children:[(0,m.jsx)("div",{className:"liveblog-loader-bounce1"}),(0,m.jsx)("div",{className:"liveblog-loader-bounce2"})]});class y extends o.Component{constructor(e){super(e),this.state={loading:!0,error:!1,entryContent:!1}}componentDidMount(){const{config:e,getEntryContent:t}=this.props;(0,b.P3)(t(),e).pipe((0,h.w)(1e4),(0,p.T)(e=>e.response)).subscribe(e=>this.setState({entryContent:e.html,loading:!1}))}render(){const{entryContent:e,loading:t}=this.state;return t?(0,m.jsx)("div",{className:"liveblog-preview",children:(0,m.jsx)(v,{})}):!!e&&(0,m.jsx)("div",{className:"liveblog-preview",dangerouslySetInnerHTML:{__html:e}})}}y.propTypes={getEntryContent:r().func,config:r().object};const w=y;class x extends o.Component{handleMouseDown(e){const{onSelect:t,option:s,data:o,selectOption:n}=this.props,i=o||s;e.preventDefault(),e.stopPropagation(),n?n(i):t&&t(i,e)}handleMouseEnter(e){const{onFocus:t,option:s,data:o}=this.props;t&&t(o||s,e)}handleMouseMove(e){const{isFocused:t,onFocus:s,option:o,data:n}=this.props;t||s&&s(n||o,e)}render(){const{className:e,option:t,data:s}=this.props,o=s||t||{};return(0,m.jsxs)("div",{className:`${e} liveblog-popover-item`,onMouseDown:this.handleMouseDown.bind(this),onMouseEnter:this.handleMouseEnter.bind(this),onMouseMove:this.handleMouseMove.bind(this),children:[o.avatar&&(0,m.jsx)("div",{dangerouslySetInnerHTML:{__html:o.avatar}}),o.name]})}}x.propTypes={onSelect:r().func,option:r().object,onFocus:r().func,isFocused:r().bool,className:r().string};const f=x;var C=s(470),S=s(952);s(9072),s(240),S.config.set("useWorker",!1);const j=({container:e=!0,...t})=>(0,m.jsx)("div",{className:"liveblog-html-editor "+(e?"liveblog-html-editor-container":""),children:(0,m.jsx)(C.Ay,{mode:"html",theme:"tomorrow",name:"raw-editor",fontSize:13,showGutter:!1,highlightActiveLine:!0,tabSize:2,blockScrolling:"Infinity",...t})});j.propTypes={container:r().bool};const T=j,E=n().lazy(()=>Promise.all([s.e(672),s.e(749)]).then(s.bind(s,6749)));class N extends o.Component{constructor(e){super(e);const t=e.entry?e.entry.authors:[e.config.current_user];this.state={suggestions:[],authors:t,mode:"editor",readOnly:!1,rawText:e.entry?e.entry.content:"",previewKey:0,editorContent:e.entry?e.entry.content:""}}setReadOnly(e){this.setState({readOnly:e})}getContent(){return this.state.editorContent}onEditorChange(e){this.setState({editorContent:e,rawText:(0,d.html)(e)})}syncRawTextToEditorContent(){this.setState(e=>({editorContent:e.rawText,previewKey:e.previewKey+1}))}publish(){const{updateEntry:e,entry:t,entryEditClose:s,createEntry:o,isEditing:n}=this.props,{authors:i,editorContent:r}=this.state,a=this.getContent(),l=i.map(e=>e.id),c=l.length>0&&l[0],d=l.length>1&&l.slice(1,l.length);if(r.replace(/<[^>]*>/g,"").trim()||null!==/<(img|picture|video|audio|canvas|svg|iframe|embed) ?.*>/.exec(r)){if(n)return e({id:t.id,content:a,author:c,contributors:d}),void s(t.id);o({content:a,author:c,contributors:d}),this.setState(e=>({editorContent:"",rawText:"",readOnly:!1,previewKey:e.previewKey+1}))}}onSelectAuthorChange(e){this.setState({authors:e})}getUsers(e){const{config:t}=this.props;return e&&""!==e.trim()?new Promise(s=>{(0,b.Ln)(e,t).pipe((0,h.w)(1e4),(0,p.T)(e=>e.response)).subscribe({next:e=>s({options:e||[]}),error:e=>{console.warn("Authors API error:",e),s({options:[]})}})}):Promise.resolve({options:[]})}getAuthorsForAutocomplete(e){const{config:t}=this.props;(0,b.Ln)(e,t).pipe((0,h.w)(1e4),(0,p.T)(e=>e.response)).subscribe(e=>this.setState({suggestions:e.map(e=>e)}))}getHashtags(e){const{config:t}=this.props;(0,b.E)(e,t).pipe((0,h.w)(1e4),(0,p.T)(e=>e.response)).subscribe(e=>this.setState({suggestions:e.map(e=>e)}))}filterCommandSuggestions(e,t){this.setState({suggestions:e.filter(e=>e.substring(0,t.length)===t)})}filterEmojiSuggestions(e,t){this.setState({suggestions:e.filter(e=>e.key.toString().substring(0,t.length)===t)})}handleOnSearch(e,t){const{config:s}=this.props;switch(e){case"@":this.getAuthorsForAutocomplete(t);break;case"#":this.getHashtags(t);break;case"/":this.filterCommandSuggestions(s.autocomplete[0].data,t);break;case":":this.filterEmojiSuggestions(s.autocomplete[1].data,t);break;default:this.setState({suggestions:[]})}}handleImageUpload(e){const{config:t}=this.props,s=new FormData;return s.append("name",e.name),s.append("action","upload-attachment"),s.append("_wpnonce",t.image_nonce),s.append("async-upload",e),new Promise((e,o)=>{(0,b.V6)(s).pipe((0,h.w)(6e4),(0,p.T)(e=>e.response)).subscribe({next:s=>{const o=(n=s.data.sizes,i=t.default_image_size,n?n[i]?n[i].source_url||n[i].url:n.full?n.full.source_url||n.full.url:"":"");var n,i;e(o)},error:e=>o(e)})})}render(){const{suggestions:e,mode:t,authors:s,readOnly:o,previewKey:i}=this.state,{isEditing:r,config:a}=this.props;return(0,m.jsxs)("div",{className:"liveblog-editor-container",children:[!r&&(0,m.jsx)("h1",{className:"liveblog-editor-title",children:"Add New Entry"}),(0,m.jsxs)("div",{className:"liveblog-editor-tabs",children:[(0,m.jsx)("button",{className:"liveblog-editor-tab "+("editor"===t?"is-active":""),onClick:()=>this.setState({mode:"editor"}),children:"Visual"}),(0,m.jsx)("button",{className:"liveblog-editor-tab "+("raw"===t?"is-active":""),onClick:()=>this.setState({mode:"raw"}),children:"Text"}),(0,m.jsx)("button",{className:"liveblog-editor-tab "+("preview"===t?"is-active":""),onClick:()=>this.setState({mode:"preview"}),children:"Preview"})]}),"preview"===t&&(0,m.jsx)(w,{config:a,getEntryContent:()=>this.getContent()},i),"editor"===t&&(0,m.jsx)(n().Suspense,{fallback:(0,m.jsx)("div",{className:"liveblog-editor-loading",children:"Loading editor..."}),children:(0,m.jsx)(E,{initialContent:this.state.editorContent,onChange:this.onEditorChange.bind(this),readOnly:o,suggestions:e,onSearch:(e,t)=>this.handleOnSearch(e,t),handleImageUpload:this.handleImageUpload.bind(this)},i)}),"raw"===t&&(0,m.jsx)(T,{value:this.state.rawText,onChange:e=>{this.setState({rawText:e},()=>{this.syncRawTextToEditorContent()})},height:"275px",width:"100%"}),(0,m.jsx)("h2",{className:"liveblog-editor-subTitle",children:"Authors:"}),(0,m.jsx)(c.Wx,{isMulti:!0,value:s,getOptionValue:e=>e.key,getOptionLabel:e=>e.name,onChange:this.onSelectAuthorChange.bind(this),components:{Option:f},loadOptions:this.getUsers.bind(this),isClearable:!1,cacheOptions:!1}),(0,m.jsx)("button",{className:"liveblog-btn liveblog-publish-btn",onClick:this.publish.bind(this),children:r?"Publish Update":"Publish New Entry"})]})}}N.propTypes={config:r().object,updateEntry:r().func,entry:r().object,entryEditClose:r().func,createEntry:r().func,isEditing:r().bool,authors:r().array,getAuthors:r().func};const M=(0,l.Ng)(e=>e,e=>(0,a.zH)({...u,...g},e))(N)}}]);
//# sourceMappingURL=994.bundle.js.map