"use strict";(self.wpJsonpLiveBlog=self.wpJsonpLiveBlog||[]).push([[680],{2680:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Ve});var r=n(1705),o=n(2099),a=n(8183),i=n(5810),l=n(4572),c=n(8499),s=n(3696),u=n(2688),d=n.n(u),g=n(5908),p=n(249),f=n(5335),h=n(1518),m=n(9686),v=n(5213),y=n(7708),b=n(1683),E=n(1345),S=n(8262),k=n(5470);const O=function(){return s.createElement("div",{className:"liveblog-loader"},s.createElement("div",{className:"liveblog-loader-bounce1"}),s.createElement("div",{className:"liveblog-loader-bounce2"}))};function C(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(C=function(){return!!e})()}var w=function(e){function t(e){var n,r,a,c;return(0,o.A)(this,t),r=this,a=t,c=[e],a=(0,l.A)(a),(n=(0,i.A)(r,C()?Reflect.construct(a,c||[],(0,l.A)(r).constructor):a.apply(r,c))).state={loading:!0,error:!1,entryContent:!1},n}return(0,c.A)(t,e),(0,a.A)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.config,r=t.getEntryContent;(0,k.P3)(r(),n).timeout(1e4).map((function(e){return e.response})).subscribe((function(t){return e.setState({entryContent:t.html,loading:!1})}))}},{key:"render",value:function(){var e=this.state,t=e.entryContent;return e.loading?s.createElement("div",{className:"liveblog-preview"},s.createElement(O,null)):!!t&&s.createElement("div",{className:"liveblog-preview",dangerouslySetInnerHTML:{__html:t}})}}])}(s.Component);w.propTypes={getEntryContent:d().func,config:d().object};const A=w;function M(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(M=function(){return!!e})()}var I=function(e){function t(){return(0,o.A)(this,t),e=this,n=t,r=arguments,n=(0,l.A)(n),(0,i.A)(e,M()?Reflect.construct(n,r||[],(0,l.A)(e).constructor):n.apply(e,r));var e,n,r}return(0,c.A)(t,e),(0,a.A)(t,[{key:"handleMouseDown",value:function(e){var t=this.props,n=t.onSelect,r=t.option;e.preventDefault(),e.stopPropagation(),n(r,e)}},{key:"handleMouseEnter",value:function(e){this.props.onFocus(this.props.option,e)}},{key:"handleMouseMove",value:function(e){var t=this.props,n=t.isFocused,r=t.onFocus,o=t.option;n||r(o,e)}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.option;return s.createElement("div",{className:"".concat(t," liveblog-popover-item"),onMouseDown:this.handleMouseDown.bind(this),onMouseEnter:this.handleMouseEnter.bind(this),onMouseMove:this.handleMouseMove.bind(this)},n.avatar&&s.createElement("div",{dangerouslySetInnerHTML:{__html:n.avatar}}),n.name)}}])}(s.Component);I.propTypes={onSelect:d().func,option:d().object,onFocus:d().func,isFocused:d().bool,className:d().string};const T=I;var D=n(8102),j=n(1515),B=n(3354),N=(n(81),n(3579),["container"]),R=function(e){var t=e.container,n=void 0===t||t,r=(0,j.A)(e,N);return s.createElement("div",{className:"liveblog-html-editor ".concat(n?"liveblog-html-editor-container":"")},s.createElement(B.Ay,(0,D.A)({mode:"html",theme:"tomorrow",name:"raw-editor",fontSize:13,showGutter:!1,highlightActiveLine:!0,tabSize:2,blockScrolling:"Infinity"},r)))};R.propTypes={container:d().bool};const P=R;function K(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var x=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]||e.getSelection();if(!t.getHasFocus())return!1;var n=e.getCurrentContent(),r=n.getBlockForKey(t.getStartKey()).getEntityAt(t.getStartOffset()-1);return!!r&&n.getEntity(r)},U=function(e,t){var n=window.getSelection().getRangeAt(0).cloneRange();n.setStart(n.startContainer,e.start);var r=t.getBoundingClientRect(),o=n.getBoundingClientRect();return o.top-r.top+o.height},F=function(e,t){var n=t.getBoundingClientRect(),r=n.bottom,o=n.top,a=e.getBoundingClientRect(),i=a.bottom,l=a.top;i>r&&(t.scrollTop+=a.height),l<o&&(t.scrollTop-=a.height)},_=function(e){var t=e.getSelection();if(t.getAnchorKey()!==t.getFocusKey())return!1;var n=e.getCurrentContent().getBlockForKey(t.getAnchorKey());return"atomic"===n.getType()&&n},z=function(e,t){return e?e[t]?e[t].source_url||e[t].url:e.full?e.full.source_url||e.full.url:"":""},H=n(6449),W=n.n(H);const $=function(e,t,n,r){var o=e.getSelection().getAnchorKey(),a="up"===n?e.getCurrentContent().getBlockBefore(o):e.getCurrentContent().getBlockAfter(o);if((!a||a.get("key")!==o)&&a){r.preventDefault();var i=W().encode(a.getKey(),0,0),l=document.querySelector('[data-offset-key="'.concat(i,'"]')),c=window.getSelection(),s=document.createRange();s.setStart(l,0),s.setEnd(l,0),c.removeAllRanges(),c.addRange(s);var u="up"===n?a.getLength():0;t(b.EditorState.forceSelection(e,new b.SelectionState({anchorKey:a.getKey(),anchorOffset:u,focusKey:a.getKey(),focusOffset:u,isBackward:!1})))}};function X(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?X(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function J(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var V=n(3624);const Y=function(e,t){var n,r=e.getKeyAfter(t),o=e.getBlockForKey(r);n=o&&"unstyled"===o.getType()&&0===o.getLength()&&o===e.getBlockMap().last()?new b.SelectionState({anchorKey:t,anchorOffset:0,focusKey:r,focusOffset:0}):new b.SelectionState({anchorKey:t,anchorOffset:0,focusKey:t,focusOffset:1});var a=b.Modifier.setBlockType(e,n,"unstyled");return b.Modifier.removeRange(a,n,"backward")},Q=function(e){var t=e,n=t.getCurrentContent(),r=t.getSelection(),o=n.getBlockForKey(r.getFocusKey()),a=Y(n,o.getKey()),i=[new b.ContentBlock({key:(0,b.genKey)(),type:o.getType(),text:" ",characterList:o.getCharacterList()}),new b.ContentBlock({key:(0,b.genKey)(),type:"unstyled",text:"",characterList:(0,V.List)()})],l=b.BlockMapBuilder.createFromArray(i),c=b.Modifier.replaceWithFragment(a,r,l);return b.EditorState.forceSelection(b.EditorState.push(t,c,"insert-fragment"),c.getSelectionAfter())};function Z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}const ee=function(e,t,n){var o=e.getCurrentContent(),a=o.getBlockForKey(t),i=o.getEntity(a.getEntityAt(0)),l=function(e,t,n,o,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:" ",l=e.getCurrentContent(),c=t;x(e,t)||(l=b.Modifier.removeRange(l,c,"backward"));var s,u,d=l.getSelectionAfter(),g=d.get("focusKey"),p=l.getBlockForKey(g),f=0===p.getLength()&&null===p.getEntityAt(0),h=0===c.getStartOffset();f||h?(s=d,u=l):s=(u=b.Modifier.splitBlock(l,d)).getSelectionAfter();var m=b.Modifier.setBlockType(u,s,n),v=m.createEntity(a||n,"IMMUTABLE",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},o)),y=v.getLastCreatedEntityKey(),E=b.CharacterMetadata.create({entity:y}),S=[new b.ContentBlock({key:(0,b.genKey)(),type:n,text:i,characterList:(0,V.List)((0,V.Repeat)(E,i.length||1))})];f||S.push(new b.ContentBlock({key:(0,b.genKey)(),type:"unstyled",text:"",characterList:(0,V.List)()}));var k=b.BlockMapBuilder.createFromArray(S);return b.Modifier.replaceWithFragment(m,s,k)}(e,n,a.getType(),i.data,i.type),c=Y(l,t),s=b.EditorState.push(e,c,"move-block");return b.EditorState.forceSelection(s,c.getSelectionAfter())},te=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,o=e;_(e)&&(o=Q(e));var a=o.getCurrentContent().createEntity(r,"IMMUTABLE",n).getLastCreatedEntityKey();if(o=b.AtomicBlockUtils.insertAtomicBlock(o,a," "),!t)return b.EditorState.forceSelection(o,o.getCurrentContent().getSelectionAfter());var i=o.getCurrentContent().getBlockMap().find((function(e){return e.getEntityAt(0)===a}));return ee(o,i.getKey(),t)};var ne=function(e){var t=e.contentState,n=e.block,r=t.getEntity(n.getEntityAt(0)).getData().src;return s.createElement("img",{src:r,role:"presentation"})};ne.propTypes={contentState:d().object,block:d().object};const re=ne,oe=function(){return s.createElement("div",{className:"liveblog-placeholder"},s.createElement("div",{className:"liveblog-placeholder-inner"},s.createElement(O,null),s.createElement("div",{className:"liveblog-placeholder-text"},"Uploading Image...")))};var ae=function(e){var t=e.click,n=e.onMouseDown,r=e.icon,o=e.classes,a=e.readOnly;return s.createElement("span",{style:{display:"inline-block"},onMouseDown:n?function(e){return e.preventDefault()}:null},s.createElement("button",{disabled:a,className:"liveblog-btn liveblog-editor-btn ".concat(o),onClick:n||t},s.createElement("span",{className:"dashicons dashicons-".concat(r)})))};ae.propTypes={click:d().func,onMouseDown:d().func,icon:d().string,classes:d().string,readOnly:d().bool};const ie=ae;function le(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(le=function(){return!!e})()}var ce=function(e){function t(e){var n,r,a,c;(0,o.A)(this,t),r=this,a=t,c=[e],a=(0,l.A)(a),n=(0,i.A)(r,le()?Reflect.construct(a,c||[],(0,l.A)(r).constructor):a.apply(r,c));var s=e.getMetadata(),u=s.code,d=s.title;return n.placeholder="Insert HTML...",n.state={title:d,code:u},n}return(0,c.A)(t,e),(0,a.A)(t,[{key:"save",value:function(){var e=this.state,t=e.code,n=e.title,r=this.props,o=r.replaceMetadata,a=r.setEditMode;o({code:t,title:n},!0),a(!1)}},{key:"cancel",value:function(){var e=this.props,t=e.setEditMode,n=(0,e.getMetadata)(),r=n.code,o=n.title;this.setState({code:r,title:o}),t(!1)}},{key:"handleChange",value:function(e){this.setState({code:e})}},{key:"render",value:function(){var e=this,t=this.state,n=t.code,r=t.title,o=this.props,a=o.edit,i=o.setEditMode,l=o.removeBlock;return s.createElement("div",{className:"liveblog-block-inner liveblog-editor-codeblock"},s.createElement("div",{className:"liveblog-block-header"},s.createElement("span",{className:"liveblog-block-title-container"},s.createElement("span",{className:"liveblog-block-title"},a?"Title:":"HTML Block:"),a?s.createElement("input",{value:r,onChange:function(t){return e.setState({title:t.target.value})}}):s.createElement("span",null,r)),s.createElement("div",{className:"liveblog-editor-actions"},a&&s.createElement("span",{style:{display:"inline-block"},onMouseDown:function(e){return e.preventDefault()}},s.createElement("button",{className:"liveblog-editor-btn liveblog-editor-cancel-btn",onClick:this.cancel.bind(this)},"Cancel")),s.createElement("span",{style:{display:"inline-block"},onMouseDown:function(e){return e.preventDefault()}},s.createElement("button",{className:"liveblog-editor-btn liveblog-editor-action-btn",onClick:a?this.save.bind(this):function(){return i(!0)}},a?"Save":"Edit")),!a&&s.createElement(ie,{onMouseDown:function(){return l()},icon:"no-alt",classes:"liveblog-editor-delete"}))),a&&s.createElement(P,{container:!1,value:n,onChange:this.handleChange.bind(this),height:"175px",width:"100%"}))}}])}(s.Component);ce.propTypes={setEditMode:d().func,getMetadata:d().func,replaceMetadata:d().func,edit:d().bool,removeBlock:d().func};const se=ce;function ue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ue=function(){return!!e})()}const de=function(e,t,n){return function(r){function u(){var e,t,n,r;return(0,o.A)(this,u),t=this,n=u,n=(0,l.A)(n),(e=(0,i.A)(t,ue()?Reflect.construct(n,[],(0,l.A)(t).constructor):n.apply(t,r))).state={edit:!1},e}return(0,c.A)(u,r),(0,a.A)(u,[{key:"componentDidMount",value:function(){var e=this.getMetadata(),t=e.setReadOnly;e.edit&&(this.setState({edit:!0}),t(!0))}},{key:"componentWillUnmount",value:function(){this.setEditMode(!1)}},{key:"setEditMode",value:function(e){var t=this.getMetadata().setReadOnly;this.setState({edit:e}),this.replaceMetadata({edit:e}),t(e)}},{key:"getMetadata",value:function(){var e=this.props,t=e.contentState,n=e.block;return t.getEntity(n.getEntityAt(0)).getData()}},{key:"replaceMetadata",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=this.props,a=o.contentState,i=o.block,l=a.mergeEntityData(i.getEntityAt(0),e);if(r){var c=b.EditorState.push(t,l,"replace-metadata");n(b.EditorState.forceSelection(c,c.getSelection()))}}},{key:"startDrag",value:function(e){var t=this.props.block;e.dataTransfer.dropEffect="move",e.dataTransfer.setData("text","DRAFT_BLOCK:".concat(t.getKey()))}},{key:"removeBlock",value:function(){var e=this.props.block,r=Y(t.getCurrentContent(),e.getKey());n(b.EditorState.forceSelection(b.EditorState.push(t,r,"remove-block"),r.getSelectionAfter()))}},{key:"render",value:function(){var t=this.props.blockProps,n=this.state.edit;return s.createElement("div",{className:"liveblog-block ".concat(n?"is-editing":""," ").concat(t.isFocused?"is-focused":""),draggable:!0,onDragStart:n?function(e){return e.preventDefault()}:this.startDrag.bind(this)},s.createElement(e,(0,D.A)({},this.props,{edit:n,setEditMode:this.setEditMode.bind(this),getMetadata:this.getMetadata.bind(this),replaceMetadata:this.replaceMetadata.bind(this),removeBlock:this.removeBlock.bind(this)})))}}])}(s.Component)};var ge=n(4300);function pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function fe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pe(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function he(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(he=function(){return!!e})()}var me=function(e){return e&&e.media_details&&e.media_details.sizes&&e.media_details.sizes.thumbnail?e.media_details.sizes.thumbnail.source_url:""},ve=function(e){function t(e){var n,r,a,c;return(0,o.A)(this,t),r=this,a=t,c=[e],a=(0,l.A)(a),(n=(0,i.A)(r,he()?Reflect.construct(a,c||[],(0,l.A)(r).constructor):a.apply(r,c))).defaultParams={per_page:12},n.inputId=e.block.getKey(),n.defaultState={loading:!0,images:[],currentPage:0,totalPages:0,searchInput:"",searching:!1,uploading:!1},n.state=fe({},n.defaultState),n}return(0,c.A)(t,e),(0,a.A)(t,[{key:"componentDidUpdate",value:function(e){var t=this.props.edit;t!==e.edit&&t&&(this.setState({searching:!0}),this.getMedia({page:1}))}},{key:"getMedia",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.state,r=n.searchInput,o=n.images,a=n.searching,i=fe(fe({},this.defaultParams),t);r&&(i.search=r),this.setState({loading:!0}),(0,k.xM)(i).pipe((0,v.w)(1e4),(0,y.T)((function(e){return{res:e.response,pages:e.xhr.getResponseHeader("X-WP-TotalPages")}}))).subscribe((function(t){var n=t.res,r=t.pages,l=n;a||(l=[].concat((0,ge.A)(o),(0,ge.A)(n))),e.setState({images:l,totalPages:r,currentPage:i.page,loading:!1,searching:!1})}))}},{key:"loadMore",value:function(){var e=this.state.currentPage;this.getMedia({page:e+1})}},{key:"cancel",value:function(){var e=this.props.setEditMode;this.setState(fe({},this.defaultState)),e(!1)}},{key:"selectImage",value:function(e){var t=this.props,n=t.setEditMode,r=t.replaceMetadata,o=(0,t.getMetadata)().defaultImageSize,a=z(e.media_details.sizes,o);n(!1),this.setState(fe({},this.defaultState)),r({image:a,edit:!1},!0)}},{key:"handleSearch",value:function(e){var t=this;e.preventDefault(),this.setState({searching:!0},(function(){t.getMedia({page:1})}))}},{key:"uploadImage",value:function(){var e=this,t=this.props,n=t.setEditMode,r=t.replaceMetadata,o=(0,t.getMetadata)().handleImageUpload,a=this.imageUpload.files;0!==a.length&&(this.setState(fe(fe({},this.defaultState),{},{uploading:!0})),n(!1),o(a[0]).then((function(t){r({image:t}),e.setState({uploading:!1})})),this.imageUpload.value="")}},{key:"renderMediaImages",value:function(){var e=this,t=this.state,n=t.loading,r=t.images,o=t.currentPage,a=t.totalPages;return t.searching?s.createElement("div",{className:"liveblog-placeholder liveblog-media-loading"},s.createElement("div",{className:"liveblog-placeholder-inner"},s.createElement(O,null),s.createElement("div",{className:"liveblog-placeholder-text"},"Finding Images..."))):0===r.length?s.createElement("div",{className:"liveblog-placeholder liveblog-media-loading"},s.createElement("div",{className:"liveblog-placeholder-inner"},s.createElement("div",{style:{marginBottom:".5rem"}},"No Images Found"),s.createElement("span",{style:{display:"inline-block"},onMouseDown:function(e){return e.preventDefault()}},s.createElement("label",{htmlFor:this.inputId,className:"liveblog-editor-btn liveblog-editor-action-btn has-icon"},s.createElement("span",{className:"dashicons dashicons-upload"}),"Upload an Image?")))):s.createElement("div",{className:"liveblog-media-grid"},r.map((function(t){return s.createElement("div",{key:t.id,onClick:function(){return e.selectImage(t)},className:"liveblog-media-grid-item"},s.createElement("img",{src:me(t)}))})),s.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",margin:".5rem",width:"100%"}},o!==parseInt(a,10)&&!n&&s.createElement("button",{style:{width:"100%",padding:".75rem"},className:"liveblog-editor-btn liveblog-editor-action-btn",onClick:this.loadMore.bind(this)},"Load more"),n&&s.createElement(O,null)))}},{key:"renderCurrentImage",value:function(){var e=this.state.uploading,t=this.props,n=t.getMetadata,r=t.setEditMode,o=n().image;return e?s.createElement("div",{className:"liveblog-placeholder liveblog-media-loading"},s.createElement("div",{className:"liveblog-placeholder-inner"},s.createElement(O,null),s.createElement("div",{style:{marginTop:".5rem"},className:"liveblog-placeholder-text"},"Uploading..."))):o?s.createElement("div",{className:"liveblog-media-current-container"},s.createElement("img",{src:o})):s.createElement("div",{className:"liveblog-placeholder liveblog-media-loading"},s.createElement("div",{className:"liveblog-placeholder-inner"},s.createElement("div",{style:{marginBottom:".5rem"}},"No Image Selected"),s.createElement("span",{style:{display:"inline-block"},onMouseDown:function(e){return e.preventDefault()}},s.createElement("button",{className:"liveblog-editor-btn liveblog-editor-action-btn has-icon",onClick:function(){return r(!0)}},s.createElement("span",{className:"dashicons dashicons-format-image"}),"Choose an Image?"))))}},{key:"render",value:function(){var e=this,t=this.state.searchInput,n=this.props,r=n.edit,o=n.setEditMode,a=n.removeBlock;return s.createElement("div",{className:"liveblog-block-inner liveblog-media-block"},s.createElement("input",{ref:function(t){return e.imageUpload=t},style:{display:"none"},type:"file",id:this.inputId,onChange:this.uploadImage.bind(this),accept:"image/jpeg,image/gif,image/png,image/jpg"}),s.createElement("div",{className:"liveblog-block-header"},s.createElement("span",{className:"liveblog-block-title-container"},s.createElement("span",{className:"liveblog-block-title"},r?"Add Media":"Image Block")),s.createElement("div",{className:"liveblog-editor-actions"},s.createElement("span",{style:{display:"inline-block"},onMouseDown:function(e){return e.preventDefault()}},s.createElement("button",{className:"liveblog-editor-btn liveblog-editor-".concat(r?"cancel":"action","-btn"),onClick:r?this.cancel.bind(this):function(){return o(!0)}},r?"Cancel":"Change Image")),r&&s.createElement("span",{style:{display:"inline-block"},onMouseDown:function(e){return e.preventDefault()}},s.createElement("label",{htmlFor:this.inputId,className:"liveblog-editor-btn liveblog-editor-action-btn has-icon"},s.createElement("span",{className:"dashicons dashicons-upload"}),"Upload")),!r&&s.createElement(ie,{onMouseDown:function(){return a()},icon:"no-alt",classes:"liveblog-editor-delete"}))),r?s.createElement("div",null,s.createElement("form",{className:"liveblog-media-search-container",onSubmit:this.handleSearch.bind(this)},s.createElement("span",{style:{color:"#333",cursor:"pointer"},className:"dashicons dashicons-search",onClick:this.handleSearch.bind(this)}),s.createElement("input",{placeholder:"Search media items...",value:t,onChange:function(t){return e.setState({searchInput:t.target.value})}})),this.renderMediaImages()):this.renderCurrentImage())}}])}(s.Component);ve.propTypes={setEditMode:d().func,block:d().object,getMetadata:d().func,replaceMetadata:d().func,removeBlock:d().func,edit:d().bool,defaultImageSize:d().string};const ye=ve;function be(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(be=function(){return!!e})()}var Ee=function(e){function t(e){var n,r,a,c;return(0,o.A)(this,t),r=this,a=t,c=[e],a=(0,l.A)(a),(n=(0,i.A)(r,be()?Reflect.construct(a,c||[],(0,l.A)(r).constructor):a.apply(r,c))).state={showURLInput:!1,url:""},n.onURLChange=function(e){return n.setState({url:e.target.value})},n}return(0,c.A)(t,e),(0,a.A)(t,[{key:"toggleInlineStyle",value:function(e){(0,this.props.onChange)(b.RichUtils.toggleInlineStyle(this.props.editorState,e))}},{key:"toggleBlockType",value:function(e){(0,this.props.onChange)(b.RichUtils.toggleBlockType(this.props.editorState,e))}},{key:"openLinkModal",value:function(){if(!this.state.showURLInput){var e=this.props.editorState;if(!e.getSelection().isCollapsed()){var t=e.getCurrentContent(),n=e.getSelection().getStartKey(),r=e.getSelection().getStartOffset(),o=t.getBlockForKey(n).getEntityAt(r),a="http://";o&&(a=t.getEntity(o).getData().url),this.setState({showURLInput:!0,url:a})}}}},{key:"closeLinkModal",value:function(){this.setState({showURLInput:!1,url:""})}},{key:"turnIntoLink",value:function(e){e.preventDefault();var t=this.state.url,n=this.props,r=n.editorState;(0,n.onChange)(function(e,t){var n=e.getCurrentContent().createEntity("LINK","MUTABLE",{url:t}),r=e.getSelection(),o=b.EditorState.set(e,{currentContent:n});return b.RichUtils.toggleLink(o,r,n.getLastCreatedEntityKey())}(r,t)),this.setState({url:"",showURLInput:!1})}},{key:"removeAsLink",value:function(e){e.preventDefault(),this.state.showURLInput&&this.setState({url:"",showURLInput:!1});var t=this.props,n=t.editorState,r=t.onChange,o=n.getSelection();o.isCollapsed()||r(b.RichUtils.toggleLink(n,o,null))}},{key:"addCodeBlock",value:function(e){e.preventDefault();var t=this.props,n=t.editorState,r=t.onChange,o=t.setReadOnly;r(te(n,!1,{code:"",title:"HTML",edit:!0,setReadOnly:o},"code-block"))}},{key:"addMediaBlock",value:function(e){e.preventDefault();var t=this.props,n=t.editorState,r=t.onChange,o=t.setReadOnly,a=t.handleImageUpload,i=t.defaultImageSize;r(te(n,!1,{setReadOnly:o,image:"",edit:!0,handleImageUpload:a,defaultImageSize:i},"media"))}},{key:"render",value:function(){var e=this,t=this.state.showURLInput,n=this.props.readOnly;return s.createElement("div",{className:"liveblog-editor-toolbar-container"},s.createElement("button",{disabled:n,onClick:this.addMediaBlock.bind(this),className:"liveblog-editor-btn liveblog-image-upload-btn"},s.createElement("span",{className:"dashicons dashicons-format-image"}),s.createElement("span",{className:"liveblog-image-upload-btn-text"},"Insert Image")),s.createElement("div",{className:"liveblog-toolbar"},s.createElement(ie,{onMouseDown:function(){return e.toggleInlineStyle("BOLD")},icon:"editor-bold",readOnly:n}),s.createElement(ie,{onMouseDown:function(){return e.toggleInlineStyle("ITALIC")},icon:"editor-italic",readOnly:n}),s.createElement(ie,{onMouseDown:function(){return e.toggleInlineStyle("UNDERLINE")},icon:"editor-underline",readOnly:n}),s.createElement(ie,{onMouseDown:function(){return e.toggleBlockType("ordered-list-item")},icon:"editor-ol",readOnly:n}),s.createElement(ie,{onMouseDown:function(){return e.toggleBlockType("unordered-list-item")},icon:"editor-ul",readOnly:n}),s.createElement("div",{style:{position:"relative",display:"inline-block"}},s.createElement(ie,{onMouseDown:this.openLinkModal.bind(this),icon:"admin-links",readOnly:n}),t&&s.createElement("div",{className:"liveblog-editor-input-container"},s.createElement("input",{className:"liveblog-input",onChange:this.onURLChange,value:this.state.url}),s.createElement(ie,{onMouseDown:this.turnIntoLink.bind(this),icon:"yes",classes:"liveblog-input-enter"}),s.createElement(ie,{onMouseDown:this.closeLinkModal.bind(this),icon:"no-alt",classes:"liveblog-input-cancel"}))),s.createElement(ie,{onMouseDown:this.removeAsLink.bind(this),icon:"editor-unlink",readOnly:n}),s.createElement(ie,{onMouseDown:this.addCodeBlock.bind(this),icon:"editor-code",readOnly:n})))}}])}(s.Component);Ee.propTypes={onChange:d().func,editorState:d().object,setReadOnly:d().func,handleImageUpload:d().func,readOnly:d().bool,defaultImageSize:d().string};const Se=Ee;function ke(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ke=function(){return!!e})()}var Oe={maxHeight:"150px",overflowY:"scroll",marginBottom:0},Ce={height:"30px"},we=function(e){function t(){return(0,o.A)(this,t),e=this,n=t,r=arguments,n=(0,l.A)(n),(0,i.A)(e,ke()?Reflect.construct(n,r||[],(0,l.A)(e).constructor):n.apply(e,r));var e,n,r}return(0,c.A)(t,e),(0,a.A)(t,[{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.autocompleteState,r=t.onSearch;n&&(e.autocompleteState||!n?e.autocompleteState.searchText!==n.searchText&&r(n.trigger,n.searchText):r(n.trigger,n.searchText))}},{key:"renderSuggestions",value:function(){var e=this,t=this.props,n=t.turnIntoEntity,r=t.autocompleteState,o=t.renderTemplate,a=t.suggestions,i=t.setSuggestionIndex;return a.map((function(t,a){return s.createElement("li",{ref:function(t){return e["item".concat(a)]=t},style:Ce,className:"liveblog-popover-item ".concat(r.selectedIndex===a?"is-focused":""),key:a,onMouseDown:function(){return n(a)},onMouseEnter:function(){return i(a)},onTouchStart:function(){return i(a)},dangerouslySetInnerHTML:{__html:o(t)}})}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.autocompleteState,r=t.suggestions;if(!n)return!1;var o=n.trigger,a=n.searchText,i=n.name;return 0!==r.length&&s.createElement("div",{className:"liveblog-popover",style:{top:n.top+10}},s.createElement("div",{className:"liveblog-popover-meta"},r.length," ",i,r.length>1?"s":""," matching ",'"',s.createElement("b",null,o,a),'"'),s.createElement("ul",{ref:function(t){return e.list=t},style:Oe},this.renderSuggestions()))}}])}(s.Component);we.propTypes={autocompleteState:d().object,onSearch:d().func,suggestions:d().array,turnIntoEntity:d().func,renderTemplate:d().func,setSuggestionIndex:d().func,getEditorRect:d().func};const Ae=we;function Me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Me(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Te(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Te=function(){return!!e})()}var De=function(e){function t(e){var n,r,a,c;return(0,o.A)(this,t),r=this,a=t,c=[e],a=(0,l.A)(a),(n=(0,i.A)(r,Te()?Reflect.construct(a,c||[],(0,l.A)(r).constructor):a.apply(r,c))).state={autocompleteState:null},n}return(0,c.A)(t,e),(0,a.A)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.onChange,n=e.editorState;_(n)&&t(Q(n))}},{key:"updateEditorState",value:function(e){var t=this,n=this.props,r=n.onChange,o=n.resetSuggestions,a=n.suggestions;r(e),setTimeout((function(){var n=x(e);n&&":"===n.getType()&&r(function(e,t){var n=e.getSelection(),r=t.getData(),o=r.startOffset,a=r.endOffset,i=n.getStartOffset(),l=!1;return i===o+1&&(l=a),i===a-1&&(l=o),l||0===l?b.EditorState.forceSelection(e,n.merge({anchorOffset:l,focusOffset:l})):e}(e,n));var i=t.getAutocompleteState();i&&t.state.autocompleteState&&a.length>0&&t.state.autocompleteState.trigger!==i.trigger&&o(),!i&&a.length>0&&o(),t.setState({autocompleteState:i})}),0)}},{key:"onDownArrow",value:function(e){var t=this.state.autocompleteState,n=this.props,r=n.editorState,o=n.onChange,a=n.suggestions;return function(e,t,n,r,o,a,i){if(!t){var l=e.getCurrentContent(),c=e.getSelection().getStartKey(),s=l.getBlockAfter(c);return s&&"atomic"===s.getType()||_(e)?($(e,n,"down",o),"handled"):"not-handled"}o.preventDefault();var u=t.selectedIndex,d=u+1;r({autocompleteState:J(J({},t),{},{selectedIndex:u>=i.length-1?u:d})});var g=a["item".concat(d)];return g?(F(g,a.list),"handled"):"handled"}(r,t,o,this.setState.bind(this),e,this.suggestions,a)}},{key:"onUpArrow",value:function(e){var t=this.state.autocompleteState,n=this.props;return function(e,t,n,r,o,a){if(!t){var i=e.getCurrentContent(),l=e.getSelection().getStartKey(),c=i.getBlockBefore(l);return c&&"atomic"===c.getType()||_(e)?($(e,n,"up",o),"handled"):"not-handled"}o.preventDefault();var s=t.selectedIndex,u=Math.max(s-1,0);r({autocompleteState:q(q({},t),{},{selectedIndex:u})});var d=a["item".concat(u)];return d?(F(d,a.list),"handled"):"handled"}(n.editorState,t,n.onChange,this.setState.bind(this),e,this.suggestions)}},{key:"onEscape",value:function(e){return this.state.autocompleteState?(e.preventDefault(),this.setState({autocompleteState:null}),"handled"):"not-handled"}},{key:"handleReturn",value:function(e){var t=this.state.autocompleteState,n=this.props,r=n.suggestions,o=n.onChange;return function(e,t,n,r,o,a){return t||o.length>0&&o[t.selectedIndex]?(r.preventDefault(),a(),"handled"):_(e)?(n(Q(e)),"handled"):"not-handled"}(n.editorState,t,o,e,r,this.turnSuggestionIntoEntity.bind(this))}},{key:"getAutocompleteState",value:function(){var e=this.props,t=e.autocompleteConfig,n=e.editorState;if(x(n))return null;var r=function(e){var t=window.getSelection();if(0===t.rangeCount)return null;var n=t.getRangeAt(0),r=n.startContainer.textContent.substring(0,n.startOffset);if(/\s+$/.test(r))return null;var o=function(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).reduce((function(t,n){return Math.max(e.lastIndexOf(n),t)}),-1)}(r,e);return-1===o?null:{text:r.substring(o),start:o,end:n.startOffset}}(t.map((function(e){return e.trigger})));if(!r||/\s/g.test(r.text))return null;var o=r.text.charAt(0),a=t.filter((function(e){return e.trigger===o}))[0];return Ie(Ie({},r),{},{trigger:o,top:U(r,this.editor.editorContainer),displayKey:a.displayKey,replaceText:a.replaceText,name:a.name,searchText:r.text.slice(1,r.text.length),selectedIndex:0})}},{key:"turnSuggestionIntoEntity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.state.autocompleteState,n=this.props,r=n.editorState,o=n.suggestions,a=n.autocompleteConfig,i=t.selectedIndex;(e||0===e)&&(i=e);var l=o[i];if(l){var c=a.filter((function(e){return e.trigger===t.trigger}))[0];this.updateEditorState(function(e,t,n,r){var o=function(e,t){var n=t.getSelection(),r=n.getAnchorOffset(),o=n.getAnchorKey();return{start:t.getCurrentContent().getBlockForKey(o).getText().substring(0,r).lastIndexOf(e.trigger),end:r}}(t,e),a=o.start,i=o.end,l=e.getSelection().merge({anchorOffset:a,focusOffset:i}),c=e.getCurrentContent(),s=t.displayKey?n[t.displayKey]:n;s=t.replaceText.replace("$",s);var u=c.createEntity(t.trigger,"IMMUTABLE",{trigger:t.trigger,suggestion:n,extraData:r,startOffset:a,endOffset:a+s.length}).getLastCreatedEntityKey(),d=b.Modifier.replaceText(c,l,s,null,u),g=l.getAnchorKey();c.getBlockForKey(g).getLength()===i&&(d=b.Modifier.insertText(d,d.getSelectionAfter()," "));var p=b.EditorState.push(e,d,"insert-".concat(t.trigger));return b.EditorState.forceSelection(p,d.getSelectionAfter())}(r,t,l,c)),this.setState({autocompleteState:null})}}},{key:"renderTemplate",value:function(e){var t=this.props.autocompleteConfig,n=this.state.autocompleteState.trigger,r=t.filter((function(e){return e.trigger===n}))[0];return r.template?function(e,t){return e.replace(/\$\{.+?}/g,(function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"${".concat(e,"}");return e.split(".").reduce((function(e,t){return e[t]||n}),t)}(e.substr(2,e.length-3).trim(),t,"")}))}(r.template,e):e}},{key:"handleDroppedFiles",value:function(e,t){var n=this,r=this.props,o=r.handleImageUpload,a=r.editorState,i=r.setReadOnly,l=r.defaultImageSize;t[0].name.match(/.(jpg|jpeg|png|gif)$/i)&&(this.updateEditorState(te(a,!1,{},"placeholder")),o(t[0]).then((function(e){n.updateEditorState(te(a,!1,{setReadOnly:i,image:e,edit:!1,handleImageUpload:o,defaultImageSize:l},"media"))})))}},{key:"handleKeyCommand",value:function(e){if("handled"===e)return"handled";var t=this.props.editorState,n=b.RichUtils.handleKeyCommand(t,e);return n?(this.updateEditorState(n),"handled"):"not-handled"}},{key:"handleDrop",value:function(e,t,n){if("external"===n)return"handled";var r="not-handled",o=t.data.getData("text"),a=o?o.split(":"):[];if(2!==a.length)return"not-handled";if("DRAFT_BLOCK"===a[0]){var i=this.props.editorState,l=a[1];this.updateEditorState(ee(i,l,e)),r="handled"}var c=new MouseEvent("mouseup",{view:window,bubbles:!0,cancelable:!0});return this.editor.editor.dispatchEvent(c),r}},{key:"render",value:function(){var e=this,t=this.state.autocompleteState,n=this.props,r=n.editorState,o=n.onChange,a=n.suggestions,i=n.onSearch,l=n.readOnly,c=n.setReadOnly,u=n.handleImageUpload,d=n.defaultImageSize;return s.createElement("div",{className:"liveblog-editor-inner-container",onDrop:function(e){e.target.isContentEditable||e.preventDefault()}},s.createElement(Se,{editor:this.editor,editorState:r,onChange:o,handleImageUpload:u,setReadOnly:c,readOnly:l,defaultImageSize:d}),s.createElement("div",{style:{position:"relative"}},s.createElement(b.Editor,{editorState:r,onChange:this.updateEditorState.bind(this),blockRendererFn:function(e){return function(e,t,n){if("atomic"===e.getType()){var r=t.getCurrentContent().getEntity(e.getEntityAt(0)).getType(),o=t.getSelection().getStartKey()===e.getKey();if("image"===r)return{component:de(re,t,n),editable:!1,props:{isFocused:o}};if("code-block"===r)return{component:de(se,t,n),editable:!1,props:{isFocused:o}};if("media"===r)return{component:de(ye,t,n),editable:!1,props:{isFocused:o}};if("placeholder"===r)return{component:oe,editable:!1}}return null}(e,r,o)},ref:function(t){return e.editor=t},onDownArrow:this.onDownArrow.bind(this),onUpArrow:this.onUpArrow.bind(this),onEscape:this.onEscape.bind(this),handleReturn:this.handleReturn.bind(this),handleDroppedFiles:this.handleDroppedFiles.bind(this),handleDrop:this.handleDrop.bind(this),handleKeyCommand:this.handleKeyCommand.bind(this),keyBindingFn:function(e){return function(e,t,n){var r=37===e.keyCode,o=39===e.keyCode,a=8===e.keyCode;if(_(t)){if(r)return $(t,n,"up",e),"handled";if(o)return $(t,n,"down",e),"handled";if(a){var i=t.getCurrentContent(),l=i.getBlockForKey(t.getSelection().getAnchorKey()),c=Y(i,l.getKey());return n(b.EditorState.forceSelection(b.EditorState.push(t,c,"remove-block"),c.getSelectionAfter())),"handled"}return"handled"}if(r||a){var s=t.getSelection(),u=s.getStartKey(),d=t.getCurrentContent().getBlockBefore(u);if(d&&0===s.getAnchorOffset()&&"atomic"===d.getType())return $(t,n,"up",e),"handled"}if(o){var g=t.getSelection(),p=g.getAnchorKey(),f=t.getCurrentContent().getBlockForKey(p),h=t.getCurrentContent().getBlockAfter(p);if(h&&f.getLength()===g.getFocusOffset()&&"atomic"===h.getType())return $(t,n,"down",e),"handled"}return(0,b.getDefaultKeyBinding)(e)}(e,r,o)},spellCheck:!0,readOnly:l}),s.createElement(Ae,{turnIntoEntity:function(t){return e.turnSuggestionIntoEntity(t)},autocompleteState:t,suggestions:a,renderTemplate:function(t){return e.renderTemplate(t)},onSearch:function(e,t){return i(e,t)},setSuggestionIndex:function(n){return e.setState({autocompleteState:Ie(Ie({},t),{},{selectedIndex:n})})},ref:function(t){return e.suggestions=t}})))}}])}(s.Component);De.propTypes={onChange:d().func,resetSuggestions:d().func,suggestions:d().array,autocompleteConfig:d().array,editorState:d().object,onSearch:d().func,handleImageUpload:d().func,readOnly:d().bool,setReadOnly:d().func,defaultImageSize:d().string};const je=De;var Be=n(345),Ne=["audio","video","embed","object","canvas","table","form","div","section","iframe","details"],Re=["h1","h2","h3","h4","h5","h6","figcaption","abbr","b","bdi","bdo","code","dfn","i","kbd","mark","q","rt","s","samp","small","big","span","strong","sub","sup","time","u","var","wbr","del","ins","blink","font","em","bold","br","cite"],Pe=["head","script","track","nav","source","param","noscript","caption","col","colgroup","tbody","td","tfoot","th","thead","tr","input","datalist","fieldset","frameset","frame","label","textarea","label","legend","meter","optgroup","option","output","progress","select","diaglog","menu","menuitem","summary"],Ke=function(e){var t=e.entityKey,n=e.children,r=e.contentState.getEntity(t).getData().url;return s.createElement("a",{href:r},n)};Ke.propTypes={entityKey:d().any,children:d().any,contentState:d().any};const Le=Ke;var xe=function(e){var t=e.children,n=e.entityKey,r=e.contentState.getEntity(n).getData(),o=r.suggestion,a=r.extraData,i="url(".concat(a.cdn).concat(o.image,".png)");return s.createElement("span",{className:"liveblog-inline-emoji",style:{backgroundImage:i}},t)};xe.propTypes={children:d().any,contentState:d().object,entityKey:d().string};const Ue=xe;var Fe=function(e){var t=e.children,n=e.entityKey,r=e.contentState.getEntity(n).getData(),o=r.nodeName,a=r.attributes;return s.createElement(o,a,t)};Fe.propTypes={children:d().any,contentState:d().object,entityKey:d().string};const _e=[{strategy:function(e,t,n){e.findEntityRanges((function(e){var t=e.getEntity();return null!==t&&"LINK"===n.getEntity(t).getType()}),t)},component:Le},{strategy:function(e,t,n){e.findEntityRanges((function(e){var t=e.getEntity();return null!==t&&":"===n.getEntity(t).getType()}),t)},component:Ue},{strategy:function(e,t,n){e.findEntityRanges((function(e){var t=e.getEntity();return null!==t&&"TEXT"===n.getEntity(t).getType()}),t)},component:Fe}];var ze=new b.CompositeDecorator(_e),He=function(e,t){return(0,Be.TF)({htmlToEntity:function(e,n,o){if("a"===e)return o("LINK","MUTABLE",{url:n.href});if(Re.includes(e))return o("TEXT","MUTABLE",{nodeName:e,attributes:(a=n.attributes,Array.from(a).reduce((function(e,t){return L(L({},e),{},(0,r.A)({},"class"===t.name?"className":t.name,t.value))}),{}))});var a;if("img"===e)return o("media","IMMUTABLE",{setReadOnly:t.setReadOnly,image:n.src,edit:!1,handleImageUpload:t.handleImageUpload,defaultImageSize:t.defaultImageSize});var i=n.id&&n.id.includes("liveblog-codeblock-identifier-");return i||Ne.includes(e)?o("code-block","IMMUTABLE",{code:i?n.innerHTML:n.outerHTML,title:i?n.id.replace("liveblog-codeblock-identifier-","").replace("-"," "):e,setReadOnly:t.setReadOnly}):void 0},htmlToBlock:function(e,t){return("p"!==e||""!==t.innerHTML)&&!Pe.includes(e)&&("img"===e||t.id&&t.id.includes("liveblog-codeblock-identifier-")||Ne.includes(e)?"atomic":void 0)},textToEntity:function(e,t){var n=[],r=window.liveblog_settings.autocomplete[1].data,o=window.liveblog_settings.autocomplete[1].cdn;return e.replace(/:(\w+):/g,(function(e,a,i){var l=r.filter((function(t){return e.replace(/:/g,"")===t.key.toString()}))[0],c=t(":","IMMUTABLE",{trigger:":",suggestion:{image:l.image},extraData:{cdn:o}});n.push({entity:c,offset:i,length:e.length,result:e})})),n}})(e)},We=function(e){return(0,Be.SG)({styleToHTML:function(){},blockToHTML:function(t){if("atomic"===t.type){var n=e.getBlockForKey(t.key),r=e.getEntity(n.getEntityAt(0)),o=r.getType();if("image"===o)return s.createElement("img",{src:r.getData().src});if("code-block"===o)return s.createElement("div",null,s.createElement("div",{id:"liveblog-codeblock-identifier-".concat(r.getData().title.replace(/\s+/g,"-")),dangerouslySetInnerHTML:{__html:r.getData().code}}));if("media"===o)return s.createElement("img",{src:r.getData().image})}return"unordered-list-item"===t.type?{start:"<li>",end:"</li>",nestStart:"<ul>",nestEnd:"</ul>"}:"ordered-list-item"===t.type?{start:"<li>",end:"</li>",nestStart:"<ol>",nestEnd:"</ol>"}:"unstyled"===t.type?s.createElement("p",null):s.createElement("span",null)},entityToHTML:function(e,t){return"LINK"===e.type?s.createElement("a",{href:e.data.url},t):"TEXT"===e.type?s.createElement(e.data.nodeName,e.data.attributes,t):t}})(e)};const $e=je;function Xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function qe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xe(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ge(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Ge=function(){return!!e})()}var Je=function(e){function t(e){var n,r,a,c,s,u;return(0,o.A)(this,t),r=this,a=t,c=[e],a=(0,l.A)(a),n=(0,i.A)(r,Ge()?Reflect.construct(a,c||[],(0,l.A)(r).constructor):a.apply(r,c)),e.entry?(s=b.EditorState.createWithContent(He(e.entry.content,{setReadOnly:n.setReadOnly.bind(n),handleImageUpload:n.handleImageUpload.bind(n),defaultImageSize:e.config.default_image_size}),ze),u=e.entry.authors):(s=b.EditorState.createEmpty(ze),u=[e.config.current_user]),n.state={editorState:s,suggestions:[],authors:u,mode:"editor",readOnly:!1,rawText:e.entry?e.entry.content:""},n.onChange=function(e){return n.setState({editorState:e,rawText:(0,h.html)(We(e.getCurrentContent()))})},n.getUsers=(0,m.A)(n.getUsers.bind(n),e.config.author_list_debounce_time),n}return(0,c.A)(t,e),(0,a.A)(t,[{key:"setReadOnly",value:function(e){this.setState({readOnly:e})}},{key:"getContent",value:function(){var e=this.state.editorState;return We(e.getCurrentContent())}},{key:"syncRawTextToEditorState",value:function(){this.setState({editorState:b.EditorState.createWithContent(He(this.state.rawText,{setReadOnly:this.setReadOnly.bind(this),handleImageUpload:this.handleImageUpload.bind(this),defaultImageSize:this.props.config.default_image_size}),ze)})}},{key:"publish",value:function(){var e=this.props,t=e.updateEntry,n=e.entry,r=e.entryEditClose,o=e.createEntry,a=e.isEditing,i=this.state,l=i.editorState,c=i.authors,s=this.getContent(),u=c.map((function(e){return e.id})),d=u.length>0&&u[0],g=u.length>1&&u.slice(1,u.length);if(l.getCurrentContent().getPlainText().trim()||null!==/<(img|picture|video|audio|canvas|svg|iframe|embed) ?.*>/.exec(We(l.getCurrentContent()))){if(a)return t({id:n.id,content:s,author:d,contributors:g}),void r(n.id);o({content:s,author:d,contributors:g});var p=b.EditorState.push(l,b.ContentState.createFromText(""));this.onChange(p),this.setState({readOnly:!1})}}},{key:"onSelectAuthorChange",value:function(e){this.setState({authors:e})}},{key:"getUsers",value:function(e,t){var n=this.props.config;(0,k.Ln)(e,n).pipe((0,v.w)(1e4),(0,y.T)((function(e){return e.response}))).subscribe({next:function(e){return t(null,{options:e,complete:!1})},error:function(e){return console.log(e)}})}},{key:"getAuthors",value:function(e){var t=this,n=this.props.config;(0,k.Ln)(e,n).pipe((0,v.w)(1e4),(0,y.T)((function(e){return e.response}))).subscribe({next:function(e){return t.setState({suggestions:e.map((function(e){return e}))})},error:function(e){return console.log(e)}})}},{key:"getHashtags",value:function(e){var t=this,n=this.props.config;(0,k.E)(e,n).pipe((0,v.w)(1e4),(0,y.T)((function(e){return e.response}))).subscribe({next:function(e){return t.setState({suggestions:e.map((function(e){return e}))})},error:function(e){return console.log(e)}})}},{key:"filterCommandSuggestions",value:function(e,t){this.setState({suggestions:e.filter((function(e){return e.substring(0,t.length)===t}))})}},{key:"filterEmojiSuggestions",value:function(e,t){this.setState({suggestions:e.filter((function(e){return e.key.toString().substring(0,t.length)===t}))})}},{key:"handleOnSearch",value:function(e,t){var n=this.props.config;switch(e){case"@":this.getAuthors(t);break;case"#":this.getHashtags(t);break;case"/":this.filterCommandSuggestions(n.autocomplete[0].data,t);break;case":":this.filterEmojiSuggestions(n.autocomplete[1].data,t);break;default:this.setState({suggestions:[]})}}},{key:"handleImageUpload",value:function(e){var t=this.props.config,n=new FormData;return n.append("name",e.name),n.append("action","upload-attachment"),n.append("_wpnonce",t.image_nonce),n.append("async-upload",e),new Promise((function(e){(0,k.V6)(n,t).pipe((0,v.w)(6e4),(0,y.T)((function(e){return e.response}))).subscribe({next:function(n){var r=z(n.data.sizes,t.default_image_size);e(r)},error:function(e){return console.log(e)}})}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.editorState,r=t.suggestions,o=t.mode,a=t.authors,i=t.readOnly,l=this.props,c=l.isEditing,u=l.config;return s.createElement("div",{className:"liveblog-editor-container"},!c&&s.createElement("h1",{className:"liveblog-editor-title"},"Add New Entry"),s.createElement("div",{className:"liveblog-editor-tabs"},s.createElement("button",{className:"liveblog-editor-tab ".concat("editor"===o?"is-active":""),onClick:function(){return e.setState({mode:"editor"})}},"Visual"),s.createElement("button",{className:"liveblog-editor-tab ".concat("raw"===o?"is-active":""),onClick:function(){return e.setState({mode:"raw"})}},"Text"),s.createElement("button",{className:"liveblog-editor-tab ".concat("preview"===o?"is-active":""),onClick:function(){return e.setState({mode:"preview"})}},"Preview")),"preview"===o&&s.createElement(A,{config:u,getEntryContent:function(){return e.getContent()}}),"editor"===o&&s.createElement($e,{editorState:n,onChange:this.onChange,suggestions:r,resetSuggestions:function(){return e.setState({suggestions:[]})},onSearch:function(t,n){return e.handleOnSearch(t,n)},autocompleteConfig:u.autocomplete,handleImageUpload:this.handleImageUpload.bind(this),readOnly:i,setReadOnly:this.setReadOnly.bind(this),defaultImageSize:u.default_image_size}),"raw"===o&&s.createElement(P,{value:this.state.rawText,onChange:function(t){e.setState({rawText:t},(function(){e.syncRawTextToEditorState()}))},height:"275px",width:"100%"}),s.createElement("h2",{className:"liveblog-editor-subTitle"},"Authors:"),s.createElement(f.A,{isMulti:!0,value:a,onInputChange:this.onSelectAuthorChange.bind(this),components:{Option:T},loadOptions:this.getUsers,isClearable:!1,cacheOptions:!1}),s.createElement("button",{className:"liveblog-btn liveblog-publish-btn",onClick:this.publish.bind(this)},c?"Publish Update":"Publish New Entry"))}}])}(s.Component);Je.propTypes={config:d().object,updateEntry:d().func,entry:d().object,entryEditClose:d().func,createEntry:d().func,isEditing:d().bool,authors:d().array,getAuthors:d().func};const Ve=(0,p.Ng)((function(e){return e}),(function(e){return(0,g.zH)(qe(qe({},E),S),e)}))(Je)}}]);